AdwaysInteractiveBrightcoveAsyncFinalPlugin = function() {
    "use strict";

    var experience = null;
    var autoLoad = false;
    var currentMediaID = '';
	var defaultCustomField = 'adways_publication_id';

    if (arguments.length < 2)
        return -1;

    if (typeof arguments[1] != "object")
        return -2;

    var that = arguments[1];

    if ((typeof adways != "undefined" && typeof adways.interactive == "undefined") || typeof adways == "undefined") {
    !function(v){"use strict";void 0===v.adways&&(v.adways=new Object);var u=v.adways;void 0===u.tweaks&&(u.tweaks=new Object);var s=v.console;if(void 0!==s&&null!=s||(v.console=new Object,s=v.console),"function"!=typeof s.log)if(void 0===s.log||null==s.log)s.log=function(){};else if("object"!=typeof s.log)throw"console.log is not a function";if("function"!=typeof s.warn)if(void 0===s.warn||null==s.warn)s.warn=function(){};else if("object"!=typeof s.warn)throw"console.warn is not a function";if("indexOf"in Array.prototype||(Array.prototype.indexOf=function(t,n){void 0===n&&(n=0),n<0&&(n+=this.length),n<0&&(n=0);for(var i=this.length;n<i;n++)if(n in this&&this[n]===t)return n;return-1}),void 0===u&&(u=new Object),void 0===u.i){u.i=new Object,u.i.s=0,u.i.h=document.createElement("div"),u.i.h.style.display="block",u.i.h.style.position="fixed",u.i.h.style.bottom="0%",u.i.h.style.width="100%",u.i.h.style.height="70px",u.i.u=document.createElement("div"),u.i.u.id="adways-tracer-resize-div",u.i.u.style.position="absolute",u.i.u.style.top="0px",u.i.u.style.height="5px",u.i.u.style.left="0px",u.i.u.style.width="100%",u.i.u.style.overflow="hidden",u.i.u.style.backgroundColor="rgb(0,255,0)";var t="#adways-tracer-resize-div:hover{cursor:ns-resize;}",n=document.createElement("style");n.setAttribute("type","text/css"),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(n),u.i.l=document.createElement("div"),u.i.l.style.position="absolute",u.i.l.style.top="5px",u.i.l.style.bottom="0px",u.i.l.style.left="0px",u.i.l.style.width="100%",u.i.l.style.overflow="scroll",u.i.l.style.color="rgb(0,255,0)",u.i.l.style.fontSize="12px";var i=document.createElement("div");i.innerHTML="\x3c!--[if lt IE 9]><i></i><![endif]--\x3e",0<i.getElementsByTagName("i").length?(u.i.l.style.backgroundColor="black",u.i.l.style.opacity=.8,u.i.l.style.o="progid:DXImageTransform.Microsoft.Alpha(Opacity=80)",u.i.l.style.filter="alpha(opacity=80)"):u.i.l.style.backgroundColor="rgba(0,0,0,0.8)",u.i.h.appendChild(u.i.u),u.i.h.appendChild(u.i.l),u.i.v=document.createElement("div"),u.i.v.style.display="block",u.i.v.style.position="fixed",u.i.v.style.top="0%",u.i.v.style.left="0%",u.i.v.style.width="100%",u.i.v.style.height="100%",u.i.v.style.cursor="ns-resize",u.i.N=function(t){t.stopPropagation(),t.preventDefault(),u.i.m=t.screenY,u.i.p=u.i.h.offsetHeight,v.addEventListener?(v.addEventListener("mousemove",u.i.O,!0),v.addEventListener("mouseup",u.i.j,!0)):(v.attachEvent("onmousemove",u.i.O,!0),v.attachEvent("onmouseup",u.i.j,!0)),document.getElementsByTagName("body")[0].appendChild(u.i.v)},u.i.O=function(t){t.stopPropagation(),t.preventDefault();var n=t.screenY-u.i.m;u.i.h.style.height=u.i.p-n+"px"},u.i.j=function(t){t.stopPropagation(),t.preventDefault(),document.getElementsByTagName("body")[0].removeChild(u.i.v),v.removeEventListener?(v.removeEventListener("mousemove",u.i.O,!0),v.removeEventListener("mouseup",u.i.j,!0)):(v.detachEvent("onmousemove",u.i.O,!0),v.detachEvent("onmouseup",u.i.j,!0))},v.addEventListener?u.i.u.addEventListener("mousedown",u.i.N,!0):u.i.u.attachEvent("onmousedown",u.i.N,!0),u.trace=function(t){var n=++u.i.s+" - ",i="<pre>"+n+t.replace("\n","<br>")+"</pre>",r=n+t;void 0!==s&&s.log(r),u.i.l.innerHTML=i+"<br>"+u.i.l.innerHTML},u.k=function(){u.i.l.innerHTML=""}}u.lib=new Object,u.lib.ready=!1,u.lib.error=null,u.lib.version=2;try{void 0===u.g&&(u.g=!1,v.addEventListener?v.addEventListener("load",function(){u.g=!0}):v.attachEvent("onload",function(){u.g=!0}),u.isPageLoaded=function(){return u.g}),void 0===u.construct&&(u.construct=function(t,n){function i(){return t.apply(this,n)}return i.prototype=t.prototype,new i}),void 0===u.destruct&&(u.destruct=function(){if(arguments[0]){var t=1;return"function"==typeof arguments[0].preDestroy?arguments[0].preDestroy():"function"==typeof arguments[0].M&&arguments[0].M(),"function"==typeof arguments[0].destroy&&(t=arguments[0].destroy()),t}return 0});new Object;var o=new Object;o._=function(){var t=arguments[0];t._ti_=new Array;for(var n=0,i=0;n<arguments.length;++n)null!=arguments[n]&&(t._ti_[i++]=arguments[n]);if(1<arguments.length&&null!=arguments[1]){var r=function(){};r.prototype=arguments[1].prototype,t.prototype=new r}if(2<arguments.length){var e=new Array,s=new Array(arguments.length-2);for(n=2;n<arguments.length;++n){(h=new Object).S=arguments[n],h.I=!1,s[n-2]=h}for(;0<s.length;){var u=s[s.length-1];if(u.I){for(n=0;n<e.length&&e[n]!==u.S;)++n;if(n>=e.length){for(var n in u.S)"_ti_"!=n&&(t.prototype[n]=u.S[n]);e.push(u.S)}s.pop()}else{u.I=!0;for(n=1;n<u.S._ti_.length;++n){var h;(h=new Object).S=u.S._ti_[n],h.I=!1,s.push(h)}}}}"function"!=typeof t.prototype.F&&(t.prototype.F=o.F),"function"!=typeof t.prototype.destroy&&(t.prototype.destroy=o.destroy),"function"!=typeof t.prototype.M&&(t.prototype.M=o.M),t.prototype.T=t},o.J=function(){var t=arguments[0];t._ti_=new Array;for(var n=0,i=0;n<arguments.length;++n)null!=arguments[n]&&(t._ti_[i++]=arguments[n])},o.R=function(){for(var t=1,n=arguments[0]._ti_.length;t<arguments.length;++t)null!=arguments[t]&&(arguments[0]._ti_[n++]=arguments[t])},o.F=function(t){return"function"==typeof t&&this instanceof t||o.U(this.T,t)},o.destroy=function(){return 2},o.M=function(){return 1},o.U=function(t,n){if(t._ti_ instanceof Array){for(var i=1;i<t._ti_.length&&t._ti_[i]!==n&&!o.U(t._ti_[i],n);)++i;return i<t._ti_.length}return!1},o.Z=function(t,n){return"function"==typeof n&&t instanceof n||void 0!==t&&null!=t&&(void 0!==t.T&&null!=t.T?o.U(t.T,n):t===n||o.U(t,n))};var r=new Object;r.P="exception.UNKNOWN",r.K="exception.ASSERT",r.L="exception.obf_MODULE_MISSING",r.q="exception.BAD_ARGS",r.G=new Object,o.J(r.G);var x=new Object;x.H=function(t,n){this.kind=0<arguments.length?t:r.P,this.V=1<arguments.length?n:"";var i=new Error;this.stack=i.stack},o._(x.H,null,r.G),x.H.prototype.W=function(){return"Exception: "+this.V+"\nKind: "+this.$()},x.H.prototype.$=function(){return this.kind},x.H.prototype.tt=function(){return this.V},x.H.prototype.it=function(){return this.stack};var e=new Object;e.st=new Object,e.st.nt="flag.MAX_FLAG_NUMBER_REACHED";var h=new Object;h.ht=function(){void 0!==arguments[0]?o.Z(arguments[0],h.ht)?this.rt=arguments[0].ut():"number"==typeof arguments[0]?this.rt=2*arguments[0]:this.rt=1:this.rt=1},o._(h.ht),h.ht.et=4294967295,h.ht.lt=function(){throw new x.H(e.st.nt)},h.ht.prototype.ut=function(){var t=this.rt;return this.rt*=2,this.rt>h.ht.et&&h.ht.lt(this),t};var a=new Object;a.ft=0,a.ot=++a.ft,a.at=new Object,a.at.ct=1,a.at.wt=2,a.vt=new Object,o.J(a.vt),a.bt=new Object,o.J(a.bt,a.vt),a.At=new Object,o.J(a.At,a.vt),a.dt=new Object,o.J(a.dt,a.vt),a.pt=new Object,o.J(a.pt,a.bt),a.Ot=new Object,o.J(a.Ot);var f=new Object;f.A=new Object,o.J(f.A,a.vt),f.jt=function(t){this.kind=t,this.D=null},o._(f.jt,null,f.A),f.jt.prototype.rz=function(){return this.D},f.jt.prototype.$=function(){return this.kind},f.jt.prototype.C=function(t){return this.D=t,1},f.kt=function(t,n){f.jt.call(this,t),this.oldValue=n},o._(f.kt,f.jt,a.bt),f.kt.prototype.Zr=function(){return this.oldValue},a.gt=++a.ft,f.xt=function(t,n){f.jt.call(this,a.gt),this.errorCode=t,this.B=n},o._(f.xt,f.jt,a.dt),f.xt.prototype.X=function(){return this.errorCode},f.xt.prototype.Y=function(){return this.B},f.Mt=function(t,n){f.jt.call(this,t),this.data=n},o._(f.Mt,f.jt,a.At),f.Mt.prototype.On=function(){return this.data},f._t=function(t,n,i){f.kt.call(this,t,i),this.key=n},o._(f._t,f.kt,a.pt),f._t.prototype.tq=function(){return this.key},f.Et=function(){this.iq=new Array,this.nq=a.at.ct,this.sq=!0},o._(f.Et,null,a.Ot),f.Et.prototype.M=function(){return this.zs(new f.jt(a.ot)),2},f.Et.prototype.destroy=function(){return this.hq(),2},f.Et.prototype.Ti=function(){var t=arguments[0],n=arguments[1].valueOf(),i=null,r=0;switch(arguments.length){case 5:arguments[4];case 4:r=arguments[3];case 3:i=arguments[2]}switch(this.rq(t,n,i)){case-2:this.iq[t]=new Array;case-1:var e=new Object;return e.listener=n,e.eq=i,e.uq=r,this.iq[t].push(e),this.iq[t].sort(function(t,n){return n.uq-t.uq}),1;default:return 0}},f.Et.prototype.Ci=function(){var t=arguments[0],n=arguments[1],i=null;3<=arguments.length&&(i=arguments[2]);var r=this.rq(t,n,i);return 0<=r?(this.iq[t].splice(r,1),1):0},f.Et.prototype.hq=function(){return this.iq=new Array,1},f.Et.prototype.fq=function(){return void 0===this.iq[arguments[0]]?0:this.iq[arguments[0]].length},f.Et.prototype.oq=function(){var t=null;return 3<=arguments.length&&(t=arguments[2]),-1<this.rq(arguments[0],arguments[1],t)},f.Et.prototype.aq=function(){throw"not implemented yet"},f.Et.prototype.cq=function(){throw"not implemented yet"},f.Et.prototype.lq=function(){return this.sq},f.Et.prototype.wq=function(){var t=arguments[0].valueOf();return t!==this.sq?(this.sq=t,1):0},f.Et.prototype.Pr=function(){return this.nq},f.Et.prototype.vq=function(){return arguments[0]!=this.nq?(this.nq=arguments[0],1):0},f.Et.prototype.zs=function(){var t=arguments[0].$();if(0<this.fq(t)){for(var n,i=new Array(this.iq[t].length),r=0;r<this.iq[t].length;++r)i[r]=this.iq[t][r];if(arguments.length<=1||!this.sq)if(this.nq==a.at.ct)arguments[0].C(this),f.Et.Nq(i,arguments[0]);else(n=arguments[0]).C(this),setTimeout(function(){f.Et.Nq(i,n)},0);else if(arguments[1]==a.at.ct)arguments[0].C(this),f.Et.Nq(i,arguments[0]);else(n=arguments[0]).C(this),setTimeout(function(){f.Et.Nq(i,n)},0);return 2}return 1},f.Et.Nq=function(t,n){for(var i=0;i<t.length;++i)try{t[i].listener.call(t[i].eq,n)}catch(t){void 0!==s&&(s.log("error(s) in a listener: "+t),s.log(t),void 0!==t.stack&&s.log(t.stack))}},f.Et.prototype.rq=function(){if(void 0===this.iq[arguments[0]])return-2;for(var t=0;t<this.iq[arguments[0]].length&&(this.iq[arguments[0]][t].listener!=arguments[1]||this.iq[arguments[0]][t].eq!==arguments[2]);)++t;return t==this.iq[arguments[0]].length?-1:t};var c=new Object;c.St=new Object,c.St.zt=function(){var i={It:function(){var t=i.Ft,n=i.Dt;return n(t(32),8)+"-"+n(t(16),4)+"-"+n(16384|t(12),4)+"-"+n(32768|t(14),4)+"-"+n(t(48),12)},Ft:function(t){return t<0?NaN:t<=30?0|Math.random()*(1<<t):t<=53?(0|Math.random()*(1<<30))+(0|Math.random()*(1<<t-30))*(1<<30):NaN},Dt:function(t,n){for(var i=t.toString(16),r=n-i.length,e="0";0<r;r>>>=1,e+=e)1&r&&(i=e+i);return i}},t=i.It();return c.St.Tt(t)},c.St.Tt=function(){return 0<arguments.length?c.St.Ct(arguments[0])?c.St.Jt(arguments[0]):(c.St.Rt.push(arguments[0]),arguments[0]):c.St.zt()},c.St.Jt=function(){return c.St.Tt()},c.St.Rt=new Array,c.St.Ct=function(){for(var t=0;t<c.St.Rt.length&&c.St.Rt[t]!==arguments[0];)++t;return t<c.St.Rt.length},c.Ut=function(){return arguments[0]instanceof Array||"function"==typeof Array.isArray&&Array.isArray(arguments[0])},c.Bt=new Object,c.Bt.Zt=function(t,n){if("number"!=typeof n)return n;var i=new Object;return isNaN(n)?i.isNN="n":n==Number.NEGATIVE_INFINITY?i.isNN="-":n==Number.POSITIVE_INFINITY?i.isNN="+":(i.isNN="y",i.val=n.toString()),i},c.Bt.Pt=function(t,n){if("object"!=typeof n||null===n||"string"!=typeof n.isNN)return n;switch(n.isNN){case"n":return Number.NaN;case"-":return Number.NEGATIVE_INFINITY;case"+":return Number.POSITIVE_INFINITY;case"y":default:return parseFloat(n.val)}};var l=new Object;l.Kt=new Object,o.J(l.Kt);var b=new Object;b.Lt=function(t,n,i,r,e){if(void 0===t||void 0===n)return s.warn("Adways Button Helpe: no base or target container given."),0;this.qt=new Array,this.qt.position="position",this.qt.display="display",this.qt.margin="margin",this.qt.marginLeft="margin-left",this.qt.marginRight="margin-right",this.qt.marginTop="margin-top",this.qt.marginBottom="margin-bottom",this.qt.padding="padding",this.qt.paddingLeft="padding-left",this.qt.paddingRight="padding-right",this.qt.paddingTop="padding-top",this.qt.paddingBottom="padding-bottom",this.qt.width="width",this.qt.height="height",this.qt.top="top",this.qt.bottom="bottom",this.qt.left="left",this.qt.right="right",this.qt.zIndex="z-index",this.qt.cursor="cursor",this.qt.backgroundColor="background-color",this.qt.backgroundImage="background-image",this.qt.backgroundRepeat="background-repeat",this.Gt="string"==typeof e?e:"adways-custom-button",this.bq=t,this.target=n,this.button=document.createElement("div"),this.button.className=this.Gt,this.bq.appendChild(this.button),this.Ht={mode:"css-like",reference:new Array(1,1),bottom:"10px",right:"10px",width:"30px",height:"30px"},this.Xt={zIndex:"90000",display:"block",cursor:"pointer",position:"absolute",backgroundImage:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNgYAAAAAMAASsJTYQAAAAASUVORK5CYII=)",backgroundColor:"transparent",backgroundRepeat:"repeat"},this.Qt(i),this.Vt(r)},o._(b.Lt,null,l.Kt),b.Lt.prototype.destroy=function(){return this.bq.removeChild(this.button),delete this.button,1},b.Lt.prototype.Yt=function(){return this.button},b.Lt.prototype.Wt=function(){return this.Ht},b.Lt.prototype.$t=function(){return this.Xt},b.Lt.prototype.ti=function(t){for(var n in t)"display"!=n&&"position"!=n&&(this.Xt[n]=t[n]);return 1},b.Lt.prototype.ii=function(t,n){if(null==n||"object"!=typeof n)return 0;for(var i in n)void 0!==this.qt[i]&&t.style.setProperty(i,n[i],"important");return 1},b.Lt.prototype.si=function(t){switch(t.mode){case"css-like":default:this.ii(this.button,this.ni(t))}},b.Lt.prototype.hi=function(t){if(!t)return Number.NaN;var n=t.indexOf("px");return-1==n?(-1==(n=t.indexOf("%"))?s.warn("Button Helper: no units for button size or position"):s.warn("Button Helper: % on button size not yet supported"),0):0==n?(s.warn("Button Helper: no value for button position or button size"),0):parseFloat(t)},b.Lt.prototype.ni=function(t){var n=new Object;n.left=this.hi(t.left),n.top=this.hi(t.top),n.right=this.hi(t.right),n.bottom=this.hi(t.bottom),n.width=this.hi(t.width),n.height=this.hi(t.height);var i=new Object,r=this.target.offsetTop,e=this.target.offsetLeft,s=this.target.offsetWidth,u=this.target.offsetHeight;return this.target!==this.bq||"static"==this.bq.style&&""==this.bq.style||(e=r=0),isNaN(n.left)?i.left=e+t.reference[0]*s-n.right-n.width:i.left=e+t.reference[0]*s+n.left,isNaN(n.top)?i.top=r+t.reference[1]*u-n.bottom-n.height:i.top=r+t.reference[1]*u+n.top,i.width=n.width+"px",i.height=n.height+"px",i.left+="px",i.top+="px",i},b.Lt.prototype.Qt=function(t){return void 0!==t&&null!=t&&(t.reference&&(this.Ht.reference=t.reference),t.left&&(this.Ht.left=t.left,delete this.Ht.right),t.right&&(this.Ht.right=t.right,delete this.Ht.left),t.top&&(this.Ht.top=t.top,delete this.Ht.bottom),t.bottom&&(this.Ht.bottom=t.bottom,delete this.Ht.top),t.width&&(this.Ht.width=t.width),t.height&&(this.Ht.height=t.height),isNaN(this.hi(this.Ht.left))&&isNaN(this.hi(this.Ht.right))||isNaN(this.hi(this.Ht.top))&&isNaN(this.hi(this.Ht.bottom))||isNaN(this.hi(this.Ht.width))&&isNaN(this.hi(this.Ht.height)))?(s.warn("Button position invalid!"),null):(this.si(this.Ht),1)},b.Lt.prototype.Vt=function(t){if(void 0!==t&&null!=t)for(var n in t)this.Xt[n]=t[n];return this.ii(this.button,this.Xt),1},b.ri=new Object,b.ri.P=0,b.ri.ui=1,b.ri.ei=2,b.ri.li=3,b.ri.fi=4,b.ri.oi=5,b.ri.ai=6,b.ri.ci=7,b.ri.wi=8,b.ri.vi=9,b.ri.Ni=10,b.ri.bi=11,b.ri.yi=12,b.ri.mi=13,b.ri.Ai=14,b.ri.di=15,b.ri.pi=16,b.ri.Oi=17,b.ri.ji=18,b.ri.ki=19,b.ri.gi=20,b.ri.xi=function(){try{var t=navigator.userAgent,n=new Array(1);n[0]=new Object;var i=new RegExp("opera","i");if(t.match(i)){if(n[0].name="Opera",n[0].identifier=b.ri.ai,i.compile("version/[0-9.]+","i"),null!=(h=i.exec(t))&&0<h.length){var r=(h=h[0].split("/"))[1].split(".");n[0].version=new Array(r.length+1),n[0].version[0]=h[1];for(var e=0;e<r.length;++e)n[0].version[e+1]=r[e]}else n[0].version=new Array(1),n[0].version[0]="unknown";i.compile("opera mobi/[0-9a-zA-Z._-]*","i");var s=i.exec(t);null!=s&&0<s.length?(n[1]=new Object,n[1].name="Opera Mobile",n[1].identifier=b.ri.bi,s=s[0].split("/"),n[1].version=new Array(1),n[1].version[0]=s[1]):(i.compile("opera mini/[0-9a-zA-Z._-]*/[0-9a-zA-Z._-]*","i"),null!=(s=i.exec(t))&&0<s.length&&(n[1].name="Opera Mini",n[1].identifier=b.ri.Ni,s=s[0].split("/"),n[1].version=new Array(1),n[1].version[0]=s[1]))}else{if(i.compile("MSIE [0-9a-zA-Z.]+","i"),null!=(u=i.exec(t))&&0<u.length){n[0].name="Internet Explorer",n[0].identifier=b.ri.ci;r=(h=u[0].split(" "))[1].split(".");n[0].version=new Array(r.length+1),n[0].version[0]=h[1];for(e=0;e<r.length;++e)n[0].version[e+1]=r[e]}else{if(i.compile("chrome/[0-9a-zA-Z.]+","i"),null!=(u=i.exec(t))&&0<u.length){n[0].name="Chrome",n[0].identifier=b.ri.wi;r=(h=u[0].split("/"))[1].split(".");n[0].version=new Array(r.length+1),n[0].version[0]=h[1];for(e=0;e<r.length;++e)n[0].version[e+1]=r[e]}else{if(i.compile("safari","i"),t.match(i))if(n[0].name="Safari",n[0].identifier=b.ri.fi,i.compile("version/[0-9.]+","i"),null!=(h=i.exec(t))&&0<h.length){r=(h=h[0].split("/"))[1].split(".");n[0].version=new Array(r.length+1),n[0].version[0]=h[1];for(e=0;e<r.length;++e)n[0].version[e+1]=r[e]}else n[0].version=new Array(1),n[0].version[0]="unknown";else if(i.compile("firefox/[0-9a-zA-Z.]+","i"),null!=(u=i.exec(t))&&0<u.length){n[0].name="Firefox",n[0].identifier=b.ri.oi;var u;r=(h=u[0].split("/"))[1].split(".");n[0].version=new Array(r.length+1),n[0].version[0]=h[1];for(e=0;e<r.length;++e)n[0].version[e+1]=r[e];if(i.compile("fennec/[0-9a-zA-Z.]+","i"),null!=(u=i.exec(t))&&0<u.length){n[1]=new Object,n[1].name="Fennec",n[1].identifier=b.ri.vi;var h;r=(h=u[0].split("/"))[1].split(".");n[1].version=new Array(r.length+1),n[1].version[0]=h[1];for(e=0;e<r.length;++e)n[1].version[e+1]=r[e]}}else n[0].name="unknown",n[0].identifier=b.ri.P,n[0].version=new Array(1),n[0].version[0]="unknown"}}}var o=new Array;if(o[0]=new Object,i.compile("applewebkit","i"),t.match(i))if(o[0].name="AppleWebkit",o[0].identifier=b.ri.yi,i.compile("applewebkit/[0-9a-zA-Z.]+","i"),null!=(l=i.exec(t))&&0<l.length){r=(l=l[0].split("/"))[1].split(".");o[0].version=new Array(r.length+1),o[0].version[0]=l[1];for(e=0;e<r.length;++e)o[0].version[e+1]=r[e]}else o[0].version=new Array(1),o[0].version[0]="unknown";else if(i.compile("presto","i"),t.match(i))if(o[0].name="Presto",o[0].identifier=b.ri.mi,i.compile("presto/[0-9a-zA-Z.]+","i"),null!=(l=i.exec(t))&&0<l.length){r=(l=l[0].split("/"))[1].split(".");o[0].version=new Array(r.length+1),o[0].version[0]=l[1];for(e=0;e<r.length;++e)o[0].version[e+1]=r[e]}else o[0].version=new Array(1),o[0].version[0]="unknown";else if(i.compile("trident","i"),t.match(i))if(o[0].name="Trident",o[0].identifier=b.ri.di,i.compile("trident/[0-9a-zA-Z.]+","i"),null!=(l=i.exec(t))&&0<l.length){r=(l=l[0].split("/"))[1].split(".");o[0].version=new Array(r.length+1),o[0].version[0]=l[1];for(e=0;e<r.length;++e)o[0].version[e+1]=r[e]}else o[0].version=new Array(1),o[0].version[0]="unknown";else if(i.compile("gecko","i"),t.match(i))if(o[0].name="Gecko",o[0].identifier=b.ri.Ai,i.compile("rv:[0-9a-zA-Z.]+","i"),null!=(l=i.exec(t))&&0<l.length){r=(l=l[0].split(":"))[1].split(".");o[0].version=new Array(r.length+1),o[0].version[0]=l[1];for(e=0;e<r.length;++e)o[0].version[e+1]=r[e]}else o[0].version=new Array(1),o[0].version[0]="unknown";else o[0].name="unknown",o[0].identifier=b.ri.P,o[0].version=new Array(1),o[0].version[0]="unknown";var a,f=new Array;if(f[0]=new Object,i.compile("ipad","i"),t.match(i))f[0].name="iPad",f[0].identifier=b.ri.pi,i.compile("mobile/[0-9a-zA-Z]+","i"),null!=(a=i.exec(t))&&0<a.length&&(a=a[0].split("/"),f[0].Mi=a[1]),f[0].version=new Array(1),f[0].version[0]="unknown";else if(/iPhone/.test(t)&&!v._i)f[0].name="iPhone",f[0].identifier=b.ri.Oi,i.compile("mobile/[0-9a-zA-Z]+","i"),null!=(a=i.exec(t))&&0<a.length&&(a=a[0].split("/"),f[0].Mi=a[1]),f[0].version=new Array(1),f[0].version[0]="unknown";else if(i.compile("ipod","i"),t.match(i))f[0].name="iPod",f[0].identifier=b.ri.ji,i.compile("mobile/[0-9a-zA-Z]+","i"),null!=(a=i.exec(t))&&0<a.length&&(a=a[0].split("/"),f[0].Mi=a[1]),f[0].version=new Array(1),f[0].version[0]="unknown";else i.compile("macintosh","i"),t.match(i)?(f[0].name="Macintosh",f[0].identifier=b.ri.ki):(f[0].name="unknown",f[0].identifier=b.ri.P),f[0].version=new Array(1),f[0].version[0]="unknown";var c=new Array;switch(c[0]=new Object,f[0].name){case"iPhone":case"iPad":case"iPod":var l;if(c[0].name="iOS",c[0].identifier=b.ri.ui,i.compile("CPU[ a-zA-Z]*OS[ ][0-9_]*","i"),null!=(l=i.exec(t))&&0<l.length){i.compile("[0-9_]+","i");r=(l=i.exec(l[0]))[0].split("_");c[0].version=new Array(r.length+1),c[0].version[0]=l[0];for(e=0;e<r.length;++e)c[0].version[e+1]=r[e]}else c[0].version=new Array(1),c[0].version[0]="unknown";break;default:i.compile("windows","i"),t.match(i)?(c[0].name="Windows",c[0].identifier=b.ri.ei):(i.compile("android","i"),t.match(i)?(c[0].name="Android",c[0].identifier=b.ri.gi):(i.compile("mac os x","i"),t.match(i)?(c[0].name="MacOSX",c[0].identifier=b.ri.li):(c[0].name="unknown",c[0].identifier=b.ri.P))),c[0].version=new Array(1),c[0].version[0]="unknown"}return(w=new Object).Ei=1,w.Si=1,w.browser=n,w.renderer=o,w.device=f,w.os=c,w}catch(t){var w;return(w=new Object).Ei=1,w.Si=0,w.browser=new Array(1),w.browser[0]=new Object,w.browser[0].name="unknown",w.browser[0].identifier=b.ri.P,w.browser[0].version=new Array,w.browser[0].version[0]="unknown",w.renderer=new Array(1),w.renderer[0]=new Object,w.renderer[0].name="unknown",w.renderer[0].identifier=b.ri.P,w.renderer[0].version=new Array,w.renderer[0].version[0]="unknown",w.device=new Array(1),w.device[0]=new Object,w.device[0].name="unknown",w.device[0].identifier=b.ri.P,w.device[0].version=new Array,w.device[0].version[0]="unknown",w.os=new Array(1),w.os[0]=new Object,w.os[0].name="unknown",w.os[0].identifier=b.ri.P,w.os[0].version=new Array,w.os[0].version[0]="unknown",w}},b.ri.zi=b.ri.xi(),"number"!=typeof u.tweaks.io&&b.ri.zi.browser[0].identifier==b.ri.ci&&(u.tweaks.io=parseInt(b.ri.zi.browser[0].version[1])),b.Ii=function(){var t=document.defaultView.getComputedStyle(arguments[0],null).getPropertyValue("z-index");if("auto"!=t)return parseInt(t);for(var n=arguments[0].parentNode,i=0;i<n.children.length&&p_children[i]!==arguments[0];)++i},b.Fi=function(){return document.defaultView.getComputedStyle(arguments[0],null).getPropertyValue("z-index")},b.Di=function(){for(var t=Number.NEGATIVE_INFINITY,n=0;n<arguments[0].children.length;++n){var i=document.defaultView.getComputedStyle(arguments[0].children[n],null).getPropertyValue("z-index");t<i&&"auto"!=i&&(t=parseInt(i))}return t==Number.NEGATIVE_INFINITY?0:t},b.Ti=function(n,t,i,r){if(arguments.length<4&&(r=!1),void 0===n.addEventListener&&"load"==t&&void 0===n.onload){var e=function(t){"loaded"!=n.readyState&&"complete"!=n.readyState||(i.call(),n.removeEventListener?n.removeEventListener("readystatechange",e):n.detachEvent?n.detachEvent("onreadystatechange",e):n.onreadystatechange=null)};n.addEventListener?n.addEventListener("readystatechange",e):n.attachEvent?n.attachEvent("onreadystatechange",e):n.onreadystatechange=e}else n.addEventListener?n.addEventListener(t,i,r):n.attachEvent&&n.attachEvent("on"+t,i,r)},b.Ci=function(t,n,i,r){arguments.length<4&&(r=!1),t.removeEventListener?t.removeEventListener(n,i,r):t.detachEvent&&t.detachEvent("on"+n,i,r)},b.Ji=function(t){var n=new Object;return t.offsetX?(n.x=t.offsetX,n.y=t.offsetY):t.layerX?(n.x=t.layerX,n.y=t.layerY):(n.x=Number.NaN,n.y=Number.NaN),n},b.Ri=function(){return"ontouchstart"in v},b.Ui=b.Ri(),b.Bi=function(t,n,i){return b.Ui?b.Ti(t,"touchend",n,i):b.Ti(t,"mouseup",n,i)},b.Zi=function(t,n,i){return b.Ui?b.Ci(t,"touchend",n,i):b.Ci(t,"mouseup",n,i)},b.Pi=function(t,n,i){return b.Ui?b.Ti(t,"touchstart",n,i):b.Ti(t,"mousedown",n,i)},b.Ki=function(t,n,i){return b.Ui?b.Ci(t,"touchstart",n,i):b.Ci(t,"mousedown",n,i)},b.Li=function(t,n,i){return b.Ui?b.Ti(t,"touchmove",n,i):b.Ti(t,"mousemove",n,i)},b.qi=function(t,n,i){return b.Ui?b.Ci(t,"touchmove",n,i):b.Ci(t,"mousemove",n,i)},b.Gi=function(t,n,i){return b.Ui&&b.ri.zi.os[0].identifier==b.ri.ui?b.Ti(t,"touchend",n,i):b.Ti(t,"click",n,i)},b.Hi=function(t,n,i){return b.Ui,b.Ci(t,"click",n,i)},b.Xi=function(t){return b.Ui?t.touches&&0<t.touches.length?[t.touches[0].screenX,t.touches[0].screenY]:[Number.NaN,Number.NaN]:[t.screenX,t.screenY]},b.Qi=function(t){var n=document.createElement("div");return n.innerHTML=t,0===n.childNodes.length?"":n.childNodes[0].nodeValue},b.Vi=function(t,n){b.Yi(t,n)||(t.className+=" "+n)},b.Wi=function(t,n){if(b.Yi(t,n)){var i=2<arguments.length&&arguments[2],r=new RegExp("(?:^|\\s)"+n+"(?!\\S)");i&&(r=new RegExp("(?:^|\\s)"+n+"(?!\\S)","g")),t.className=t.className.replace(r,"")}},b.Yi=function(t,n){var i=new RegExp("(?:^|\\s)"+n+"(?!\\S)");return t.className.match(i)},b.$i=function(t){var n=v.getComputedStyle(t,null);if(null===n)return new Array(1,0,0,1,0,0);var i=n.getPropertyValue("-webkit-transform")||n.getPropertyValue("-moz-transform")||n.getPropertyValue("-ms-transform")||n.getPropertyValue("-o-transform")||n.getPropertyValue("transform")||"";return""==i||"none"==i?new Array(1,0,0,1,0,0):b.ts(i)},b.ss=function(t){var n=v.getComputedStyle(t,null),i=n.getPropertyValue("-webkit-transform-origin")||n.getPropertyValue("-moz-transform-origin")||n.getPropertyValue("-ms-transform-origin")||n.getPropertyValue("-o-transform-origin")||n.getPropertyValue("transform-origin")||"";if(""==i)return new Array(0,0);var r=i.split(" ");return new Array(parseFloat(r[0].substr(0,r[0].indexOf("px"))),parseFloat(r[1].substr(0,r[1].indexOf("px"))))},b.ns=function(){var t=1<arguments.length?arguments[1]:new Array(6),n=b.$i(arguments[0]),i=b.ss(arguments[0]);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=-n[0]*i[0]-n[1]*i[1]+n[2]+i[0],t[5]=-n[3]*i[0]-n[4]*i[1]+n[5]+i[1],t},b.ts=function(t){var n=t.split("(")[1];n=(n=n.split(")")[0]).split(",");var i=1<arguments.length?arguments[1]:new Array(6);return i[0]=parseFloat(n[0]),i[1]=parseFloat(n[2]),i[2]=parseFloat(n[1]),i[3]=parseFloat(n[3]),i[4]=parseFloat(n[4]),i[5]=parseFloat(n[5]),i},b.hs=function(){var t,n,i,r,e,s;if(c.Ut(arguments[0])){var u=1<arguments.length?arguments[1]:3;t=arguments[0][0].valueOf(),n=arguments[0][1].valueOf(),i=arguments[0][2].valueOf(),r=arguments[0][3].valueOf(),e=arguments[0][4].valueOf().toFixed(u),s=arguments[0][5].valueOf().toFixed(u)}else{u=6<arguments.length?arguments[6]:3;t=arguments[0].valueOf(),n=arguments[1].valueOf(),i=arguments[2].valueOf(),r=arguments[3].valueOf(),e=arguments[4].valueOf().toFixed(u),s=arguments[5].valueOf().toFixed(u)}return"matrix("+t+","+i+","+n+","+r+","+e+","+s+")"},b.rs=function(){var t,n,i,r;if(c.Ut(arguments[0])){var e=1<arguments.length?arguments[1]:3;t=arguments[0][0].valueOf().toFixed(e),n=arguments[0][1].valueOf().toFixed(e),i=arguments[0][2].valueOf().toFixed(e),r=arguments[0][3].valueOf().toFixed(e)}else{e=6<arguments.length?arguments[6]:3;t=arguments[0].valueOf().toFixed(e),n=arguments[1].valueOf().toFixed(e),i=arguments[2].valueOf().toFixed(e),r=arguments[3].valueOf().toFixed(e)}return"progid:DXImageTransform.Microsoft.Matrix(M11="+t+", M12="+n+", M21="+i+", M22="+r+", SizingMethod = 'auto expand')"},b.us=function(){var t=v.getComputedStyle(arguments[0],null),n=1<arguments.length?arguments[1]:new Array(2);return n[0]=t.getPropertyValue("width"),n[1]=t.getPropertyValue("height"),n[0]=parseFloat(n[0].substr(0,n[0].indexOf("px"))),n[1]=parseFloat(n[1].substr(0,n[1].indexOf("px"))),n},b.es=function(){var t=v.getComputedStyle(arguments[0],null),n=1<arguments.length?arguments[1]:new Array(2);return n[0]=t.getPropertyValue("left"),n[1]=t.getPropertyValue("top"),n[0]=parseFloat(n[0].substr(0,n[0].indexOf("px"))),n[1]=parseFloat(n[1].substr(0,n[1].indexOf("px"))),n},b.ls=function(){var t=v.getComputedStyle(arguments[0],null),n=1<arguments.length?arguments[1]:new Object;return n.top=t.getPropertyValue("border-top-width"),n.left=t.getPropertyValue("border-left-width"),n.right=t.getPropertyValue("border-right-width"),n.bottom=t.getPropertyValue("border-bottom-width"),n.top=parseFloat(n.top.substr(0,n.top.indexOf("px"))),n.left=parseFloat(n.left.substr(0,n.left.indexOf("px"))),n.right=parseFloat(n.right.substr(0,n.right.indexOf("px"))),n.bottom=parseFloat(n.bottom.substr(0,n.bottom.indexOf("px"))),n},b.fs=function(){var t=v.getComputedStyle(arguments[0],null),n=1<arguments.length?arguments[1]:new Object;return n.top=t.getPropertyValue("padding-top"),n.left=t.getPropertyValue("padding-left"),n.right=t.getPropertyValue("padding-right"),n.bottom=t.getPropertyValue("padding-bottom"),n.top=parseFloat(n.top.substr(0,n.top.indexOf("px"))),n.left=parseFloat(n.left.substr(0,n.left.indexOf("px"))),n.right=parseFloat(n.right.substr(0,n.right.indexOf("px"))),n.bottom=parseFloat(n.bottom.substr(0,n.bottom.indexOf("px"))),n},b.as=function(t){var n={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return void 0!==n[t.toLowerCase()]&&n[t.toLowerCase()]};var w=new Object;w.cs=new Object,w.cs.ws=++a.ft,w.cs.vs=++a.ft,w.cs.Ns=++a.ft,w.cs.bs=++a.ft,w.ys=new Object,w.ys.ms=1,w.ys.As=2,w.ds=new Object,o.J(w.ds,a.Ot),w.ps=new Object,o.J(w.ps,a.Ot);var d=new Object;d.Os=function(){f.Et.call(this);var i=this;this.js=new Array,this.ks=new Array,this.gs=null,this.xs=null,this.Ms={padding:0,top:0,position:"absolute",left:0,right:"inherit",width:"100%",height:"100%",margin:0},this._s={padding:0,top:0,position:"fixed",left:0,right:"inherit",width:"100%",height:"100%",margin:0},this.qt=new Array,this.qt.position="position",this.qt.display="display",this.qt.margin="margin",this.qt.marginLeft="margin-left",this.qt.marginRight="margin-right",this.qt.marginTop="margin-top",this.qt.marginBottom="margin-bottom",this.qt.padding="padding",this.qt.paddingLeft="padding-left",this.qt.paddingRight="padding-right",this.qt.paddingTop="padding-top",this.qt.paddingBottom="padding-bottom",this.qt.width="width",this.qt.height="height",this.qt.top="top",this.qt.bottom="bottom",this.qt.left="left",this.qt.right="right",this.qt.zIndex="z-index",this.qt.cursor="cursor",this.qt.backgroundColor="background-color",this.qt.backgroundImage="background-image",this.qt.backgroundRepeat="background-repeat",this.Es=function(){for(var t=i.Ss=null,n=0;n<i.js.length;n++)if(null!=(t=i.js[n].fullscreenElement||i.js[n].mozFullScreenElement||i.js[n].webkitFullscreenElement||i.js[n].msFullscreenElement)){i.Ss=t;break}null!=i.Ss?i.zs(new f.jt(w.cs.Ns)):(i.Is=null,i.zs(new f.jt(w.cs.bs)))},this.Ss=null,this.Is=null,this.Fs()===w.ys.ms&&this.Ds(document)},o._(d.Os,f.Et,w.ds),d.Os.prototype.destroy=function(){return(f.Et.prototype.destroy,f.Et.prototype.destroy.apply(this,arguments))+1},d.Os.prototype.Ts=function(t){return this.ks.push(t),this.Fs()===w.ys.ms&&this.Ds(t.Cs().ownerDocument),1},d.Os.prototype.Js=function(t){for(var n=new Array,i=null,r=0;r<this.ks.length;r++)this.Fs()===w.ys.ms&&(i=this.ks[r].Cs().ownerDocument,-1<n.indexOf(i)?n[n.indexOf(i)].nb+=1:(n.push(i),n[n.length-1].nb=1)),this.ks[r]===t&&this.ks.splice(r,1);if(this.Fs()===w.ys.ms)for(r=0;r<this.js.length;r++)-1<n.indexOf(this.js[r])&&1==n[n.indexOf(this.js[r])].nb&&n[n.indexOf(this.js[r])]!==document&&(this.js[r].removeEventListener("MSFullscreenChange",this.Es,!1),this.js[r].removeEventListener("webkitfullscreenchange",this.Es,!1),this.js[r].removeEventListener("mozfullscreenchange",this.Es,!1),this.js[r].removeEventListener("fullscreenchange",this.Es,!1),this.js.splice(r,1));return 1},d.Os.prototype.Ds=function(t){return-1==this.js.indexOf(t)?(this.Es(),this.js.push(t),t.addEventListener("MSFullscreenChange",this.Es,!1),t.addEventListener("webkitfullscreenchange",this.Es,!1),t.addEventListener("mozfullscreenchange",this.Es,!1),t.addEventListener("fullscreenchange",this.Es,!1),1):0},d.Os.prototype.Us=function(){return this.qt},d.Os.prototype.ii=function(t,n){if(null==n||"object"!=typeof n)return 0;for(var i in n)void 0!==this.qt[i]&&(t.style[i]=n[i]);return 1},d.Os.prototype.Bs=function(i){return this.el=i,this.getPropertyValue=function(t){var n=/(\-([a-z]){1})/g;return"float"==t&&(t="styleFloat"),n.test(t)&&(t=t.replace(n,function(){return arguments[2].toUpperCase()})),i.currentStyle[t]?i.currentStyle[t]:null},this},d.Os.prototype.Ps=function(t){var n=new Object;for(var i in this.qt)if("number"==typeof u.tweaks.io&&u.tweaks.io<=8){var r=this.Bs(t,null);n[i]=r.getPropertyValue(this.qt[i])}else{var e=t.ownerDocument,s=e.defaultView||e.parentWindow;n[i]=s.getComputedStyle(t,null).getPropertyValue(this.qt[i])}return n},d.Os.prototype.Ks=function(t){return this.gs=this.Ps(t),1},d.Os.prototype.Ls=function(t){if(""==this.gs.position||"static"==this.gs.position?this.Ms.position="absolute":"relative"==this.gs.position&&(this.Ms.position=this.gs.position),this.ii(t,this.Ms),this.ua()===w.ys.As){t.style.setProperty("top",-t.offsetParent.offsetTop+"px","important"),t.style.setProperty("left",-t.offsetParent.offsetLeft+"px","important");var n=v.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,i=v.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;t.style.setProperty("width",n+"px","important"),t.style.setProperty("height",i+"px","important")}return 1},d.Os.prototype.qs=function(){return 1},d.Os.prototype.Gs=function(t){return this.ii(t,this.gs),1},d.Os.prototype.Fs=function(){var t=document;return null!==this.Ss&&(t=this.Ss.ownerDocument),t.fullscreenEnabled||t.webkitFullscreenEnabled||t.mozFullScreenEnabled||t.msFullscreenEnabled?w.ys.ms:w.ys.As},d.Os.prototype.Hs=function(){return null!=this.Ss},d.Os.prototype.Xs=function(){if(this.Hs()){var t=document;if(null!==this.Ss&&(t=this.Ss.ownerDocument),this.zs(new f.jt(w.cs.vs)),this.ua()===w.ys.ms)return t.Qs?t.Qs():t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():t.msExitFullscreen&&t.msExitFullscreen(),1;this.ii(this.Ss,this.xs),this.Ss=null,this.Is=null,this.zs(new f.jt(w.cs.bs))}return 0},d.Os.prototype.Cs=function(){return this.Ss},d.Os.prototype.Vs=function(){return this.Is},d.Os.prototype.Ys=function(t){return null!=this.Ss?0:(this.Is=t,this.zs(new f.jt(w.cs.ws)),this.ua()===w.ys.ms?this.Is.Ss.requestFullscreen?this.Is.Ss.requestFullscreen():this.Is.Ss.mozRequestFullScreen?this.Is.Ss.mozRequestFullScreen():this.Is.Ss.webkitRequestFullscreen?(this.Is.Ss.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT),document.webkitCurrentFullScreenElement||this.Is.Ss.webkitRequestFullScreen()):this.Is.Ss.msRequestFullscreen&&this.Is.Ss.msRequestFullscreen():(this.Ss=this.Is.Ss,this.xs=this.Ps(this.Ss),this.ii(this.Ss,this._s),this.zs(new f.jt(w.cs.Ns))),1)},d.Ws=function(t){f.Et.call(this),void 0!==t?(this.Ss=t,u.tX.hv(this)):s.warn("Adways Fullscreen Helper: no container DOM Element given")},o._(d.Ws,f.Et,w.ps),d.Ws.prototype.destroy=function(){u.tX.Js(this);return(f.Et.prototype.destroy,f.Et.prototype.destroy.apply(this,arguments))+1},d.Ws.prototype.Hs=function(){return u.tX.Is===this},d.Ws.prototype.Ys=function(){return u.tX.Ys(this)},d.Ws.prototype.Cs=function(){return this.Ss};var y=new Object;y.$s=new Array,y.$s.push({macro:"%%timestamp%%",value:function(){return(new Date).getTime()}}),y.$s.push({macro:"%%random%%",value:function(){return Math.floor(1e8*Math.random())}}),y.tn=function(){for(var t=arguments[0],n=1<arguments.length?arguments[1]:y.$s,i=0;i<n.length;i++)for(var r=n[i].macro,e=n[i].value;-1<t.indexOf(r);)t=t.replace(r,e.call(r).toString());return t};var p=new Object;p.Th=Math.log(10),p.Ch=function(){for(var t=1;1+(t/=2)/2!=1;);return t},p.Jh=1e-6,p.Rh=Math.abs(Math.floor(Math.log(p.Jh)/p.Th)),p.Uh=Math.pow(10,p.Rh),p.Bh=function(){return Math.round(arguments[0]*p.Uh)/p.Uh},p.Zh=function(){var t=2<arguments.length?arguments[2]:p.Jh;return arguments[0]<arguments[1]-t?-1:arguments[0]>arguments[1]+t?1:0},p.Ph=function(){return 0==p.Zh.apply(null,arguments)},p.Kh=function(t,n,i){return n+t*(i-n)},p.Lh=function(t,n,i,r){var e=1-t;return e*e*n+2*t*e*i+t*t*r},p.qh=function(t,n,i,r,e){var s=1-t;return s*s*s*n+3*t*s*s*i+3*t*t*s*r+t*t*t*e},p.Gh=function(){for(var t=0,n=0,i=arguments[0].length-1;-1<i;--i)t+=(n=arguments[0][i])*n;return Math.sqrt(t)},p.Hh=function(){var t=arguments[0][0],n=arguments[0][1];return Math.sqrt(t*t+n*n)},p.Xh=function(){var t=2<arguments.length?arguments[2]:new Array(2);return t[0]=arguments[0][0]*arguments[1][0]+arguments[0][1]*arguments[1][1],t[1]=arguments[0][2]*arguments[1][0]+arguments[0][3]*arguments[1][1],t},p.Qh=function(){var t=2<arguments.length?arguments[2]:new Array(4);return t[0]=arguments[0][0]*arguments[1][0]+arguments[0][1]*arguments[1][2],t[1]=arguments[0][0]*arguments[1][1]+arguments[0][1]*arguments[1][3],t[2]=arguments[0][2]*arguments[1][0]+arguments[0][3]*arguments[1][2],t[3]=arguments[0][2]*arguments[1][1]+arguments[0][3]*arguments[1][3],t},p.Vh=function(){return arguments[0][0]*arguments[0][3]-arguments[0][1]*arguments[0][2]},p.Yh=function(){var t=2<arguments.length?arguments[2]:p.Vh(arguments[0]);if(0==p.Zh(t,0))return null;var n=1<arguments.length?arguments[1]:new Array(4);return n[0]=arguments[0][3]/t,n[1]=-arguments[0][1]/t,n[2]=-arguments[0][2]/t,n[3]=arguments[0][0]/t,n};var m=new Object;m.st=new Object,m.st.Wh="type.exceptions.ENUM",m.$h=new Object,o.J(m.$h),m.tr=new Object,o.J(m.tr,m.$h),m.ir=new Object,o.J(m.ir),m.sr=new Object,o.J(m.sr,m.ir),m.nr=new Object,o.J(m.nr),m.hr=new Object,o.J(m.hr,m.nr),m.rr=new Object,o.J(m.rr),m.ur=new Object,o.J(m.ur,m.rr),m.er=new Object,o.J(m.er),m.lr=new Object,o.J(m.lr,m.er);var A=new Object;A.or=function(){return("object"==typeof arguments[0]&&"value"in arguments[0]?arguments[0].value.valueOf():arguments[0].valueOf()).toString()},A.ar=function(){var t,n=Number.NaN;switch(typeof(t="object"==typeof arguments[0]&&"value"in arguments[0]?arguments[0].value.valueOf():arguments[0].valueOf())){case"boolean":n=t?1:0;break;case"number":n=t;break;case"string":switch(t.toLowerCase()){case"true":n=1;break;case"false":n=0;break;case"inf":case"+inf":case"infinity":case"+infinity":n=Number.POSITIVE_INFINITY;break;case"-inf":case"-infinity":n=Number.NEGATIVE_INFINITY;break;case"nan":n=Number.NaN;break;default:n=parseFloat(t)}}return n},A.cr=function(t){var n=new Object;return n.isSpecial=0,n.value=-1,isNaN(t)?n.isSpecial=3:t.valueOf()==Number.POSITIVE_INFINITY?n.isSpecial=2:t.valueOf()==Number.NEGATIVE_INFINITY&&(n.isSpecial=1),n.value=t.valueOf(),n},A.wr=function(t){return void 0===t.isSpecial||void 0===t.value?Number.NaN:3==t.isSpecial?Number.NaN:2==t.isSpecial?Number.POSITIVE_INFINITY:1==t.isSpecial?Number.NEGATIVE_INFINITY:0==t.isSpecial?t.value:void 0},A.vr=function(){var t,n=!1;switch(typeof(t="object"==typeof arguments[0]&&"value"in arguments[0]?arguments[0].value.valueOf():arguments[0].valueOf())){case"boolean":n=t;break;case"number":n=!isNaN(t)&&0!=t;break;case"string":switch(t.toLowerCase()){case"true":n=!0;break;case"false":n=!1;break;default:t=parseFloat(t),n=!isNaN(t)&&0!=t}}return n},A.Nr=function(){for(var t=1<arguments.length?arguments[1]:0,n=new Array(arguments[0].length),i=0;i<t;++i)n[i]=arguments[0][i];n[t]=A.or(arguments[0][t]);for(i=t+1;i<arguments[0].length;++i)n[i]=arguments[0][i];return n},A.br=function(){for(var t=1<arguments.length?arguments[1]:0,n=new Array(arguments[0].length),i=0;i<t;++i)n[i]=arguments[0][i];n[t]=A.ar(arguments[0][t]);for(i=t+1;i<arguments[0].length;++i)n[i]=arguments[0][i];return n},A.yr=function(){for(var t=1<arguments.length?arguments[1]:0,n=new Array(arguments[0].length),i=0;i<t;++i)n[i]=arguments[0][i];n[t]=A.vr(arguments[0][t]);for(i=t+1;i<arguments[0].length;++i)n[i]=arguments[0][i];return n},A.mr=function(){var t,n=new Array;if(t="object"==typeof arguments[0][0]&&"value"in arguments[0][0]?arguments[0][0].value.valueOf():arguments[0][0].valueOf(),c.Ut(t)&&1<t.length){n.push(new Array(A.ar(t[0]),A.ar(t[1])));for(var i=1;i<arguments[0].length;++i)n.push(arguments[0][i])}else if("object"==typeof t&&"x"in t&&"y"in t){n.push(new Array(A.ar(t.x),A.ar(t.y)));for(i=1;i<arguments[0].length;++i)n.push(arguments[0][i])}else if(1<arguments[0].length){n.push(new Array(A.ar(arguments[0][0]),A.ar(arguments[0][1])));for(i=2;i<arguments[0].length;++i)n.push(arguments[0][i])}else n.push(new Array(Number.NaN,Number.NaN));return n},A.Ar=function(){var t,n=new Array;if(t="object"==typeof arguments[0][0]&&"value"in arguments[0][0]?arguments[0][0].value.valueOf():arguments[0][0].valueOf(),c.Ut(t)&&2<t.length){n.push(new Array(A.ar(t[0]),A.ar(t[1]),A.ar(t[2])));for(var i=1;i<arguments[0].length;++i)n.push(arguments[0][i])}else if("object"==typeof t&&"x"in t&&"y"in t&&"z"in t){n.push(new Array(A.ar(t.x),A.ar(t.y),A.ar(t.z)));for(i=1;i<arguments[0].length;++i)n.push(arguments[0][i])}else if(2<arguments[0].length){n.push(new Array(A.ar(arguments[0][0]),A.ar(arguments[0][1]),A.ar(arguments[0][2])));for(i=3;i<arguments[0].length;++i)n.push(arguments[0][i])}else n.push(new Array(Number.NaN,Number.NaN,Number.NaN));return n},A.dr=function(){var t,n=new Array;if(t="object"==typeof arguments[0][0]&&"value"in arguments[0][0]?arguments[0][0].value.valueOf():arguments[0][0].valueOf(),c.Ut(t)&&3<t.length){n.push(new Array(A.ar(t[0]),A.ar(t[1]),A.ar(t[2]),A.ar(t[3])));for(var i=1;i<arguments[0].length;++i)n.push(arguments[0][i])}else if("object"==typeof t&&"x"in t&&"y"in t&&"z"in t&&"w"in t){n.push(new Array(A.ar(t.x),A.ar(t.y),A.ar(t.z),A.ar(t.w)));for(i=1;i<arguments[0].length;++i)n.push(arguments[0][i])}else if("object"==typeof t&&"a"in t&&"b"in t&&"c"in t&&"d"in t){n.push(new Array(A.ar(t.a),A.ar(t.b),A.ar(t.c),A.ar(t.d)));for(i=1;i<arguments[0].length;++i)n.push(arguments[0][i])}else if(3<arguments[0].length){n.push(new Array(A.ar(arguments[0][0]),A.ar(arguments[0][1]),A.ar(arguments[0][2]),A.ar(arguments[0][3])));for(i=4;i<arguments[0].length;++i)n.push(arguments[0][i])}else n.push(new Array(Number.NaN,Number.NaN,Number.NaN,Number.NaN));return n},A.pr=function(){var t,n=new Array;if(t="object"==typeof arguments[0][0]&&"value"in arguments[0][0]?arguments[0][0].value.valueOf():arguments[0][0].valueOf(),c.Ut(t)&&5<t.length){n.push(new Array(A.ar(t[0]),A.ar(t[1]),A.ar(t[2]),A.ar(t[3]),A.ar(t[4]),A.ar(t[5])));for(var i=1;i<arguments[0].length;++i)n.push(arguments[0][i])}else if("object"==typeof t&&"a"in t&&"b"in t&&"c"in t&&"d"in t&&"x"in t&&"y"in t){n.push(new Array(A.ar(t.a),A.ar(t.b),A.ar(t.c),A.ar(t.d),A.ar(t.x),A.ar(t.y)));for(i=1;i<arguments[0].length;++i)n.push(arguments[0][i])}else if(5<arguments[0].length){n.push(new Array(A.ar(arguments[0][0]),A.ar(arguments[0][1]),A.ar(arguments[0][2]),A.ar(arguments[0][3]),A.ar(arguments[0][4]),A.ar(arguments[0][5])));for(i=6;i<arguments[0].length;++i)n.push(arguments[0][i])}else n.push(new Array(Number.NaN,Number.NaN,Number.NaN,Number.NaN,Number.NaN,Number.NaN));return n};var g=new Object;g.Or=++a.ft,g.jr=++a.ft,g.Wh=++a.ft,g.kr=++a.ft,g.gr=++a.ft,g.$h=new Object,o.J(g.$h,m.$h),g.tr=new Object,o.J(g.tr,g.$h,m.tr),g.ir=new Object,o.J(g.ir,m.ir),g.sr=new Object,o.J(g.sr,g.ir,m.sr),g.nr=new Object,o.J(g.nr,m.nr),g.hr=new Object,o.J(g.hr,g.nr,m.hr),g.rr=new Object,o.J(g.rr,m.rr),g.ur=new Object,o.J(g.ur,g.rr,m.ur),g.er=new Object,o.J(g.er,m.er),g.lr=new Object,o.J(g.lr,g.er,m.lr);var N=new Object;N.xr=function(){f.Et.call(this),this.Mr=null,this._r=!1,this.value=0<arguments.length&&A.yr(arguments)[0]},o._(N.xr,f.Et,g.ir),N.xr.prototype.valueOf=function(){return this.value},N.xr.prototype.Er=function(){return this.Sr.apply(this,A.yr(arguments))},N.xr.prototype.Sr=function(){if(this.value==arguments[0])return 0;var t=this.value;return this.value=arguments[0],null==this.Mr&&this.zs(new f.kt(g.jr,t,1<arguments.length?arguments[1]:null)),1},N.xr.prototype.zr=function(){return this.Ir.apply(this,A.yr(arguments))},N.xr.prototype.Ir=function(){var t=new Array(arguments.length);t[0]=this.value&&arguments[0];for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.xr.prototype.Fr=function(){return this.Dr.apply(this,A.yr(arguments))},N.xr.prototype.Dr=function(){var t=new Array(arguments.length);t[0]=this.value||arguments[0];for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.xr.prototype.Tr=function(){return this.Cr.apply(this,A.yr(arguments))},N.xr.prototype.Cr=function(){var t=new Array(arguments.length);t[0]=this.value?!arguments[0]:arguments[0];for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.xr.prototype.Jr=function(){var t=new Array;t.push(!this.value);for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.xr.prototype.Rr=function(){return null==this.Mr?(this._r=0<arguments.length&&arguments[0].valueOf(),this.Mr=new f.kt(g.jr,this.valueOf()),1):0},N.xr.prototype.Ur=function(){if(null==this.Mr)return-1;var t=this.Mr;return(arguments.length<=2||arguments[2])&&this.Br(),this._r||this.value!=t.Zr()||1<arguments.length&&arguments[1]?(this.zs(t,0<arguments.length?arguments[0]:this.Pr()),1):0},N.xr.prototype.Br=function(){return null!=this.Mr?(this.Mr=null,1):0},N.xr.prototype.Kr=function(){return this.Mr},N.xr.prototype.Lr=function(){return null!=this.Mr&&(fireArmedBooleanEventAnyway||this.value!=this.Mr.Zr())},N.qr=function(){f.Et.call(this),this.Mr=null,this._r=!1,this.value=0<arguments.length&&A.yr(arguments)[0]},o._(N.qr,f.Et,g.sr),N.qr.prototype.valueOf=function(){return this.value},N.qr.prototype.Er=function(){return this.Sr.apply(this,A.yr(arguments))},N.qr.prototype.Sr=function(){if(this.value==arguments[0])return 0;var t=this.value;return this.value=arguments[0],null==this.Mr&&this.zs(new f.kt(g.jr,t,1<arguments.length?arguments[1]:null)),1},N.qr.prototype.zr=function(){return this.Ir.apply(this,A.yr(arguments))},N.qr.prototype.Ir=function(){var t=new Array(arguments.length);t[0]=this.value&&arguments[0];for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.qr.prototype.Fr=function(){return this.Dr.apply(this,A.yr(arguments))},N.qr.prototype.Dr=function(){var t=new Array(arguments.length);t[0]=this.value||arguments[0];for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.qr.prototype.Tr=function(){return this.Cr.apply(this,A.yr(arguments))},N.qr.prototype.Cr=function(){var t=new Array(arguments.length);t[0]=this.value?!arguments[0]:arguments[0];for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.qr.prototype.Jr=function(){var t=new Array;t.push(!this.value);for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.qr.prototype.Rr=function(){return null==this.Mr?(this._r=0<arguments.length&&arguments[0].valueOf(),this.Mr=new f.kt(g.jr,this.valueOf()),1):0},N.qr.prototype.Ur=function(){if(null==this.Mr)return-1;var t=this.Mr;return(arguments.length<=2||arguments[2])&&this.Br(),this._r||this.value!=t.Zr()||1<arguments.length&&arguments[1]?(this.zs(t,0<arguments.length?arguments[0]:this.Pr()),1):0},N.qr.prototype.Br=function(){return null!=this.Mr?(this.Mr=null,1):0},N.qr.prototype.Kr=function(){return this.Mr},N.qr.prototype.Lr=function(){return null!=this.Mr&&(fireArmedBooleanEventAnyway||this.value!=this.Mr.Zr())},N.Gr=function(){f.Et.call(this),this.Hr=null,this.Xr=!1,this.value=0<arguments.length?A.br(arguments)[0]:0},o._(N.Gr,f.Et,g.$h),N.Gr.prototype.valueOf=function(){return this.value},N.Gr.prototype.Er=function(){return this.Sr.apply(this,A.br(arguments))},N.Gr.prototype.Sr=function(){if(isNaN(arguments[0])&&isNaN(this.value))return 0;if(isNaN(arguments[0])||isNaN(this.value)||0!=p.Zh(this.value,arguments[0])){var t=this.value;return this.value=arguments[0],null==this.Hr&&this.zs(new f.kt(g.Or,t,1<arguments.length?arguments[1]:null)),1}return 0},N.Gr.prototype.Qr=function(){return this.Vr.apply(this,A.br(arguments))},N.Gr.prototype.Vr=function(){var t=new Array(arguments.length);t[0]=this.value+arguments[0];for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.Gr.prototype.Yr=function(){return this.Wr.apply(this,A.br(arguments))},N.Gr.prototype.Wr=function(){var t=new Array(arguments.length);t[0]=this.value-arguments[0];for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.Gr.prototype.$r=function(){return this.tu.apply(this,A.br(arguments))},N.Gr.prototype.tu=function(){var t=new Array(arguments.length);t[0]=this.value*arguments[0];for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.Gr.prototype.iu=function(){return this.su.apply(this,A.br(arguments))},N.Gr.prototype.su=function(){var t=new Array(arguments.length);t[0]=this.value/arguments[0];for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.Gr.prototype.nu=function(){return this.hu.apply(this,A.br(arguments))},N.Gr.prototype.hu=function(){var t=new Array(arguments.length);t[0]=Math.min(this.value,arguments[0]);for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.Gr.prototype.ru=function(){return this.uu.apply(this,A.br(arguments))},N.Gr.prototype.uu=function(){var t=new Array(arguments.length);t[0]=Math.max(this.value,arguments[0]);for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.Gr.prototype.eu=function(){return this.lu.apply(this,A.br(arguments))},N.Gr.prototype.lu=function(){var t=new Array(arguments.length);t[0]=this.value%arguments[0];for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.Gr.prototype.fu=function(){return this.ou.apply(this,A.br(arguments))},N.Gr.prototype.ou=function(){var t=new Array(arguments.length);t[0]=Math.pow(this.value,arguments[0]);for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.Gr.prototype.au=function(){var t=new Array;t.push(Math.round(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Gr.prototype.cu=function(){var t=new Array;t.push(Math.ceil(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Gr.prototype.wu=function(){var t=new Array;t.push(Math.floor(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Gr.prototype.vu=function(){var t=new Array;t.push(Math.abs(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Gr.prototype.Nu=function(){var t=new Array;t.push(Math.exp(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Gr.prototype.bu=function(){var t=new Array;t.push(Math.acos(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Gr.prototype.yu=function(){var t=new Array;t.push(Math.asin(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Gr.prototype.mu=function(){var t=new Array;t.push(Math.atan(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Gr.prototype.Au=function(){var t=new Array;t.push(Math.cos(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Gr.prototype.du=function(){var t=new Array;t.push(Math.sin(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Gr.prototype.pu=function(){var t=new Array;t.push(Math.tan(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Gr.prototype.Ou=function(){var t=new Array;t.push(Math.sqrt(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Gr.prototype.ju=function(){var t=new Array;t.push(Math.log(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Gr.prototype.ku=function(){var t=new Array(arguments.length+1);t[0]=this.value*Math.random();for(var n=0;n<arguments.length;++n)t[n+1]=arguments[n];return this.Sr.apply(this,t),this},N.Gr.prototype.gu=function(){return null==this.Hr?(this.Xr=0<arguments.length&&arguments[0].valueOf(),this.Hr=new f.kt(g.Or,this.valueOf()),1):0},N.Gr.prototype.xu=function(){if(null==this.Hr)return-1;var t=this.Hr;(arguments.length<=2||arguments[2])&&this.Mu();var n=t.Zr(),i=isNaN(n),r=isNaN(this.value);return this.Xr||i&&!r||!i&&r||!i&&!r&&0!=p.Zh(this.value,n)||1<arguments.length&&arguments[1]?(this.zs(t,0<arguments.length?arguments[0]:this.Pr()),1):0},N.Gr.prototype.Mu=function(){return null!=this.Hr?(this.Hr=null,1):0},N.Gr.prototype._u=function(){return this.Hr},N.Gr.prototype.Eu=function(){if(null==this.Hr)return!1;var t=this.Hr.Zr(),n=isNaN(t),i=isNaN(this.value);return this.Xr||n&&!i||!n&&i||!n&&!i&&0!=p.Zh(this.value,t)},N.Su=function(){f.Et.call(this),this.Hr=null,this.Xr=!1,this.value=0<arguments.length?A.br(arguments)[0]:0},o._(N.Su,f.Et,g.tr),N.Su.prototype.valueOf=function(){return this.value},N.Su.prototype.Er=function(){return this.Sr.apply(this,A.br(arguments))},N.Su.prototype.Sr=function(){if(isNaN(arguments[0])&&isNaN(this.value))return 0;if(isNaN(arguments[0])||isNaN(this.value)||0!=p.Zh(this.value,arguments[0])){var t=this.value;return this.value=arguments[0],null==this.Hr&&this.zs(new f.kt(g.Or,t,1<arguments.length?arguments[1]:null)),1}return 0},N.Su.prototype.Qr=function(){return this.Vr.apply(this,A.br(arguments))},N.Su.prototype.Vr=function(){var t=new Array(arguments.length);t[0]=this.value+arguments[0];for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.Su.prototype.Yr=function(){return this.Wr.apply(this,A.br(arguments))},N.Su.prototype.Wr=function(){var t=new Array(arguments.length);t[0]=this.value-arguments[0];for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.Su.prototype.$r=function(){return this.tu.apply(this,A.br(arguments))},N.Su.prototype.tu=function(){var t=new Array(arguments.length);t[0]=this.value*arguments[0];for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.Su.prototype.iu=function(){return this.su.apply(this,A.br(arguments))},N.Su.prototype.su=function(){var t=new Array(arguments.length);t[0]=this.value/arguments[0];for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.Su.prototype.nu=function(){return this.hu.apply(this,A.br(arguments))},N.Su.prototype.hu=function(){var t=new Array(arguments.length);t[0]=Math.min(this.value,arguments[0]);for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.Su.prototype.ru=function(){return this.uu.apply(this,A.br(arguments))},N.Su.prototype.uu=function(){var t=new Array(arguments.length);t[0]=Math.max(this.value,arguments[0]);for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.Su.prototype.eu=function(){return this.lu.apply(this,A.br(arguments))},N.Su.prototype.lu=function(){var t=new Array(arguments.length);t[0]=this.value%arguments[0];for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.Su.prototype.fu=function(){return this.ou.apply(this,A.br(arguments))},N.Su.prototype.ou=function(){var t=new Array(arguments.length);t[0]=Math.pow(this.value,arguments[0]);for(var n=1;n<arguments.length;++n)t[n]=arguments[n];return this.Sr.apply(this,t),this},N.Su.prototype.au=function(){var t=new Array;t.push(Math.round(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Su.prototype.cu=function(){var t=new Array;t.push(Math.ceil(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Su.prototype.wu=function(){var t=new Array;t.push(Math.floor(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Su.prototype.vu=function(){var t=new Array;t.push(Math.abs(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Su.prototype.Nu=function(){var t=new Array;t.push(Math.exp(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Su.prototype.bu=function(){var t=new Array;t.push(Math.acos(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Su.prototype.yu=function(){var t=new Array;t.push(Math.asin(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Su.prototype.mu=function(){var t=new Array;t.push(Math.atan(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Su.prototype.Au=function(){var t=new Array;t.push(Math.cos(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Su.prototype.du=function(){var t=new Array;t.push(Math.sin(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Su.prototype.pu=function(){var t=new Array;t.push(Math.tan(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Su.prototype.Ou=function(){var t=new Array;t.push(Math.sqrt(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Su.prototype.ju=function(){var t=new Array;t.push(Math.log(this.value));for(var n=0;n<arguments.length;++n)t.push(arguments[n]);return this.Sr.apply(this,t),this},N.Su.prototype.ku=function(){var t=new Array(arguments.length+1);t[0]=this.value*Math.random();for(var n=0;n<arguments.length;++n)t[n+1]=arguments[n];return this.Sr.apply(this,t),this},N.Su.prototype.gu=function(){return null==this.Hr?(this.Xr=0<arguments.length&&arguments[0].valueOf(),this.Hr=new f.kt(g.Or,this.valueOf()),1):0},N.Su.prototype.xu=function(){if(null==this.Hr)return-1;var t=this.Hr;(arguments.length<=2||arguments[2])&&this.Mu();var n=t.Zr(),i=isNaN(n),r=isNaN(this.value);return this.Xr||i&&!r||!i&&r||!i&&!r&&0!=p.Zh(this.value,n)||1<arguments.length&&arguments[1]?(this.zs(t,0<arguments.length?arguments[0]:this.Pr()),1):0},N.Su.prototype.Mu=function(){return null!=this.Hr?(this.Hr=null,1):0},N.Su.prototype._u=function(){return this.Hr},N.Su.prototype.Eu=function(){if(null==this.Hr)return!1;var t=this.Hr.Zr(),n=isNaN(t),i=isNaN(this.value);return this.Xr||n&&!i||!n&&i||!n&&!i&&0!=p.Zh(this.value,t)},N.zu=function(){if(f.Et.call(this),this.Iu=null,this.Fu=arguments[0],!this.Du(arguments[1]))throw new x.H(m.st,"enum state not in enum values");this.value=arguments[1]},o._(N.zu,f.Et,g.nr),N.zu.prototype.Du=function(){if(c.Ut(this.Fu))return 0<=this.Fu.indexOf(arguments[0]);var t=!1;for(var n in this.Fu)t=t||this.Fu[n]===arguments[0];return t},N.zu.prototype.valueOf=function(){return this.value},N.zu.prototype.Tu=function(){return this.Fu},N.zu.prototype.Cu=function(){if(this.Fu=arguments[0],c.Ut(this.Fu))this.value=this.Fu[this.Fu.length-1];else{for(var t in this.Fu)t;this.value=this.Fu[t]}return 1},N.zu.prototype.Er=function(){return this.Sr.apply(this,arguments)},N.zu.prototype.Sr=function(){if(!this.Du(arguments[0]))return 0;if(this.value===arguments[0])return 0;var t=this.value;return this.value=arguments[0],null==this.Iu&&this.zs(new f.kt(g.Wh,t,1<arguments.length?arguments[1]:null)),1},N.zu.prototype.Ju=function(){return null==this.Iu?(this.Iu=new f.kt(g.Wh,this.valueOf(),0<arguments.length?arguments[0]:null),1):0},N.zu.prototype.Ru=function(){if(null==this.Iu)return-1;var t=this.Iu;return(arguments.length<=2||arguments[2])&&this.Uu(),this.value!==t.Zr()||1<arguments.length&&arguments[1]?(this.zs(t,0<arguments.length?arguments[0]:this.Pr()),1):0},N.zu.prototype.Uu=function(){return null!=this.Iu?(this.Iu=null,1):0},N.zu.prototype.Bu=function(){return this.Iu},N.zu.prototype.Zu=function(){return null!=this.Iu&&this.value!==this.Iu.Zr()},N.Pu=function(){if(f.Et.call(this),this.Iu=null,this.Fu=arguments[0],!this.Du(arguments[1]))throw new x.H(m.st,"enum state not in enum values");this.value=arguments[1]},o._(N.Pu,f.Et,g.hr),N.Pu.prototype.Du=function(){if(c.Ut(this.Fu))return 0<=this.Fu.indexOf(arguments[0]);var t=!1;for(var n in this.Fu)t=t||this.Fu[n]===arguments[0];return t},N.Pu.prototype.valueOf=function(){return this.value},N.Pu.prototype.Tu=function(){return this.Fu},N.Pu.prototype.Cu=function(){if(this.Fu=arguments[0],c.Ut(this.Fu))this.value=this.Fu[this.Fu.length-1];else{for(var t in this.Fu)t;this.value=this.Fu[t]}return 1},N.Pu.prototype.Er=function(){return this.Sr.apply(this,arguments)},N.Pu.prototype.Sr=function(){if(!this.Du(arguments[0]))return 0;if(this.value===arguments[0])return 0;var t=this.value;return this.value=arguments[0],null==this.Iu&&this.zs(new f.kt(g.Wh,t,1<arguments.length?arguments[1]:null)),1},N.Pu.prototype.Ju=function(){return null==this.Iu?(this.Iu=new f.kt(g.Wh,this.valueOf(),0<arguments.length?arguments[0]:null),1):0},N.Pu.prototype.Ru=function(){if(null==this.Iu)return-1;var t=this.Iu;return(arguments.length<=2||arguments[2])&&this.Uu(),this.value!==t.Zr()||1<arguments.length&&arguments[1]?(this.zs(t,0<arguments.length?arguments[0]:this.Pr()),1):0},N.Pu.prototype.Uu=function(){return null!=this.Iu?(this.Iu=null,1):0},N.Pu.prototype.Bu=function(){return this.Iu},N.Pu.prototype.Zu=function(){return null!=this.Iu&&this.value!==this.Iu.Zr()},N.Ku=function(){f.Et.call(this),this.Lu=null,this.value=0<arguments.length?A.Nr(arguments)[0]:0},o._(N.Ku,f.Et,g.er),N.Ku.prototype.valueOf=function(){return this.value},N.Ku.prototype.Er=function(){return this.Sr.apply(this,A.Nr(arguments))},N.Ku.prototype.Sr=function(){if(0==this.value.localeCompare(arguments[0]))return 0;var t=this.value;return this.value=arguments[0],null==this.Lu&&this.zs(new f.kt(g.gr,t,1<arguments.length?arguments[1]:null)),1},N.Ku.prototype.qu=function(){return null==this.Lu?(this.Lu=new f.kt(g.gr,this.valueOf(),0<arguments.length?arguments[0]:null),1):0},N.Ku.prototype.Gu=function(){if(null==this.Lu)return-1;var t=this.Lu;return(arguments.length<=2||arguments[2])&&this.Hu(),0!=this.value.localeCompare(t.Zr())||1<arguments.length&&arguments[1]?(this.zs(t,0<arguments.length?arguments[0]:this.Pr()),1):0},N.Ku.prototype.Hu=function(){return null!=this.Lu?(this.Lu=null,1):0},N.Xu=function(){f.Et.call(this),this.Lu=null,this.value=0<arguments.length?A.Nr(arguments)[0]:0},o._(N.Xu,f.Et,g.lr),N.Xu.prototype.valueOf=function(){return this.value},N.Xu.prototype.Er=function(){return this.Sr.apply(this,A.Nr(arguments))},N.Xu.prototype.Sr=function(){if(0==this.value.localeCompare(arguments[0]))return 0;var t=this.value;return this.value=arguments[0],null==this.Lu&&this.zs(new f.kt(g.gr,t,1<arguments.length?arguments[1]:null)),1},N.Xu.prototype.qu=function(){return null==this.Lu?(this.Lu=new f.kt(g.gr,this.valueOf(),0<arguments.length?arguments[0]:null),1):0},N.Xu.prototype.Gu=function(){if(null==this.Lu)return-1;var t=this.Lu;return(arguments.length<=2||arguments[2])&&this.Hu(),0!=this.value.localeCompare(t.Zr())||1<arguments.length&&arguments[1]?(this.zs(t,0<arguments.length?arguments[0]:this.Pr()),1):0},N.Xu.prototype.Hu=function(){return null!=this.Lu?(this.Lu=null,1):0};var z=new Object;z.Qu=new Object,z.Qu.Vu=0,z.Qu.Yu=1,z.Qu.Wu=2,z.Qu.$u=3,z.Qu.te=4,z.Qu.ie=5,z.Qu.se=6,z.Qu.ne=7,z.st=new Object,z.st.he="time.BAD_UNIT";var F=new Object;F.re=function(){var t,n=new Object;if(2==arguments.length)n.ue=arguments[0][z.Qu.Yu].valueOf(),n.ee=arguments[0][z.Qu.Wu].valueOf(),n.le=arguments[0][z.Qu.$u].valueOf(),n.fe=arguments[0][z.Qu.te].valueOf(),n.oe=arguments[0][z.Qu.ie].valueOf(),t=arguments[1].valueOf();else{var i=arguments[0].valueOf(),r=arguments[1].valueOf();if(r==(t=arguments[2].valueOf()))return arguments[0].valueOf();switch(r){case z.Qu.Yu:n=F.ae(i);break;case z.Qu.Wu:n=F.ce(i);break;case z.Qu.$u:n=F.we(i);break;case z.Qu.te:n=F.ve(i);break;case z.Qu.ie:n=F.Ne(i);break;default:throw"not implemented yet"}}switch(t){case z.Qu.Yu:return n.ue+1e3*n.ee+6e4*n.le+36e5*n.fe+864e5*n.oe;case z.Qu.Wu:return n.ue/1e3+n.ee+60*n.le+3600*n.fe+86400*n.oe;case z.Qu.$u:return n.ue/6e4+n.ee/60+n.le+60*n.fe+1440*n.oe;case z.Qu.te:return n.ue/36e5+n.ee/3600+n.le/60+n.fe+24*n.oe;case z.Qu.ie:return n.ue/864e5+n.ee/86400+n.le/1440+n.fe/24+n.oe;default:throw"not implemented yet"}},F.ae=function(t){var n=1<arguments.length?arguments[1]:Number.NEGATIVE_INFINITY,i=2<arguments.length?arguments[2]:Number.POSITIVE_INFINITY;i<n&&(i=n);var r=new Object;return isNaN(t)?null:(n<=z.Qu.Yu&&(r.ue=Math.floor(t)),i>z.Qu.Yu&&(void 0!==r.ue&&(r.ue%=1e3),n<=z.Qu.Wu&&(r.ee=Math.floor(t/1e3)),i>z.Qu.Wu&&(void 0!==r.ee&&(r.ee%=60),n<=z.Qu.$u&&(r.le=Math.floor(t/6e4)),i>z.Qu.$u&&(void 0!==r.le&&(r.le%=60),n<=z.Qu.te&&(r.fe=Math.floor(t/36e5)),i>z.Qu.te&&(void 0!==r.fe&&(r.fe%=24),r.oe=Math.floor(t/864e5))))),r)},F.ce=function(t){var n=1<arguments.length?arguments[1]:Number.NEGATIVE_INFINITY,i=2<arguments.length?arguments[2]:Number.POSITIVE_INFINITY;i<n&&(i=n);var r=new Object;return isNaN(t)?null:(n<=z.Qu.Yu&&(r.ue=Math.floor(1e3*t)),i>z.Qu.Yu&&(void 0!==r.ue&&(r.ue%=1e3),n<=z.Qu.Wu&&(r.ee=Math.floor(t)),i>z.Qu.Wu&&(void 0!==r.ee&&(r.ee%=60),n<=z.Qu.$u&&(r.le=Math.floor(t/60)),i>z.Qu.$u&&(void 0!==r.le&&(r.le%=60),n<=z.Qu.te&&(r.fe=Math.floor(t/3600)),i>z.Qu.te&&(void 0!==r.fe&&(r.fe%=24),r.oe=Math.floor(t/86400))))),r)},F.we=function(t){var n=1<arguments.length?arguments[1]:Number.NEGATIVE_INFINITY,i=2<arguments.length?arguments[2]:Number.POSITIVE_INFINITY;i<n&&(i=n);var r=new Object;return isNaN(t)?null:(n<=z.Qu.Yu&&(r.ue=Math.floor(6e4*t)),i>z.Qu.Yu&&(void 0!==r.ue&&(r.ue%=1e3),n<=z.Qu.Wu&&(r.ee=Math.floor(60*t)),i>z.Qu.Wu&&(void 0!==r.ee&&(r.ee%=60),n<=z.Qu.$u&&(r.le=Math.floor(t)),i>z.Qu.$u&&(void 0!==r.le&&(r.le%=60),n<=z.Qu.te&&(r.fe=Math.floor(t/60)),i>z.Qu.te&&(void 0!==r.fe&&(r.fe%=24),r.oe=Math.floor(t/1440))))),r)},F.ve=function(t){var n=1<arguments.length?arguments[1]:Number.NEGATIVE_INFINITY,i=2<arguments.length?arguments[2]:Number.POSITIVE_INFINITY;i<n&&(i=n);var r=new Object;return isNaN(t)?null:(n<=z.Qu.Yu&&(r.ue=Math.floor(36e5*t)),i>z.Qu.Yu&&(void 0!==r.ue&&(r.ue%=1e3),n<=z.Qu.Wu&&(r.ee=Math.floor(3600*t)),i>z.Qu.Wu&&(void 0!==r.ee&&(r.ee%=60),n<=z.Qu.$u&&(r.le=Math.floor(60*t)),i>z.Qu.$u&&(void 0!==r.le&&(r.le%=60),n<=z.Qu.te&&(r.fe=Math.floor(t)),i>z.Qu.te&&(void 0!==r.fe&&(r.fe%=24),r.oe=Math.floor(t/24))))),r)},F.Ne=function(t){var n=1<arguments.length?arguments[1]:Number.NEGATIVE_INFINITY,i=2<arguments.length?arguments[2]:Number.POSITIVE_INFINITY;i<n&&(i=n);var r=new Object;return isNaN(t)?null:(n<=z.Qu.Yu&&(r.ue=Math.floor(864e5*t)),i>z.Qu.Yu&&(void 0!==r.ue&&(r.ue%=1e3),n<=z.Qu.Wu&&(r.ee=Math.floor(86400*t)),i>z.Qu.Wu&&(void 0!==r.ee&&(r.ee%=60),n<=z.Qu.$u&&(r.le=Math.floor(1440*t)),i>z.Qu.$u&&(void 0!==r.le&&(r.le%=60),n<=z.Qu.te&&(r.fe=Math.floor(24*t)),i>z.Qu.te&&(void 0!==r.fe&&(r.fe%=24),r.oe=Math.floor(t))))),r)},F.be=function(t){var n,i=1<arguments.length?arguments[1]:z.Qu.Wu,r="d",e="h",s="m",u="s",h="ms",o=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,f=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,l=!1,w=!1,v=!1,b=!1,d=!1,y=!1,p=!1,m=!1,A=!1,g="";if(2<arguments.length&&null!=arguments[2]){"string"==typeof arguments[2].dSym&&(r=arguments[2].dSym),"string"==typeof arguments[2].hSym&&(e=arguments[2].hSym),"string"==typeof arguments[2].mSym&&(s=arguments[2].mSym),"string"==typeof arguments[2].sSym&&(u=arguments[2].sSym),"string"==typeof arguments[2].msSym&&(h=arguments[2].msSym),"boolean"==typeof arguments[2].forceDisplayDay&&(d=arguments[2].forceDisplayDay),"boolean"==typeof arguments[2].forceDisplayHour&&(b=arguments[2].forceDisplayHour),"boolean"==typeof arguments[2].forceDisplayMinute&&(v=arguments[2].forceDisplayMinute),"boolean"==typeof arguments[2].forceDisplaySecond&&(w=arguments[2].forceDisplaySecond),"boolean"==typeof arguments[2].forceDisplayMillisecond&&(l=arguments[2].forceDisplayMillisecond),"boolean"==typeof arguments[2].allDigitsDay&&arguments[2].allDigitsDay,"boolean"==typeof arguments[2].allDigitsHour&&(A=arguments[2].allDigitsHour),"boolean"==typeof arguments[2].allDigitsMinute&&(m=arguments[2].allDigitsMinute),"boolean"==typeof arguments[2].allDigitsSecond&&(p=arguments[2].allDigitsSecond),"boolean"==typeof arguments[2].allDigitsMillisecond&&(y=arguments[2].allDigitsMillisecond),"string"==typeof arguments[2].spacer&&(g=arguments[2].spacer);var N=arguments[2].cutFrom;if("number"==typeof N)switch(N){case z.Qu.ie:case z.Qu.te:case z.Qu.$u:case z.Qu.Wu:case z.Qu.Yu:f=N}if("number"==typeof(N=arguments[2].cutTo))switch(N){case z.Qu.ie:case z.Qu.te:case z.Qu.$u:case z.Qu.Wu:case z.Qu.Yu:c=N}if("number"==typeof(N=arguments[2].low))switch(N){case z.Qu.ie:case z.Qu.te:case z.Qu.$u:case z.Qu.Wu:case z.Qu.Yu:o=N}if("number"==typeof(N=arguments[2].high))switch(N){case z.Qu.ie:case z.Qu.te:case z.Qu.$u:case z.Qu.Wu:case z.Qu.Yu:a=N}}switch(f<c&&(c=f),i){case z.Qu.Yu:n=F.ae(t,o,a);break;case z.Qu.Wu:n=F.ce(t,o,a);break;case z.Qu.$u:n=F.we(t,o,a);break;case z.Qu.te:n=F.ve(t,o,a);break;case z.Qu.ie:n=F.Ne(t,o,a);break;default:throw new x.H(z.st.he)}if(null==n)return"??";var j="",O=!1,k=!1;void 0===n.oe||!d&&0==n.oe||(O||(O=f==z.Qu.ie),j+=n.oe,j+=r,k=!0);var M=!1;if(O&&(M=c>z.Qu.te),M||(void 0===n.fe||!b&&0==n.fe||(O||(O=f==z.Qu.te),k&&(j+=g),A&&n.fe<10&&(j+="0"),j+=n.fe,j+=e,k=!0),M=!1,O&&(M=c>z.Qu.$u),M||(void 0===n.le||!v&&0==n.le||(O||(O=f==z.Qu.$u),k&&(j+=g),m&&n.le<10&&(j+="0"),j+=n.le,j+=s,k=!0),M=!1,O&&(M=c>z.Qu.Wu),M||(void 0===n.ee||!w&&0==n.ee||(O||(O=f==z.Qu.Wu),k&&(j+=g),p&&n.ee<10&&(j+="0"),j+=n.ee,j+=u,k=!0),M=!1,O&&(M=c>z.Qu.Yu),M||void 0===n.ue||!l&&0==n.ue||(k&&(j+=g),y&&n.ue<100&&(j+="0",n.ue<10&&(j+="0")),j+=n.ue,j+=h)))),""==j)switch(o){case z.Qu.Yu:j="0"+h;break;case z.Qu.Wu:j="0"+u;break;case z.Qu.$u:j="0"+s;break;case z.Qu.te:j="0"+e;break;case z.Qu.ie:j="0"+r;break;default:j="00"}return j};var j=new Object;j.cs=new Object,j.cs.dm=++a.ft,j.VA=new Object,j.VA.rp=0,j.VA.mS=1,j.VA.AS=2,j.VA.dS=3,j.VA.pS=4,j.VA.OS=5,"undefined"!=typeof JSON&&null!=JSON||s.warn('"JSON" object unavailable, some operations will fail...');var O=new Object;O.jS=function(){f.Et.call(this),this.url=null,this.method="GET",this.headers=new Object,this.data=null,this.responseText="",this.contentType="text/html",this.kS=null,this.gS=0,this.xS=!0,this.MS=new XMLHttpRequest,"withCredentials"in this.MS||("undefined"!=typeof XDomainRequest?(this.xS=!1,this.MS=new XDomainRequest):this.MS=null),null!=this.MS?this.state=j.VA.mS:this.state=j.VA.rp;var t=this;this._S=function(){t.xS?b.ri.zi.browser[0].identifier==b.ri.fi?t.MS.onload=null:b.Ci(t.MS,"loadend",t._S):t.MS.onload=null,t.responseText=t.MS.responseText,t.gS=new Date-t.kS,t.state=j.VA.OS,t.zs(new f.jt(j.cs.dm))}},o._(O.jS,f.Et),O.jS.ES=function(t,n){return null!=t&&(-1<t.indexOf("?")?t+="&"+n:t+="?"+n),t},O.jS.SS=function(t,n){return"number"==typeof n?n==Number.POSITIVE_INFINITY?"Infinity":n==Number.NEGATIVE_INFINITY?"-Infinity":isNaN(n)?"NaN":n:n},O.jS.zS=function(t,n){return"string"==typeof n?"Infinity"===n?Number.POSITIVE_INFINITY:"-Infinity"===n?Number.NEGATIVE_INFINITY:"NaN"===n?Number.NaN:"obf_+inf"===n?Number.POSITIVE_INFINITY:"obf_-inf"===n?Number.NEGATIVE_INFINITY:"obf_nan"===n?Number.NaN:n:n},O.jS.prototype.destroy=function(){var t=null;return t=(f.Et.prototype.destroy,f.Et.prototype.destroy.apply(this,arguments)),this.xS?b.ri.zi.browser[0].identifier==b.ri.fi?this.MS.onload=null:b.Ci(this.MS,"loadend",this._S):this.MS.onload=null,t+1},O.jS.prototype.KA=function(t){return this.url=t,1},O.jS.prototype.IS=function(){return this.contentType=arguments[0],1},O.jS.prototype.FS=function(t){return this.method=t,1},O.jS.prototype.DS=function(t){return this.headers=t,1},O.jS.prototype.TS=function(t,n){return this.headers[t]=n,1},O.jS.prototype.CS=function(t){this.data=JSON.stringify(t,O.jS.SS)},O.jS.prototype.JS=function(t){this.data=t},O.jS.prototype.RS=function(){return this.responseText},O.jS.prototype.Dd=function(){return this.state},O.jS.prototype.US=function(){return void 0!==this.responseText&&null!=this.responseText&&""!=this.responseText?JSON.parse(this.responseText,O.jS.zS):null},O.jS.prototype.BS=function(){return this.gS},O.jS.prototype.ZS=function(){return this.MS},O.jS.prototype.PS=function(t){return void 0!==t.split("?")[1]},O.jS.prototype.KS=function(){return this.state==j.VA.mS?(this.state=j.VA.AS,this.zs(new f.jt(j.cs.dm)),this.kS=new Date,this.LS(),1):0},O.jS.prototype.LS=function(){this.state=j.VA.dS,this.zs(new f.jt(j.cs.dm)),this.qS()},O.jS.prototype.qS=function(){var t=this.url;if(this.xS){for(var n in this.MS.open(this.method,t,!0),this.headers)this.MS.setRequestHeader(n,this.headers[n]);null!=this.contentType&&this.MS.setRequestHeader("Content-Type",this.contentType),b.ri.zi.browser[0].identifier==b.ri.fi?this.MS.onload=this._S:b.Ti(this.MS,"loadend",this._S)}else this.MS.onload=this._S,this.MS.open(this.method,t);var i=this,r=function(){i.MS.send(i.data),i.state=j.VA.pS,i.zs(new f.jt(j.cs.dm))};this.xS?r():setTimeout(function(){r()},0)};var k=new Object;k.GS=new Object,k.GS.HS="adways";var M=new Object;M.XS=function(){this.QS=null,this.VS=arguments[0],this.YS=k.GS.HS,this.WS=null},o._(M.XS,null),M.XS.prototype.destroy=function(){return null!=this.WS&&clearTimeout(this.WS),1},M.XS.prototype.$S=function(){return this.VS},M.XS.prototype.tz=function(t){this.QS=t;var n=this;null!=this.WS&&clearTimeout(this.WS),this.WS=setTimeout(function(){n.QS=null,n.WS=null},3e4)},M.XS.prototype.iz=function(t){this.YS=t},M.XS.prototype.sz=function(){return this.QS},M.XS.prototype.nz=function(){return this.YS},M.jS=function(){O.jS.call(this),this.contentType="application/json"},o._(M.jS,O.jS),M.jS.prototype.destroy=function(){return(O.jS.prototype.destroy,O.jS.prototype.destroy.apply(this,arguments))+1},M.jS.prototype.LS=function(){if(this.state=j.VA.dS,this.zs(new f.jt(j.cs.dm)),null==u.currentCredential.sz()||null==u.currentCredential.nz()){var i=new O.jS;if(i.FS("GET"),this.xS){var t=i.ZS();null!=t&&(t.withCredentials=!0)}i.KA(u.currentCredential.$S());var r=this;i.Ti(j.cs.dm,function(t){if(i.Dd()==j.VA.OS){var n=t.rz().US();void 0!==n.access_token&&void 0!==n.token_provider&&(u.currentCredential.tz(n.access_token),u.currentCredential.iz(n.token_provider),r.TS("Authorization","Bearer "+u.currentCredential.sz()),r.TS("X-Token-Provider",u.currentCredential.nz()),r.qS())}},this),i.KS()}else this.TS("Authorization","Bearer "+u.currentCredential.sz()),this.TS("X-Token-Provider",u.currentCredential.nz()),this.qS()},u.lib.ready=!0}catch(t){u.lib.ready=!1,u.lib.error=t}u.experience=new Object,u.experience.ready=!1,u.experience.error=null,u.experience.version=1;try{if(u.lib.ready){var E=new Object;E.nX=new Object,o.J(E.nX),E.Vq=new Object,o.J(E.Vq),E.bB=new Object,o.J(E.bB),void 0===u.oop&&(u.oop=new Object),u.oop.createClass=o._,u.oop.createInterface=o.J,u.oop.instanceOf=o.Z,void 0===u.event&&(u.event=new Object),u.event.kindCounter=a.ft,u.event.IEventR=a.vt,u.event.IValueEventR=a.bt,u.event.IErrorEventR=a.dt,u.event.IEventDispatcherR=a.Ot,u.event.EventDispatcher=f.Et,u.event.EventDispatcher.prototype.dispatchEvent=f.Et.prototype.zs,u.event.EventDispatcher.prototype.zs=function(){return this.dispatchEvent.apply(this,arguments)},u.event.EventDispatcher.prototype.isInstanceOf=f.Et.prototype.F,u.event.EventDispatcher.prototype.F=function(){return this.isInstanceOf.apply(this,arguments)},u.event.EventDispatcher.prototype.addEventListener=f.Et.prototype.Ti,u.event.EventDispatcher.prototype.Ti=function(){return this.addEventListener.apply(this,arguments)},u.event.EventDispatcher.prototype.removeEventListener=f.Et.prototype.Ci,u.event.EventDispatcher.prototype.Ci=function(){return this.removeEventListener.apply(this,arguments)},u.event.EventDispatcher.prototype.iX=f.Et.prototype.hq,u.event.EventDispatcher.prototype.hq=function(){return this.iX.apply(this,arguments)},u.event.EventDispatcher.prototype.nbEventListeners=f.Et.prototype.fq,u.event.EventDispatcher.prototype.fq=function(){return this.nbEventListeners.apply(this,arguments)},u.event.EventDispatcher.prototype.hasEventListener=f.Et.prototype.oq,u.event.EventDispatcher.prototype.oq=function(){return this.hasEventListener.apply(this,arguments)},u.event.EventDispatcher.prototype.willTriggerEvent=f.Et.prototype.aq,u.event.EventDispatcher.prototype.aq=function(){return this.willTriggerEvent.apply(this,arguments)},u.event.EventDispatcher.prototype.isRegisteredEvent=f.Et.prototype.cq,u.event.EventDispatcher.prototype.cq=function(){return this.isRegisteredEvent.apply(this,arguments)},u.event.Event=f.jt,u.event.Event.prototype.isInstanceOf=f.jt.prototype.F,u.event.Event.prototype.F=function(){return this.isInstanceOf.apply(this,arguments)},u.event.Event.prototype.getDispatcher=f.jt.prototype.rz,u.event.Event.prototype.rz=function(){return this.getDispatcher.apply(this,arguments)},u.event.Event.prototype.getKind=f.jt.prototype.$,u.event.Event.prototype.$=function(){return this.getKind.apply(this,arguments)},u.event.ValueEvent=f.kt,u.event.ValueEvent.prototype.getOldValue=f.kt.prototype.Zr,u.event.ValueEvent.prototype.Zr=function(){return this.getOldValue.apply(this,arguments)},u.event.KeyValueEvent=f._t,u.event.KeyValueEvent.prototype.getKey=f._t.prototype.tq,u.event.KeyValueEvent.prototype.tq=function(){return this.getKey.apply(this,arguments)},u.event.DataEvent=f.Mt,u.event.DataEvent.prototype.getData=f.Mt.prototype.On,u.event.DataEvent.prototype.On=function(){return this.getData.apply(this,arguments)},u.event.ERROR_EVENT=a.gt,u.event.ErrorEvent=f.xt,u.event.ErrorEvent.prototype.getErrorCode=f.xt.prototype.X,u.event.ErrorEvent.prototype.X=function(){return this.getErrorCode.apply(this,arguments)},u.event.ErrorEvent.prototype.getErrorMessage=f.xt.prototype.Y,u.event.ErrorEvent.prototype.Y=function(){return this.getErrorMessage.apply(this,arguments)},void 0===u.event.kindCounter&&(u.event.kindCounter=a.ft),void 0===u.misc&&(u.misc=new Object),void 0===u.misc.html&&(u.misc.html=new Object),u.misc.html.userAgent=new Object,u.misc.html.userAgent.UNKNOWN=b.ri.P,u.misc.html.userAgent.IOS=b.ri.ui,u.misc.html.userAgent.WINDOWS=b.ri.ei,u.misc.html.userAgent.MACOSX=b.ri.li,u.misc.html.userAgent.SAFARI=b.ri.fi,u.misc.html.userAgent.FIREFOX=b.ri.oi,u.misc.html.userAgent.OPERA=b.ri.ai,u.misc.html.userAgent.IE=b.ri.ci,u.misc.html.userAgent.CHROME=b.ri.wi,u.misc.html.userAgent.FENNEC=b.ri.vi,u.misc.html.userAgent.OPERA_MINI=b.ri.Ni,u.misc.html.userAgent.OPERA_MOBILE=b.ri.bi,u.misc.html.userAgent.APPLE_WEBKIT=b.ri.yi,u.misc.html.userAgent.PRESTO=b.ri.mi,u.misc.html.userAgent.GECKO=b.ri.Ai,u.misc.html.userAgent.TRIDENT=b.ri.di,u.misc.html.userAgent.IPAD=b.ri.pi,u.misc.html.userAgent.IPHONE=b.ri.Oi,u.misc.html.userAgent.IPOD=b.ri.ji,u.misc.html.userAgent.MAC=b.ri.ki,u.misc.html.userAgent.ANDROID=b.ri.gi,u.misc.html.userAgent.UA=b.ri.zi,u.misc.idTool=c.St,u.misc.idTool.getUID=c.St.Tt,u.misc.html.addEventListener=b.Ti,u.misc.html.removeEventListener=b.Ci,u.misc.html.addCSSClass=b.Vi,u.misc.html.removeCSSClass=b.Wi,u.misc.html.checkCSSClass=b.Yi,void 0===u.misc.string&&(u.misc.string=new Object),u.misc.string.defaultMacroList=y.$s,u.misc.string.macroReplacer=y.tn,void 0===u.type&&(u.type=new Object),void 0===u.type.evt&&(u.type.evt=new Object),u.type.evt.ENUM=g.Wh,u.type.evt.BOOLEAN=g.jr,u.type.evt.IEnumR=g.nr,u.type.evt.Enum=N.Pu,u.type.evt.Enum.prototype.setV=N.Pu.prototype.Sr,u.type.evt.Enum.prototype.Sr=function(){return this.setV.apply(this,arguments)},u.type.evt.Enum.prototype.set=N.Pu.prototype.Er,u.type.evt.Enum.prototype.Er=function(){return this.set.apply(this,arguments)},void 0===u.time&&(u.time=new Object),u.time.units=new Object,u.time.units.DEFAULT=z.Qu.Vu,u.time.units.MILLISECOND=z.Qu.Yu,u.time.units.SECOND=z.Qu.Wu,u.time.units.MINUTE=z.Qu.$u,u.time.units.HOUR=z.Qu.te,u.time.units.DAY=z.Qu.ie,u.time.units.MONTH=z.Qu.se,u.time.units.YEAR=z.Qu.ne,u.time.time2String=F.be,u.experience.IInfoCollector=E.nX,u.experience.IInfoCollector.EB=function(){return this.contentClicked.apply(this,arguments)},u.experience.IInfoCollector.SB=function(){return this.started.apply(this,arguments)},u.experience.IInfoCollector.zB=function(){return this.loaded.apply(this,arguments)},u.experience.IInfoCollector.IB=function(){return this.ended.apply(this,arguments)},u.experience.IInfoCollector._z=function(){return this.enrichmentDisplay.apply(this,arguments)},u.experience.IInfoCollector.Ez=function(){return this.percentConsumed.apply(this,arguments)},u.experience.IInfoCollector._B=function(){return this.actionExecuted.apply(this,arguments)},u.experience.IInfoCollector.DB=function(){return this.sendStat.apply(this,arguments)},u.experience.ISceneControllerWrapper=E.Vq,u.experience.IURLOpener=E.bB,void 0===u.ajax&&(u.ajax=new Object),u.ajax.states=new Object,u.ajax.states.INVALID=j.VA.rp,u.ajax.states.READY=j.VA.mS,u.ajax.states.STARTED=j.VA.AS,u.ajax.states.INITIALIZING=j.VA.dS,u.ajax.states.DOING=j.VA.pS,u.ajax.states.DONE=j.VA.OS,u.ajax.events=new Object,u.ajax.events.STATE_CHANGED=j.cs.dm,u.ajax.Request=O.jS,u.ajax.Request.prototype.setURL=O.jS.prototype.KA,u.ajax.Request.prototype.KA=function(){return this.setURL.apply(this,arguments)},u.ajax.Request.prototype.setContentType=O.jS.prototype.IS,u.ajax.Request.prototype.IS=function(){return this.setContentType.apply(this,arguments)},u.ajax.Request.prototype.setMethod=O.jS.prototype.FS,u.ajax.Request.prototype.FS=function(){return this.setMethod.apply(this,arguments)},u.ajax.Request.prototype.setHeaders=O.jS.prototype.DS,u.ajax.Request.prototype.DS=function(){return this.setHeaders.apply(this,arguments)},u.ajax.Request.prototype.addHeader=O.jS.prototype.TS,u.ajax.Request.prototype.TS=function(){return this.addHeader.apply(this,arguments)},u.ajax.Request.prototype.setDataObject=O.jS.prototype.CS,u.ajax.Request.prototype.CS=function(){return this.setDataObject.apply(this,arguments)},u.ajax.Request.prototype.setDataText=O.jS.prototype.JS,u.ajax.Request.prototype.JS=function(){return this.setDataText.apply(this,arguments)},u.ajax.Request.prototype.getResponseText=O.jS.prototype.RS,u.ajax.Request.prototype.RS=function(){return this.getResponseText.apply(this,arguments)},u.ajax.Request.prototype.getState=O.jS.prototype.Dd,u.ajax.Request.prototype.Dd=function(){return this.getState.apply(this,arguments)},u.ajax.Request.prototype.getResponseObject=O.jS.prototype.US,u.ajax.Request.prototype.US=function(){return this.getResponseObject.apply(this,arguments)},u.ajax.Request.prototype.getRequestDuration=O.jS.prototype.BS,u.ajax.Request.prototype.BS=function(){return this.getRequestDuration.apply(this,arguments)},u.ajax.Request.prototype.getXHR=O.jS.prototype.ZS,u.ajax.Request.prototype.ZS=function(){return this.getXHR.apply(this,arguments)},u.ajax.Request.prototype.load=O.jS.prototype.KS,u.ajax.Request.prototype.KS=function(){return this.load.apply(this,arguments)},void 0===u.bo&&(u.bo=new Object),u.bo.providers=new Object,u.bo.providers.ADWAYS=k.GS.HS,u.bo.Credential=M.XS,u.bo.Credential.prototype.getCredentialUpdateScriptURL=M.XS.prototype.$S,u.bo.Credential.prototype.$S=function(){return this.getCredentialUpdateScriptURL.apply(this,arguments)},u.bo.Credential.prototype.getProvider=M.XS.prototype.nz,u.bo.Credential.prototype.nz=function(){return this.getProvider.apply(this,arguments)},u.bo.Credential.prototype.getAccessToken=M.XS.prototype.sz,u.bo.Credential.prototype.sz=function(){return this.getAccessToken.apply(this,arguments)},u.bo.Credential.prototype.setProvider=M.XS.prototype.iz,u.bo.Credential.prototype.iz=function(){return this.setProvider.apply(this,arguments)},u.bo.Credential.prototype.setAccessToken=M.XS.prototype.tz,u.bo.Credential.prototype.tz=function(){return this.setAccessToken.apply(this,arguments)},u.bo.Request=M.jS}else u.experience.ready=!1,u.experience.error="lib error"}catch(t){u.experience.ready=!1,u.experience.error=t}}(window);(function(window) {
    "use strict";
    
    var adways = window.adways;
var UUID;UUID=function(e){"use strict";function t(){}function r(e){return 0>e?NaN:30>=e?0|Math.random()*(1<<e):53>=e?(0|1073741824*Math.random())+1073741824*(0|Math.random()*(1<<e-30)):NaN}function n(e,t){for(var r=e.toString(16),n=t-r.length,i="0";0<n;n>>>=1,i+=i)1&n&&(r=i+r);return r}return t.generate=function(){return n(r(32),8)+"-"+n(r(16),4)+"-"+n(16384|r(12),4)+"-"+n(32768|r(14),4)+"-"+n(r(48),12)},t.overwrittenUUID=e,t}(UUID);var adways=adways||{},htmlAddEventListener=function(e,t,r,n){if(arguments.length<4&&(n=!1),"load"===t&&void 0===e.onload){var i=function(t){"loaded"!==e.readyState&&"complete"!==e.readyState||(r.call(),e.removeEventListener?e.removeEventListener("readystatechange",i):e.detachEvent?e.detachEvent("onreadystatechange",i):e.onreadystatechange=null)};e.addEventListener?e.addEventListener("readystatechange",i):e.attachEvent?e.attachEvent("onreadystatechange",i):e.onreadystatechange=i}else e.addEventListener?e.addEventListener(t,r,n):e.attachEvent&&e.attachEvent("on"+t,r,n)};adways.AnalyticsTracker=function(e){this.baseProperties=null,this.baseUrl=null,e.creative_format&&e.creative_id?(void 0===e&&(e={}),void 0===e.force_protocol&&void 0!==adways.tweaks&&void 0!==adways.tweaks.forceProtocol&&(e.force_protocol=adways.tweaks.forceProtocol),void 0===e.record_interface&&(e.record_interface="generic"),e.client_start_timestamp=(new Date).getTime(),e.client_session_id=arguments.length>1?arguments[1]:UUID.generate(),this.baseUrl="https://www.adwstats.com/",void 0!==e.force_protocol&&-1===this.baseUrl.search(/^http[s]?\:\/\//)&&(this.baseUrl=e.force_protocol+":"+this.baseUrl),this.skipCookie=0,void 0!==e.nc&&(this.skipCookie=e.nc),this.x_domain="",void 0!==e.x_domain&&(this.x_domain=e.x_domain),this.sendTrackerInit=!0,void 0!==e.send_tracker_init&&(this.sendTrackerInit=e.send_tracker_init),this.macros=new Object,void 0!==e.macros&&(this.macros=e.macros),this.baseProperties=e,this.sendTrackerInit&&this.sendData({event_type:"init",event_name:"tracker"})):console.error("Property 'creative_format' and 'creative_id' must be defined!")},adways.AnalyticsTracker.prototype.evaluateData=function(e){var t={};for(var r in e)if(e.hasOwnProperty(r)&&"cbFunction"!==r){var n=e[r];"function"==typeof n&&(n=n()),null===n||"number"==typeof n&&!isFinite(n)||(t[r]=n)}return t},adways.AnalyticsTracker.prototype._getQueryString=function(e){var t=this.evaluateData(e),r=[];for(var n in t)r.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return r.join("&")},adways.AnalyticsTracker.prototype.isReady=function(){return null!=this.baseProperties},adways.AnalyticsTracker.prototype.initAnalyticsTrackerData=function(e,t,r,n){var i=new Object;for(var a in this.baseProperties)i[a]=this.baseProperties[a];if(void 0!==n&&null!=n)for(var a in n)i[a]=n[a];if("object"==typeof e)for(var a in e)i[a]=e[a];else i.event_type=e,i.event_name=t,void 0!==r&&(i.event_data=r);var s=new Date;return i.client_date_utc=s.toISOString().substr(0,19).replace("T"," "),i.client_date_utc_offset=s.toTimeString().substr(12,3)+":"+s.toTimeString().substr(15,2),i.client_cache_buster=UUID.generate(),i.client_screen_width=window.screen.width,i.client_screen_height=window.screen.height,i.client_window_width=window.innerWidth,i.client_window_height=window.innerHeight,i.client_charset=document.charset,i.client_time_elapsed=s.getTime()-this.baseProperties.client_start_timestamp,i},adways.AnalyticsTracker.prototype.sendData=function(e,t,r,n){if(this.isReady()){var i=this.initAnalyticsTrackerData(e,t,r,n),a=arguments.length>4?arguments[4]:null;"object"==typeof arguments[0]&&"function"==typeof arguments[0].cbFunction&&(a=e.cbFunction),this.callPixel(i,a)}},adways.AnalyticsTracker.prototype.callPixel=function(e){if(this.isReady()){e.x_domain=this.x_domain;var t=this.baseUrl+e.record_interface+".pixel?"+this._getQueryString(e);1===this.skipCookie&&(t=this.baseUrl+e.record_interface+".pixel?nc=1&"+this._getQueryString(e));var r=arguments.length>1?arguments[1]:null,n=new Image;return null!==r&&(htmlAddEventListener(n,"load",r),htmlAddEventListener(n,"error",r)),n.style.display="none",n.src=t,n}return null},adways.AnalyticsTracker.prototype.redirect=function(e,t,r,n,i,a){if(!this.isReady())return null;if(function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE");return t>0?parseInt(e.substring(t+5,e.indexOf(".",t))):navigator.userAgent.match(/Trident\/7\./)?11:0}()>0&&"_parent"==a){var s=document.createElement("a");return s.href=this.getRedirectURL(i,e,t,r,n),document.body.appendChild(s),s.click()}return window.open(this.getRedirectURL(i,e,t,r,n),a)},adways.AnalyticsTracker.prototype.getRedirectURL=function(e,t,r,n,i){if(this.isReady()){var a=e,s={};a.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,r){s[t]=r});if(0===Object.keys(s).length){a.replace(/[/;]+([^=;]+)=([^;]*)/gi,function(e,t,r){s[t]=r})}if(Object.keys(s).length>0)for(var o in s)void 0!==typeof this.macros[o]&&void 0!==this.macros[o]&&"undefined"!==this.macros[o]&&(e=e.replace(s[o],this.macros[o]));var c=this.initAnalyticsTrackerData(t,r,n,i);c.redirect_location=e,c.x_domain=this.x_domain;var d=this.baseUrl+c.record_interface+".redirect?"+this._getQueryString(c);return 1===this.skipCookie&&(d=this.baseUrl+c.record_interface+".redirect?nc=1&"+this._getQueryString(c)),d}return null},adways.AnalyticsTracker.prototype.setTagHref=function(e,t,r,n,i,a){return!!this.isReady()&&(e.href=this.getRedirectURL(t,r,n,i,a),!0)},adways.analytics=adways.analytics||{},adways.analytics.Tracker=adways.AnalyticsTracker;
    //console.warn("l'objet console n'est pas supporte par tout les navigateurs");
    //console.warn("TODO: gestion des erreurs!");


    if (typeof (adways) === "undefined") {
        console.warn("\"adways\" is undefined");
        return;
    }

    if (typeof (adways.interactive) === "undefined") {
//        console.warn("\"adways.interactive\" is undefined");
        adways.interactive = new Object();
    } else if (typeof (adways.interactive) !== "object") {
        console.warn("\"adways.interactive\" is already defined and is not an object");
        return;
    }

    if (typeof (adways.event) !== "object") {
        console.warn("\"adways.event\" is undefined");
        return;
    }
    if (typeof (adways.event.EventDispatcher) !== "function") {
        console.warn("\"adways.event.EventDispatcher\" is undefined");
        return;
    }
    if (typeof (adways.misc) !== "object") {
        console.warn("\"adways.misc\" is undefined");
        return;
    }
    if (typeof (adways.misc.idTool) !== "object") {
        console.warn("\"adways.misc.idTool\" is undefined");
        return;
    }
    if (typeof (adways.misc.idTool.getUID) !== "function") {
        console.warn("\"adways.misc.idTool.getUID\" is undefined");
        return;
    }

    /*##################################################################################################################################################*/
    /*
     * Deprecated but still there for retrocompatibility
     * note: the plugins also have the same objects (experienceEvents and Experience), do not forget to update them!
     */

    if (typeof (adways.interactive.experienceEvents) !== "undefined") {
        if (typeof (adways.interactive.experienceEvents) !== "object") {
            console.warn("\"adways.interactive.experienceEvents\" is not an object");
            return;
        }
    }
    else
        adways.interactive.experienceEvents = new Object();
//
//    if (typeof (adways.interactive.experienceEvents.PUBLICATION_ID_CHANGED) !== "undefined") {
//        if (typeof (adways.interactive.experienceEvents.PUBLICATION_ID_CHANGED) !== "number") {
//            console.warn("\"adways.interactive.experienceEvents.PUBLICATION_ID_CHANGED\" is not a number");
//            return;
//        }
//    }
//    else
//        adways.interactive.experienceEvents.PUBLICATION_ID_CHANGED = ++adways.event.kindCounter;
//
//    if (typeof (adways.interactive.experienceEvents.PUBLICATION_JSON_CHANGED) !== "undefined") {
//        if (typeof (adways.interactive.experienceEvents.PUBLICATION_JSON_CHANGED) !== "number") {
//            console.warn("\"adways.interactive.experienceEvents.PUBLICATION_JSON_CHANGED\" is not a number");
//            return;
//        }
//    }
//    else
//        adways.interactive.experienceEvents.PUBLICATION_JSON_CHANGED = ++adways.event.kindCounter;
//    
//    if (typeof (adways.interactive.experienceEvents.SCENE_CHANGED) !== "undefined") {
//        if (typeof (adways.interactive.experienceEvents.SCENE_CHANGED) !== "number") {
//            console.warn("\"adways.interactive.experienceEvents.SCENE_CHANGED\" is not a number");
//            return;
//        }
//    }
//    else
//        adways.interactive.experienceEvents.SCENE_CHANGED = ++adways.event.kindCounter;
//    
//    // deprecated event
//    if (typeof (adways.interactive.experienceEvents.PUBLICATION_LOADED) !== "undefined") {
//        if (typeof (adways.interactive.experienceEvents.PUBLICATION_LOADED) !== "number") {
//            console.warn("\"adways.interactive.experienceEvents.PUBLICATION_LOADED\" is not a number");
//            return;
//        }
//    }
//    else
//        adways.interactive.experienceEvents.PUBLICATION_LOADED = ++adways.event.kindCounter;
//    //////////////////////
//    
//    
//    
//    
//    
//    
//    if (typeof (adways.interactive.experienceEvents.PLAYER_BUILT) !== "undefined") {
//        if (typeof (adways.interactive.experienceEvents.PLAYER_BUILT) !== "number") {
//            console.warn("\"adways.interactive.experienceEvents.PLAYER_BUILT\" is not a number");
//            return;
//        }
//    }
//    else
//        adways.interactive.experienceEvents.PLAYER_BUILT = ++adways.event.kindCounter;
//
    if (typeof (adways.interactive.experienceEvents.DELEGATE_BUILT) !== "undefined") {
        if (typeof (adways.interactive.experienceEvents.DELEGATE_BUILT) !== "number") {
            console.warn("\"adways.interactive.experienceEvents.DELEGATE_BUILT\" is not a number");
            return;
        }
    }
    else
        adways.interactive.experienceEvents.DELEGATE_BUILT = ++adways.event.kindCounter;
//
//    if (typeof (adways.interactive.experienceEvents.SCENE_BUILT) !== "undefined") {
//        if (typeof (adways.interactive.experienceEvents.SCENE_BUILT) !== "number") {
//            console.warn("\"adways.interactive.experienceEvents.SCENE_BUILT\" is not a number");
//            return;
//        }
//    }
//    else
//        adways.interactive.experienceEvents.SCENE_BUILT = ++adways.event.kindCounter;

    if (typeof (adways.interactive.experienceEvents.READY) !== "undefined") {
        if (typeof (adways.interactive.experienceEvents.READY) !== "number") {
            console.warn("\"adways.interactive.experienceEvents.READY\" is not a number");
            return;
        }
    }
    else
        adways.interactive.experienceEvents.READY = ++adways.event.kindCounter;
//
//
//
//
//
//
//    if (typeof (adways.interactive.experienceEvents.PUBLICATION_ID_EXISTS) !== "undefined") {
//        if (typeof (adways.interactive.experienceEvents.PUBLICATION_ID_EXISTS) !== "number") {
//            console.warn("\"adways.interactive.experienceEvents.PUBLICATION_ID_EXISTS\" is not a number");
//            return;
//        }
//    }
//    else
//        adways.interactive.experienceEvents.PUBLICATION_ID_EXISTS = ++adways.event.kindCounter;
//    if (typeof (adways.interactive.experienceEvents.LOAD_CALLED) !== "undefined") {
//        if (typeof (adways.interactive.experienceEvents.LOAD_CALLED) !== "number") {
//            console.warn("\"adways.interactive.experienceEvents.LOAD_CALLED\" is not a number");
//            return;
//        }
//    }
//    else
//        adways.interactive.experienceEvents.LOAD_CALLED = ++adways.event.kindCounter;


    if (typeof (adways.interactive.experiences) !== "undefined") {
        if (!(adways.interactive.experiences instanceof Array)) {
            console.warn("\"adways.interactive.experiences\" is not an array");
            return;
        }
    }
    else
        adways.interactive.experiences = new Array();

    if (typeof (adways.env) !== "undefined")
        console.warn("\"adways.env\" is already defined");
    else
        adways.env = new Object();

    if (typeof (adways.env.tools) !== "undefined")
        console.warn("\"adways.env.tools\" is already defined");
    else
        adways.env.tools = new Object();

    if (typeof (adways.env.tools.fullscreenHelper) !== "undefined")
        console.warn("\"adways.env.tools.fullscreenHelper\" is already defined");
    else
        adways.env.tools.fullscreenHelper = new Object();

    if (typeof (adways.env.tools.fullscreenHelper.url) !== "undefined")
        console.warn("\"adways.env.tools.fullscreenHelper.url\" is already defined");
    else
        adways.env.tools.fullscreenHelper.url = "//dj5ag5n6bpdxo.cloudfront.net/libs/tools/FullscreenHelper.js";

    if (typeof (adways.playerHelpers) !== "undefined")
        console.warn("\"adways.playerHelpers\" is already defined");
    else
        adways.playerHelpers = new Object();

    // adways.playerHelpers declarations to allow the retrocompatibility to prevent errors
    // we get playerBuilderClassname, playerBuilderUrl, delegateBuilderClassname, delegateBuilderUrl from the js_constant
    // so we don t need to redeclare it
    adways.playerHelpers.BRIGHTCOVE = "brightcove";
    adways.playerHelpers.DAILYMOTION = "DAILYMOTION";
    adways.playerHelpers.DUMMY = "DUMMY";
    adways.playerHelpers.FRANCETV = "FRANCETV";
    adways.playerHelpers.HTML5 = "HTML5";
    adways.playerHelpers.JWP6ARTE = "JWP6ARTE";
    adways.playerHelpers.JWPLAYER6 = "JWPLAYER6";
    adways.playerHelpers.KALTURA = "KALTURA";
    adways.playerHelpers.M6VIDEOJS4 = "M6VIDEOJS4";
    adways.playerHelpers.OOYALA = "OOYALA";
    adways.playerHelpers.VIDEOJS = "VIDEOJS";
    adways.playerHelpers.VIMEO = "VIMEO";
    adways.playerHelpers.YOUTUBE = "YOUTUBE";
    adways.playerHelpers.THEPLATFORM = "THEPLATFORM";

    adways.interactive.PlayerJSAdapter = function () {
    this.experience = arguments[0];
    this.receiver = null;
    this.fakeLoop = false;
    var playerJSScriptTag = document.createElement('script');
    playerJSScriptTag.type = 'text/javascript';
    var aaScriptTagSrc = "https://cdn.embed.ly/player-0.1.0.min.js";
//    if (typeof (adways.tweaks) !== "undefined" && typeof (adways.tweaks.forceProtocol) !== "undefined") {
//        if (aaScriptTagSrc.search(/^http[s]?\:\/\//) === -1) {
//            aaScriptTagSrc = adways.tweaks.forceProtocol + ":" + aaScriptTagSrc;
//        }
//    }
    playerJSScriptTag.src = aaScriptTagSrc;

    var playerJSScriptLoadedCb = function () {
        adways.misc.html.removeEventListener(playerJSScriptTag, "load", playerJSScriptLoadedCb);
        if(typeof(playerjs) === "undefined")
            return;
        this.receiver = new playerjs.Receiver();

        /* Methods */
        this.receiver.on('play', function () {
            var s2p = this.experience.getS2P();
            if (s2p) {
                s2p.play(true);
                var p2s = this.experience.getP2S();
                if (p2s && p2s.getPlayState().valueOf() === adways.resource.playStates.PLAYING) {
                    this.receiver.emit('play');
                }
            }
        }.bind(this));

        this.receiver.on('pause', function () {
            var s2p = this.experience.getS2P();
            if (s2p) {
                s2p.pause(true);
                var p2s = this.experience.getP2S();
                if (p2s && p2s.getPlayState().valueOf() === adways.resource.playStates.PAUSED) {
                    this.receiver.emit('pause');
                }
            }
        }.bind(this));

        this.receiver.on('getPaused', function (callback) {
            var p2s = this.experience.getP2S();
            var paused = false;
            if (p2s) {
                paused = (p2s.getPlayState().valueOf() === adways.resource.playStates.PAUSED);
            }
            callback(paused);
        }.bind(this));

        this.receiver.on('getCurrentTime', function (callback) {
            var p2s = this.experience.getP2S();
            var currentTime = 0;
            if (p2s) {
                currentTime = p2s.getCurrentTime().valueOf();
            }
            callback(currentTime);
        }.bind(this));

        this.receiver.on('setCurrentTime', function (value) {
            var s2p = this.experience.getS2P();
            if (s2p) {
                s2p.setCurrentTime(value, true);
            }
        }.bind(this));

        this.receiver.on('getDuration', function (callback) {
            var p2s = this.experience.getP2S();
            var duration = 0;
            if (p2s) {
                duration = p2s.getDuration().valueOf();
            }
            callback(duration);
        }.bind(this));

        this.receiver.on('getVolume', function (callback) {
            var p2s = this.experience.getP2S();
            var volume = 0;
            if (p2s) {
                volume = p2s.getVolume().valueOf();
            }
            callback(volume * 100);
        }.bind(this));

        this.receiver.on('setVolume', function (value) {
            var s2p = this.experience.getS2P();
            if (s2p) {
                s2p.setVolume(value / 100, true);
            }
        }.bind(this));

        this.receiver.on('mute', function () {
            var s2p = this.experience.getS2P();
            if (s2p) {
                s2p.mute(true);
            }
        }.bind(this));

        this.receiver.on('unmute', function () {
            var s2p = this.experience.getS2P();
            if (s2p) {
                s2p.unmute(true);
            }
        }.bind(this));

        this.receiver.on('getMuted', function (callback) {
            var p2s = this.experience.getP2S();
            var muted = 0;
            if (p2s) {
                muted = p2s.getMuted().valueOf();
            }
            callback(muted);
        }.bind(this));


        this.receiver.on('getLoop', function (callback) {
            var that = this;
            callback(that.fakeLoop);
        }.bind(this));

        this.receiver.on('setLoop', function (value) {
            this.fakeLoop = value;
            //video.loop = value;
        }.bind(this));

        if (this.experience.getSceneState().valueOf() === adways.interactive.Experience.sceneStates.BUILT) {
            this.addListenerOnScene(this.experience.getScene());
        }
        this.experience.addEventListener(adways.interactive.Experience.Event.SCENE_STATE_CHANGED, this.sceneStateChangedCB, this);

        this.experience.addEventListener(adways.interactive.Experience.Event.READY, this.experienceReadyCb, this);
    }.bind(this);
    adways.misc.html.addEventListener(playerJSScriptTag, "load", playerJSScriptLoadedCb);
    document.getElementsByTagName('head')[0].appendChild(playerJSScriptTag);
};

adways.oop.createClass(adways.interactive.PlayerJSAdapter);

adways.interactive.PlayerJSAdapter.prototype.destroy = function () {
    if (this.receiver !== null) {
        this.experience.removeEventListener(adways.interactive.Experience.Event.READY, this.experienceReadyCb, this);
        this.experience.removeEventListener(adways.interactive.Experience.Event.SCENE_STATE_CHANGED, this.sceneStateChangedCB, this);
        if (this.experience.getSceneState().valueOf() === adways.interactive.Experience.sceneStates.BUILT) {
            this.removeListenerOnScene(this.experience.getScene());
        }
        delete this.receiver;
        this.receiver = null;
    }
    return 1;
};

adways.interactive.PlayerJSAdapter.prototype.experienceReadyCb = function () {
    this.receiver.ready();
};

adways.interactive.PlayerJSAdapter.prototype.sceneStateChangedCB = function () {
    switch (this.experience.getSceneState().valueOf()) {
        case adways.interactive.Experience.sceneStates.EMPTY:
            this.removeListenerOnScene(this.experience.getScene());
            break;
        case adways.interactive.Experience.sceneStates.BUILT:
            this.addListenerOnScene(this.experience.getScene());
            break;
    }
};

adways.interactive.PlayerJSAdapter.prototype.addListenerOnScene = function () {
    var p2s = this.experience.getP2S();
    if (p2s !== null) {
        p2s.addEventListener(adways.resource.events.CURRENT_TIME_CHANGED, this.p2sCurrentTimeChangedListener, this);
        p2s.addEventListener(adways.resource.events.ENDED_CHANGED, this.p2sEndedEventListener, this);
        p2s.addEventListener(adways.resource.events.PLAY_STATE_CHANGED, this.p2sPlayStateChangedListener, this);
    }
    this.experience.getScene().addEventListener(adways.hv.events.P2S_CONTROLLER_CHANGED, this.p2sChangedCB, this);
};

adways.interactive.PlayerJSAdapter.prototype.removeListenerOnScene = function () {
    if (this.experience.getScene() !== null) {
        this.experience.getScene().removeEventListener(adways.hv.events.P2S_CONTROLLER_CHANGED, this.p2sChangedCB, this);
        var p2s = this.experience.getP2S();
        if (p2s !== null) {
            p2s.removeEventListener(adways.resource.events.CURRENT_TIME_CHANGED, this.p2sCurrentTimeChangedListener, this);
            p2s.removeEventListener(adways.resource.events.ENDED_CHANGED, this.p2sEndedEventListener, this);
            p2s.removeEventListener(adways.resource.events.PLAY_STATE_CHANGED, this.p2sPlayStateChangedListener, this);
        }
    }
};

adways.interactive.PlayerJSAdapter.prototype.p2sChangedCB = function () {
    var oldValue = arguments[0].getOldValue();
    if (oldValue !== null) {
        oldValue.removeEventListener(adways.resource.events.CURRENT_TIME_CHANGED, this.p2sCurrentTimeChangedListener, this);
        oldValue.removeEventListener(adways.resource.events.ENDED_CHANGED, this.p2sEndedEventListener, this);
        oldValue.removeEventListener(adways.resource.events.PLAY_STATE_CHANGED, this.p2sPlayStateChangedListener, this);
    }
    var p2s = this.experience.getP2S();
    if (p2s !== null) {
        p2s.addEventListener(adways.resource.events.CURRENT_TIME_CHANGED, this.p2sCurrentTimeChangedListener, this);
        p2s.addEventListener(adways.resource.events.ENDED_CHANGED, this.p2sEndedEventListener, this);
        p2s.addEventListener(adways.resource.events.PLAY_STATE_CHANGED, this.p2sPlayStateChangedListener, this);
    }
};

adways.interactive.PlayerJSAdapter.prototype.p2sCurrentTimeChangedListener = function () {
    var p2sCurrentTime = this.experience.getP2S().getCurrentTime();
    var p2sDuration = this.experience.getP2S().getDuration();
//    console.log('timeupdate', {
//          seconds: p2sCurrentTime,
//          duration: p2sDuration
//    });
    this.receiver.emit('timeupdate', {
        seconds: p2sCurrentTime,
        duration: p2sDuration
    });
};

adways.interactive.PlayerJSAdapter.prototype.p2sEndedEventListener = function () {
    this.receiver.emit('ended');
};

adways.interactive.PlayerJSAdapter.prototype.p2sPlayStateChangedListener = function (e) {
    if (this.experience.getP2S().getPlayState().valueOf() === adways.resource.playStates.PLAYING) {
        this.receiver.emit('play');
    } else {
        this.receiver.emit('pause');
    }
};/* global adways */
var AAAEventTypes = new Object();
AAAEventTypes.INTERACTIVITY = "interactivity";
AAAEventTypes.ENRICHMENT = "enrichment";
AAAEventTypes.USER_CUSTOM = "user_custom";
AAAEventTypes.VIDEO = "video";

adways.interactive.AAACollector = function () {
    this.experience = arguments[0];
    
    this.tracker = null;
    this.trackerPendingQueue = new Array();
    
    this.interactivity_length = null;
    this.interactivity_time_reference = null;
     
    this.trackerloaded = false;        
    var aaScriptLoadedCb = function() {
        if (this.trackerloaded)
            return;
        this.trackerloaded = true;    
        if(aaScriptTag)
            adways.misc.html.removeEventListener(aaScriptTag, "load", aaScriptLoadedCb);
        this.tracker = new adways.analytics.Tracker({
            record_interface : 'interactive',
            creative_format : 'interactive',
            creative_id : this.experience.getPublicationID().valueOf(),
            video_mime : this.experience.ownPlayer ? this.experience.getPublicationJSON().project.media.mime : null,
//            video_code : this.experience.ownPlayer ? this.experience.getPublicationJSON().project.media.assets[0].location : null,
            video_code : this.experience.ownPlayer ? 
            (this.experience.getPublicationJSON().project.media.xkey!==null ?
                this.experience.getPublicationJSON().project.media.xkey
                :(this.experience.getPublicationJSON().project.media.assets.length>0?
                    this.experience.getPublicationJSON().project.media.assets[0].location
                    :null))
            :null,
            video_state : function() { return this.experience.getP2S().getPlayState(); }.bind(this),
            video_current_time : function() { return this.experience.getP2S().getCurrentTime(); }.bind(this),
            video_is_live : null, // Not defined for VI
            video_is_fullscreen : function() { return this.experience.getP2S().getFullscreen(); }.bind(this),
            video_volume : function() { return this.experience.getP2S().getVolume(); }.bind(this),
            video_muted : function() { return this.experience.getP2S().getMuted(); }.bind(this),
            video_displayed_stream_width : function() { return this.experience.getP2S().getStreamSize()[0]; }.bind(this),
            video_displayed_stream_height : function() { return this.experience.getP2S().getStreamSize()[1]; }.bind(this),
            video_player_width : function() { return this.experience.getP2S().getRenderSize()[0]; }.bind(this),
            video_player_height : function() { return this.experience.getP2S().getRenderSize()[1]; }.bind(this),
            video_controls_enabled : null, // Not defined for VI

            interactivity_length : function () {
                if (this.interactivity_length === null && this.experience.getScene())
                    this.interactivity_length = this.experience.getScene().getInteractivityLength();
                if(this.interactivity_length !== Number.POSITIVE_INFINITY && this.interactivity_length !== Number.NEGATIVE_INFINITY)
                    return this.interactivity_length;
                else return 0;
            }.bind(this),
            interactivity_content_id : null,
            interactivity_enrichment_id : null,
            interactivity_time_reference : function() { 
                if (this.interactivity_time_reference === null && this.experience.getScene())
                    this.interactivity_time_reference = this.experience.getScene().getTimeReference().valueOf();
                return this.interactivity_time_reference;
            }.bind(this)
        });
        
        while (this.trackerPendingQueue.length > 0) {
            var args = this.trackerPendingQueue.shift();
//            console.log(args);
            this.sendData(args);
        }
        
    }.bind(this);   
    
    var that = this;
    var publicationIdChanged = function () {
        if (that.experience.getPublicationID().valueOf() === "") {
            that.experience.addEventListener(adways.interactive.Experience.Event.PUBLICATION_ID_CHANGED, function () {
                if (that.experience.getPublicationID().valueOf() !== "") {
                    aaScriptLoadedCb();
                }
            }, that);
        } else {
            aaScriptLoadedCb();
        }
    };
    
    if (typeof window.adways.analytics === "undefined") {
        var aaScriptTag = document.createElement('script');
        aaScriptTag.type = 'text/javascript';
        var aaScriptTagSrc = '//www.adwstats.com/sdk.js';
        if (typeof (adways.tweaks) !== "undefined" && typeof (adways.tweaks.forceProtocol) !== "undefined") {
            if (aaScriptTagSrc.search(/^http[s]?\:\/\//) === -1) {
                aaScriptTagSrc = adways.tweaks.forceProtocol + ":" + aaScriptTagSrc;
            }
        }
        aaScriptTag.src = aaScriptTagSrc;
        adways.misc.html.addEventListener(aaScriptTag, "load", aaScriptLoadedCb);
        document.getElementsByTagName('head')[0].appendChild(aaScriptTag);
    }
    else if(adways.interactive.Experience.interactiveLibState.valueOf() !== adways.interactive.Experience.interactiveLibStates.LOADED) {
        adways.interactive.Experience.interactiveLibState.addEventListener(adways.type.evt.ENUM, function () {
            if (adways.interactive.Experience.interactiveLibState.valueOf() === adways.interactive.Experience.interactiveLibStates.LOADED) {
                publicationIdChanged();
            }
        }, this);
    } else {
        publicationIdChanged();
    }
    this.percentConsumed = null;
    this.impression = false;
    this.trueView = 0;

    if (this.experience.getSceneState().valueOf() === adways.interactive.Experience.sceneStates.BUILT) {
        this.addListenerOnScene(this.experience.getScene());
    }
    this.experience.addEventListener(adways.interactive.Experience.Event.SCENE_STATE_CHANGED, this.sceneStateChangedCB, this);
    
    this.experience.addEventListener(adways.interactive.Experience.Event.READY, this.experienceReadyCb, this);
};
adways.oop.createClass(adways.interactive.AAACollector, null, adways.experience.IURLOpener);

adways.interactive.AAACollector.prototype.destroy = function () {
    
    this.experience.removeEventListener(adways.interactive.Experience.Event.READY, this.experienceReadyCb, this);

    this.experience.removeEventListener(adways.interactive.Experience.Event.SCENE_STATE_CHANGED, this.sceneStateChangedCB, this);

    if (this.experience.getSceneState().valueOf() === adways.interactive.Experience.sceneStates.BUILT) {
        this.removeListenerOnScene(this.experience.getScene());
    }
    
    return 1;
};

adways.interactive.AAACollector.prototype.sendData = function (data) {
    if (this.experience.getPublicationID() !== "preview") { 
        if (this.tracker !== null) {
            this.tracker.sendData(data);
        }
        else {
            this.trackerPendingQueue.push(data);
        }
    }
};

/**
 * Implements URLOpener redirection
 */
adways.interactive.AAACollector.prototype.exec = function () {
    var url = adways.misc.string.macroReplacer(arguments[0].valueOf());
    var targetMode = (arguments.length>1?arguments[1].valueOf():adways.hv.targetURLModes.BLANK);

    var target = "";
    if(targetMode===adways.hv.targetURLModes.BLANK) {
        target = "_blank";
    } else {
        target = "_self";
    }
    if (url.search(/^\.\//) > -1) {
        target = "_parent";
    }    
    var completionValue = Math.round((this.experience.getP2S().getCurrentTime().valueOf()/this.experience.getP2S().getDuration().valueOf())*10)*10;

    var mailtoPos = url.valueOf().indexOf("mailto:");
    if(mailtoPos===0) {
        return location.href=url.valueOf(); 
    }
    
    var teltoPose = url.valueOf().indexOf("tel:");
    if(teltoPose===0) {
        return location.href=url.valueOf(); 
    }
    
    this.tracker.redirect(
        { 
            event_type: 'redirect',
            event_name: encodeURI(url.valueOf()).substr(0, 500),
            completion_value: completionValue, 
            completion_ref: this.experience.getPublicationID().valueOf()
        }, null, null, null, url.valueOf(), target);
};

adways.interactive.AAACollector.prototype.sceneStateChangedCB = function () {
    switch (this.experience.getSceneState().valueOf()) {
        case adways.interactive.Experience.sceneStates.EMPTY:
            this.removeListenerOnScene(this.experience.getScene());
            break;
        case adways.interactive.Experience.sceneStates.BUILT:
            this.addListenerOnScene(this.experience.getScene());
            break;
    }
};

adways.interactive.AAACollector.prototype.experienceReadyCb = function () {
    this.sendData({
        event_type: "state",
        event_name: "init"
    });
};

adways.interactive.AAACollector.prototype.addListenerOnScene = function () {    
    // this.experience.getScene().addEventListener(adways.interactive.events.ACTION_EXECUTED, this.actionExecutedCB, this);
//    if (this.experience.getScene().getPublicationId() !== "") {
//        this.sendData({
//            event_type: "state",
//            event_name: "loaded"
//        });
//    }
    this.experience.getScene().addEventListener(adways.hv.events.NAME_CHANGED, this.publicationIDChangedCb, this);

    var enrichments = this.experience.getScene().getEnrichments().toArray();
    for (var i = 0; i < enrichments.length; ++i) {
        this.addListenerOnEnrichment(enrichments[i]);
    }
    this.experience.getScene().getEnrichments().addEventListener(adways.collection.evt.COLLECTION, this.enrichmentsCollectionCb, this);

    // var cuePoints = this.experience.getScene().getCuePoints().AMEToArray();
    // for (var i = 0; i < cuePoints.length; ++i) {
    //     this.addListenerOnCuePoints(cuePoints[i]);
    // }
    // this.experience.getScene().getCuePoints().addEventListener(adways.anim.evt.MAP, this.cuePointsCollectionCb, this);

    var p2s = this.experience.getP2S();
    if (p2s !== null) {
        p2s.addEventListener(adways.resource.events.CURRENT_TIME_CHANGED, this.p2sCurrentTimeChangedListener, this);
        p2s.addEventListener(adways.resource.events.ENDED_CHANGED, this.p2sEndedEventListener, this);
        p2s.addEventListener(adways.resource.events.PLAY_STATE_CHANGED, this.p2sPlayStateChangedListener, this);
    }
    this.experience.getScene().addEventListener(adways.hv.events.P2S_CONTROLLER_CHANGED, this.p2sChangedCB, this);
};

adways.interactive.AAACollector.prototype.removeListenerOnScene = function () {
    if(this.experience.getScene()!==null) {
        this.experience.getScene().removeEventListener(adways.hv.events.P2S_CONTROLLER_CHANGED, this.p2sChangedCB, this);
        var p2s = this.experience.getP2S();
        if (p2s !== null) {
            p2s.removeEventListener(adways.resource.events.CURRENT_TIME_CHANGED, this.p2sCurrentTimeChangedListener, this);
            p2s.removeEventListener(adways.resource.events.ENDED_CHANGED, this.p2sEndedEventListener, this);
            p2s.removeEventListener(adways.resource.events.PLAY_STATE_CHANGED, this.p2sPlayStateChangedListener, this);
        }
        // this.experience.getScene().getCuePoints().removeEventListener(adways.anim.evt.MAP, this.cuePointsCollectionCb, this);
        // var cuePoints = this.experience.getScene().getCuePoints().AMEToArray();
        // for (var i = 0; i < cuePoints.length; ++i) {
        //     this.removeListenerOnCuePoints(cuePoints[i]);
        // }

        this.experience.getScene().getEnrichments().removeEventListener(adways.collection.evt.COLLECTION, this.enrichmentsCollectionCb, this);
        var enrichments = this.experience.getScene().getEnrichments().toArray();
        for (var i = 0; i < enrichments.length; ++i) {
            this.removeListenerOnEnrichment(enrichments[i]);
        }
        this.experience.getScene().removeEventListener(adways.hv.events.NAME_CHANGED, this.publicationIDChangedCb, this);
        // this.experience.getScene().removeListenerOnEnrichment(adways.interactive.events.ACTION_EXECUTED, this.actionExecutedCB, this);
    }
};


adways.interactive.AAACollector.prototype.p2sChangedCB = function () {
    var oldValue = arguments[0].getOldValue();
    if (oldValue !== null) {
        oldValue.removeEventListener(adways.resource.events.CURRENT_TIME_CHANGED, this.p2sCurrentTimeChangedListener, this);
        oldValue.removeEventListener(adways.resource.events.ENDED_CHANGED, this.p2sEndedEventListener, this);
        oldValue.removeEventListener(adways.resource.events.PLAY_STATE_CHANGED, this.p2sPlayStateChangedListener, this);
    }
    var p2s = this.experience.getP2S();
    if (p2s !== null) {
        p2s.addEventListener(adways.resource.events.CURRENT_TIME_CHANGED, this.p2sCurrentTimeChangedListener, this);
        p2s.addEventListener(adways.resource.events.ENDED_CHANGED, this.p2sEndedEventListener, this);
        p2s.addEventListener(adways.resource.events.PLAY_STATE_CHANGED, this.p2sPlayStateChangedListener, this);
    }
};

adways.interactive.AAACollector.prototype.p2sCurrentTimeChangedListener = function () {
    var p2sCurrentTime = this.experience.getP2S().getCurrentTime();
    var p2sDuration = this.experience.getP2S().getDuration();
    if (!isNaN(p2sCurrentTime) && !isNaN(p2sDuration) && p2sCurrentTime >= 0.1 && p2sDuration !== null && p2sDuration !==0 && this.experience.getP2S().getPlayState() === adways.resource.playStates.PLAYING) {
        var percentCaclulate = p2sCurrentTime * 100 / p2sDuration;
        var stepCalculate = Math.floor(percentCaclulate / 10);
        if (this.percentConsumed === null) {
            this.percentConsumed = new Array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);
            if(!this.experience.nonlinearFormat) {
//                console.log("impression linear");
                this.sendData({
                    event_type: "state", 
                    event_name: "impression"
                });
            }
        }
        if (this.percentConsumed[stepCalculate] === 0) {
            this.percentConsumed[stepCalculate] = 1;
            this.sendData(
                {
                    event_type: 'completion',
                    event_name: this.experience.getPublicationID().valueOf(), 
                    event_data: stepCalculate * 10,
                    event_unit: '%'
                });
            if(this.trueView<2) {
                this.trueView++;
                if(this.trueView === 2) {
                    this.sendData(
                        {event_type: 'state', event_name: 'trueview', event_data: 10, event_unit: '%', completion_ref: this.experience.getPublicationID().valueOf()});
                }
            }
        }
    }
};

adways.interactive.AAACollector.prototype.p2sEndedEventListener = function () {
//    this.sendData({
//        event_type: "state", 
//        event_name: "end"
//    });
};

adways.interactive.AAACollector.prototype.p2sPlayStateChangedListener = function (e) {
    if(e.getDispatcher().getPlayState().valueOf() === adways.resource.playStates.PLAYING){        
        this.sendData({
            event_type: "state", 
            event_name: "play"
        });        
    } else {
        this.sendData({
            event_type: "state", 
            event_name: "pause"
        });        
    }
};

adways.interactive.AAACollector.prototype.publicationIDChangedCb = function () {
//    if (this.experience.getScene().getPublicationId() !== "") {
//        this.sendData({
//            event_type: "state", 
//            event_name: "loaded"
//        });
//    }
};

adways.interactive.AAACollector.prototype.enrichmentsCollectionCb = function (e) {
    var enrichments = e.getRemovedElements();
    for (var i = 0; i < enrichments.length; ++i) {
        this.removeListenerOnEnrichment(enrichments[i]);
    }
    enrichments = e.getAddedElements();
    for (var i = 0; i < enrichments.length; ++i) {
        this.addListenerOnEnrichment(enrichments[i]);
    }
};

adways.interactive.AAACollector.prototype.addListenerOnEnrichment = function (enrichment) {
    var layout = enrichment.getLayout();
    if (layout !== null) {
        this.addListenerOnLayout(layout);
    }
    enrichment.addEventListener(adways.hv.events.LAYOUT_CHANGED, this.enrichmentsLayoutCb, this);
    // enrichment.addEventListener(adways.interactive.events.ACTION_EXECUTED, this.actionExecutedCB, this);
    enrichment.addEventListener(adways.hv.events.ACTIVATED_STATE_CHANGED, this.enrichmentActivatedChangedCB, this);
    enrichment.addEventListener(adways.hv.events.START_USER_MOVE, this.startUserMoveCB, this);
    enrichment.addEventListener(adways.hv.events.START_USER_RESIZE, this.startUserResizeCB, this);

    if(enrichment.getActivated().valueOf()) {
        var completionValue = Math.round((this.experience.getP2S().getCurrentTime().valueOf()/this.experience.getP2S().getDuration().valueOf())*10)*10;
        var content = enrichment.getLayout().getContent();
        this.sendData({
            event_type: AAAEventTypes.ENRICHMENT,
            event_name: "activated",
            interactivity_enrichment_id : enrichment.getEnrichmentId().valueOf(),
            interactivity_content_id : content.getContentId() !== null ? content.getContentId().valueOf() : null,
            completion_value: completionValue, 
            completion_ref: this.experience.getPublicationID().valueOf()
        });
        
        if(!this.impression) {
            this.impression = true;
            if(this.experience.nonlinearFormat) {
//                console.log("impression non linear");
                this.sendData({
                    event_type: "state", 
                    event_name: "impression"
                });
            }
            this.sendData({
                event_type: "state",
                event_name: "enrichment_first_impression",
                interactivity_enrichment_id : enrichment.getEnrichmentId().valueOf(),
                interactivity_content_id : content.getContentId() !== null ? content.getContentId().valueOf() : null,
                completion_value: completionValue, 
                completion_ref: this.experience.getPublicationID().valueOf()
            });
        }  
    }

};

adways.interactive.AAACollector.prototype.removeListenerOnEnrichment = function (enrichment) {
    var layout = enrichment.getLayout();
    if (layout !== null) {
        this.removeListenerOnLayout(layout);
    }
    enrichment.removeEventListener(adways.hv.events.LAYOUT_CHANGED, this.enrichmentsLayoutCb, this);
    // enrichment.removeEventListener(adways.interactive.events.ACTION_EXECUTED, this.actionExecutedCB, this);
    enrichment.removeEventListener(adways.hv.events.ACTIVATED_STATE_CHANGED, this.enrichmentActivatedChangedCB, this);
    enrichment.removeEventListener(adways.hv.events.START_USER_MOVE, this.startUserMoveCB, this);
    enrichment.removeEventListener(adways.hv.events.START_USER_RESIZE, this.startUserResizeCB, this);
};

adways.interactive.AAACollector.prototype.enrichmentActivatedChangedCB = function (valueEvent) {    
    var enrichment = valueEvent.getDispatcher();
    var content = enrichment.getLayout().getContent();
    var completionValue = Math.round((this.experience.getP2S().getCurrentTime().valueOf()/this.experience.getP2S().getDuration().valueOf())*10)*10;

    var eventName = enrichment.getActivated().valueOf() ? "activated" : "deactivated";
    this.sendData({
        event_type: AAAEventTypes.ENRICHMENT,
        event_name: eventName,
        interactivity_enrichment_id : enrichment.getEnrichmentId().valueOf(),
        interactivity_content_id : content.getContentId() !== null ? content.getContentId().valueOf() : null,
        completion_value: completionValue, 
        completion_ref: this.experience.getPublicationID().valueOf()
    });
        
    if(!this.impression && enrichment.getActivated().valueOf()) {
        this.impression = true;
        if(this.experience.nonlinearFormat) {
//            console.log("impression non linear");
            this.sendData({
                event_type: "state", 
                event_name: "impression"
            });
        }
        this.sendData({
            event_type: "state",
            event_name: "enrichment_first_impression",
            interactivity_enrichment_id : enrichment.getEnrichmentId().valueOf(),
            interactivity_content_id : content.getContentId() !== null ? content.getContentId().valueOf() : null,
            completion_value: completionValue, 
            completion_ref: this.experience.getPublicationID().valueOf()
        });
    }
};

adways.interactive.AAACollector.prototype.enrichmentsLayoutCb = function () {
    var oldValue = arguments[0].getOldValue();
    if (oldValue !== null) {
        this.removeListenerOnLayout(oldValue);
    }
    var layout = arguments[0].getLayout();
    if (layout !== null) {
        this.addListenerOnLayout(layout);
    }
};

adways.interactive.AAACollector.prototype.addListenerOnLayout = function () {
    var content = arguments[0].getContent();
    if (content !== null) {
        this.addListenerOnContent(content);
    }
    arguments[0].addEventListener(adways.layout.events.CONTENT_CHANGED, this.contentChangedCb, this);
};

adways.interactive.AAACollector.prototype.removeListenerOnLayout = function () {
    var content = arguments[0].getContent();
    if (content !== null) {
        this.removeListenerOnContent(content);
    }
    arguments[0].removeEventListener(adways.layout.events.CONTENT_CHANGED, this.contentChangedCb, this);
};

adways.interactive.AAACollector.prototype.contentChangedCb = function () {
    var oldValue = arguments[0].getOldValue();
    if (oldValue !== null) {
        this.removeListenerOnContent(oldValue);
    }
    var content = arguments[0].getContent();
    if (content !== null) {
        this.addListenerOnContent(layout);
    }
};


adways.interactive.AAACollector.prototype.addListenerOnContent = function () {
    arguments[0].addEventListener(adways.interactive.events.USER_ACTION_EXECUTED, this.userActionExecutedCb, this);
    arguments[0].addEventListener(adways.interactive.events.STAT_SEND, this.statSendCb, this);
};

adways.interactive.AAACollector.prototype.removeListenerOnContent = function () {
    arguments[0].removeEventListener(adways.interactive.events.USER_ACTION_EXECUTED, this.userActionExecutedCb, this);
    arguments[0].removeEventListener(adways.interactive.events.STAT_SEND, this.statSendCb, this);
};

adways.interactive.AAACollector.prototype.userActionExecutedCb = function (event) {
    var content = event.getDispatcher();
    var enrichment = content.getEnrichment();
    var completionValue = Math.round((this.experience.getP2S().getCurrentTime().valueOf()/this.experience.getP2S().getDuration().valueOf())*10)*10;
    this.sendData(
        {
            event_type: 'interaction',
            event_name: 'enrichment_user_action',
            completion_value: completionValue, 
            completion_ref: this.experience.getPublicationID().valueOf(),
            interactivity_enrichment_id : enrichment.getEnrichmentId().valueOf(),
            interactivity_content_id : content.getContentId() !== null ? content.getContentId().valueOf() : null
        }/*,
        {
            event_type: AAAEventTypes.ENRICHMENT,
            event_name: 'enrichment_user_action',
            completion_value: completionValue, 
            completion_ref: this.experience.getPublicationID().valueOf(),
            interactivity_enrichment_id : enrichment.getEnrichmentId().valueOf(),
            interactivity_content_id : content.getContentId() !== null ? content.getContentId().valueOf() : null
        }*/);
};

adways.interactive.AAACollector.prototype.startUserMoveCB = function (event) {
    var enrichment = event.getDispatcher();
    var content = enrichment.getLayout().getContent();

    var completionValue = Math.round((this.experience.getP2S().getCurrentTime().valueOf()/this.experience.getP2S().getDuration().valueOf())*10)*10;
    this.sendData({
        event_type: AAAEventTypes.ENRICHMENT,
        event_name: "move",
        interactivity_enrichment_id : enrichment.getEnrichmentId().valueOf(),
        interactivity_content_id : content.getContentId() !== null ? content.getContentId().valueOf() : null,
        completion_value: completionValue, 
        completion_ref: this.experience.getPublicationID().valueOf()
    });
};
adways.interactive.AAACollector.prototype.startUserResizeCB = function (event) {
    var enrichment = event.getDispatcher();
    var content = enrichment.getLayout().getContent();

    var completionValue = Math.round((this.experience.getP2S().getCurrentTime().valueOf()/this.experience.getP2S().getDuration().valueOf())*10)*10;
    this.sendData({
        event_type: AAAEventTypes.ENRICHMENT,
        event_name: "resize",
        interactivity_enrichment_id : enrichment.getEnrichmentId().valueOf(),
        interactivity_content_id : content.getContentId() !== null ? content.getContentId().valueOf() : null,
        completion_value: completionValue, 
        completion_ref: this.experience.getPublicationID().valueOf()
    });
};

adways.interactive.AAACollector.prototype.statSendCb = function (event) {
    var content = event.getDispatcher();
    var enrichment = content.getEnrichment();
    var statKey = event.getData()[0];
    var statValue = event.getData()[1];

    var completionValue = Math.round((this.experience.getP2S().getCurrentTime().valueOf()/this.experience.getP2S().getDuration().valueOf())*10)*10;
    var data = {
        event_type: AAAEventTypes.ENRICHMENT,
        event_name: statKey,
        interactivity_enrichment_id : enrichment.getEnrichmentId().valueOf(),
        interactivity_content_id : content.getContentId() !== null ? content.getContentId().valueOf() : null,
        completion_value: completionValue, 
        completion_ref: this.experience.getPublicationID().valueOf()
    };
    
    if(statValue !== null && statValue !== '') data.event_data = statValue;
    
    this.sendData(data);
};/* global adways */

(function() {

    var MEDIA_PARAMS = 1;
    var PLAYER_PARAMS = 2;
    var DELEGATE_PARAMS = 3;
    var PLAYER_OPTION_PARAMS = 4;
    var SCENE_PARAMS = 5;
    var EXPERIENCE_PARAMS = 6;

                        
    window.adwMobilecheck = function() {
        var check = false;
        (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
        return check;
      };
    window.adwMobileAndTabletcheck = function() {
        var check = false;
        (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
        return check;
    };
      
    adways.interactive.Experience = function() {

        adways.event.EventDispatcher.call(this);    // super class constructor call

//    this.buildExp = new adways.interactive.Experience.BuilderExperience(this);
        this.nonlinearFormat = arguments.length>0?arguments[0]:false;
        this.jsonRequest = null;
        this.playerClassRequest = null;

        this.s2p = null;
        this.p2s = null;
        this.aaaCollector = null;
        this.playerJSAdapter = null;
        
        this.intervalTimesheet = null;
        
        this.experienceID = adways.misc.idTool.getUID();

        this.autoBuildScene = false;
        this.asyncBuildScene = false;
        this.scene = null;
        this.sceneState = new adways.type.evt.Enum(adways.interactive.Experience.sceneStates, adways.interactive.Experience.sceneStates.EMPTY);
        this.sceneTimeReference = false;

        this.publicationID = "";
        this.publicationJSON = null;
        this.clearSceneShouldResetPublicationID = true;

        this.clearingPlayer = false;
        this.params = new Object();
        this.params[PLAYER_PARAMS] = new Object();
        this.params[MEDIA_PARAMS] = new Object();
        this.params[PLAYER_OPTION_PARAMS] = new Object();
        this.params[SCENE_PARAMS] = new Object();
        this.params[EXPERIENCE_PARAMS] = new Object();
        this.playerBuilderURL = null;
        this.playerBuilderClassname = null;
        this.autoBuildPlayer = false;       // automatically build the player on json reception
        this.playerState = new adways.type.evt.Enum(adways.interactive.Experience.playerStates, adways.interactive.Experience.playerStates.EMPTY);
        this.playerContainer = null;
        this.playerAPI = null;
        this.playerClassJSConstant = "";
        // Only the setPlayerAPI should force ownPlayer to false
        // this.ownPlayer = false;
        this.ownPlayer = true;
        this.playerBuilder = null;
        this.playerScriptTag = null;

        this._redirectionAlreadyCreated = false;
        this._redirectToIOSApp = false;
//        this._iphoneBehavior = adways.interactive.Experience.IPhoneBehaviors.OPEN_CURRENT_PAGE_IN_ADWAYS_PLAYER;
        this._iphoneBehavior = adways.interactive.Experience.IPhoneBehaviors.DEFAULT;
        if (adways.misc.html.userAgent.UA.device[0].identifier === adways.misc.html.userAgent.IPHONE && adways.misc.html.userAgent.UA.os[0].version[1] < 10 &&
                !(window.navigator.standalone) &&
                adways.misc.html.userAgent.UA.browser[0].identifier !== adways.misc.html.userAgent.UNKNOWN) {
            this._redirectToIOSApp = true;
        }

        var that = this;
        this.playerScriptTagErrorCB = function() {

            that.playerState.setV(adways.interactive.Experience.playerStates.ERROR);
            that.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.PLAYER_STATE_CHANGED));
        };
        this.playerScriptTagLoadCB = function() {
            try {
                eval('that.playerBuilder = new ' + that.playerBuilderClassname + '(that.playerContainer, that)');
            }
            catch (e) {
                console.warn(e);
                that.playerState.setV(adways.interactive.Experience.playerStates.ERROR);
                that.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.PLAYER_STATE_CHANGED));
            }
            //document.getElementsByTagName("head")[0].removeChild(that.playerScriptTag);
            that.playerScriptTag = null;
        };

        this.params[DELEGATE_PARAMS] = new Object();
        this.delegateBuilderURL = null;
        this.delegateBuilderClassname = null;
        this.autoBuildDelegate = false;     // automatically build the delegate on "playerReady"
        this.delegateState = new adways.type.evt.Enum(adways.interactive.Experience.delegateStates, adways.interactive.Experience.delegateStates.EMPTY);
        this.delegate = null;
        this.delegateBuilder = null;
        this.delegateScriptTag = null;
        this.delegateScriptTagErrorCB = function() {
            that.delegateState.setV(adways.interactive.Experience.delegateStates.ERROR);
            that.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.DELEGATE_STATE_CHANGED));
        };
        this.delegateScriptTagLoadCB = function() {
            try {
                eval('that.delegateBuilder = new ' + that.delegateBuilderClassname + '(that)');
            }
            catch (e) {
                console.warn(e);
                that.delegateState.setV(adways.interactive.Experience.delegateStates.ERROR);
                that.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.DELEGATE_STATE_CHANGED));
            }
            //document.getElementsByTagName("head")[0].removeChild(that.delegateScriptTag);
            that.delegateScriptTag = null;
        };

        this.forceBuildInteractivity = false;
        this.clearingPlater = false;

        this.interactiveLibScriptTag = null;
        this.libLoadedCb = function() {
            if(that.aaaCollector===null) {
                that.aaaCollector = new adways.interactive.AAACollector(that);
                adways.interactive.tools.urlOpener = that.aaaCollector;
            }
            if(that.playerJSAdapter===null) {
                that.playerJSAdapter = new adways.interactive.PlayerJSAdapter(that);
            }
            
            // lmasclaux 03.30.2016, this condition prevents errors if the lib is already loaded, to verify
            if (that.interactiveLibScriptTag !== null) {
                adways.misc.html.removeEventListener(that.interactiveLibScriptTag, "load", that.libLoadedCb);
                adways.misc.html.removeEventListener(that.interactiveLibScriptTag, "error", that.libLoadedErrorCb);
                adways.interactive.Experience.interactiveLibState.setV(adways.interactive.Experience.interactiveLibStates.LOADED);
                that.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.INTERACTIVE_LIB_STATE_CHANGED));
            }

            if (typeof (that.publicationJSON.publication.id) === "string" && that.publicationJSON.publication.id !== "" && that.publicationID !== that.publicationJSON.publication.id) {
                that.publicationID = that.publicationJSON.publication.id;
                that.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.PUBLICATION_ID_CHANGED));
            }

            /*var res = 0;*/

            //    if (/*opt param autoInterpretJSON*/(typeof (arguments[1]) === "boolean") ? arguments[1] : true) {

            if (that.autoBuildScene && that.asyncBuildScene && that.shouldBuildInteractivity()) {
                /*res +=*/ that.buildScene();
            }

            if (that.getPlayerState().valueOf() === adways.interactive.Experience.playerStates.EMPTY) {
                // now add the params found in the that.publicationJSON but without overriding those already set

                for (var k in that.publicationJSON["project"]["player_class"]["player_params"]) {
                    if (typeof (that.getPlayerParam(k)) === "undefined") {
                        that.setPlayerParam(k, that.publicationJSON["project"]["player_class"]["player_params"][k]);
                    }
                }

                if (that.playerBuilderURL === null && that.publicationJSON["project"]["player_class"]["player_builder_url"])
                    that.setPlayerBuilderURL(that.publicationJSON["project"]["player_class"]["player_builder_url"]);

                if (that.playerBuilderClassname === null && that.publicationJSON["project"]["player_class"]["player_builder_classname"])
                    that.setPlayerBuilderClassname(that.publicationJSON["project"]["player_class"]["player_builder_classname"]);

                if (that.delegateBuilderURL === null && that.publicationJSON["project"]["player_class"]["delegate_builder_url"])
                    that.setDelegateBuilderURL(that.publicationJSON["project"]["player_class"]["delegate_builder_url"]);

                if (that.delegateBuilderClassname === null && that.publicationJSON["project"]["player_class"]["delegate_builder_classname"])
                    that.setDelegateBuilderClassname(that.publicationJSON["project"]["player_class"]["delegate_builder_classname"]);

                // retro compatibility with adways.playerHelpers to get the delegate_url from the publication
                //if (typeof adways.playerHelpers != "undefined"
                //        && typeof adways.playerHelpers[that.publicationJSON["project"]["player_class"]["js_constant"]] != "undefined"
                //        && typeof adways.playerHelpers[that.publicationJSON["project"]["player_class"]["js_constant"]].delegate_url == "undefined"
                //        && that.publicationJSON["project"]["player_class"]["delegate_url"])
                //    adways.playerHelpers[that.publicationJSON["project"]["player_class"]["js_constant"]].delegate_url = that.publicationJSON["project"]["player_class"]["delegate_url"];
                // end retro compatibility

                for (var k in that.publicationJSON["project"]["media"]) {
                    if (typeof (that.getMediaParam(k)) === "undefined") {
                        that.setMediaParam(k, that.publicationJSON["project"]["media"][k]);
                    }
                }

                for (var k in that.publicationJSON["project"]["options"]) {
                    if (typeof (that.getOption(k)) === "undefined") {
                        that.setOption(k, that.publicationJSON["project"]["options"][k]);
                    }
                }

                // cannot be factorized outside the "if" because must be called after all the previous "setters"
                that.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.PUBLICATION_JSON_CHANGED));

                if (that.autoBuildPlayer) {
                    that.buildPlayer();
//                res += (10 * that.buildPlayer());
//                res += 100;
                }
                else {
//                res += 200;
                }
            }

            else {
                that.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.PUBLICATION_JSON_CHANGED));
                /* Does the delegate need to be constructed ?
                 * If the player is:
                 * .EMPTY, then the delegate cannot be constructed
                 *  => NO DELEGATE CONSTRUCTION
                 *
                 * .ERROR, then the delegate cannot be constructed
                 *  => NO DELEGATE CONSTRUCTION
                 *
                 * .BUILDING, the end of the process will be in charge of dealing with "autoBuildDelegate"
                 *  => NO DELEGATE CONSTRUCTION
                 *
                 * .BUILT, then the building process is already ended, so it is up to the current method to deal with "autoBuildDelegate"
                 *  => DELEGATE MAY BE CONSTRUCTED:
                 *     the delegate can be built only when delegateState is "EMPTY" (not already "BUILT" or in a "BUILDING" process) and of
                 *     course, when "autoBuildDelegate" is true.
                 */
                if (that.getPlayerState().valueOf() === adways.interactive.Experience.playerStates.BUILT &&
                        that.getDelegateState().valueOf() === adways.interactive.Experience.delegateStates.EMPTY &&
                        that.autoBuildDelegate) {
                    that.buildDelegate();
//                res += (10 * that.buildDelegate());
//                res += 300;
                }
                else {
//                res += 400;
                    /*
                     * ????
                     * remark: the day "buildScene" becomes really asynchronous (done in a jsworker as an exemple, so parallel execution)
                     * testing for dispatchgin the deprecated event "READY" here is required
                     * ????
                     * probably no...
                     */
                    that.buildScene();
                }
            }
            //    }
            //    else that.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.PUBLICATION_JSON_CHANGED));

            //    return res;
            // setting the "publicationJSON" member is done, so return 1.
            // the logic around the "res" value is wrong, since "buildPlayer" or "buildDelegate" can return a negative value, res can become negative
            // while it must not since the execution is still "normal".
//        return res;

        };
        this.libLoadedErrorCb = function() {
            // dthibault 03.31.2016, this condition prevents errors if the lib is already loaded, to verify
            if (that.interactiveLibScriptTag !== null) {
                adways.misc.html.removeEventListener(that.interactiveLibScriptTag, "load", that.libLoadedCb);
                adways.misc.html.removeEventListener(that.interactiveLibScriptTag, "error", that.libLoadedErrorCb);
                adways.interactive.Experience.interactiveLibState.setV(adways.interactive.Experience.interactiveLibStates.ERROR);
                that.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.INTERACTIVE_LIB_STATE_CHANGED));
            }
        };

    };

//----------------------------------------------------------------------------------------------------------------------------------------------------

// Experience extends EventDispatcher, implements IInfoCollector
// note: implementing IInfoCollector will be removed in a near future.
    adways.oop.createClass(adways.interactive.Experience, adways.event.EventDispatcher, adways.experience.IInfoCollector);

//####################################################################################################################################################
    adways.interactive.Experience.timesheetPresets = new Object();
    
//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.sceneStates = new Object();
    adways.interactive.Experience.sceneStates.EMPTY = 1;
    adways.interactive.Experience.sceneStates.BUILDING = 2;
    adways.interactive.Experience.sceneStates.BUILT = 3;
    adways.interactive.Experience.sceneStates.ERROR = 4;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.playerStates = new Object();
    adways.interactive.Experience.playerStates.EMPTY = 1;
    adways.interactive.Experience.playerStates.BUILDING = 2;
    adways.interactive.Experience.playerStates.BUILT = 3;
    adways.interactive.Experience.playerStates.ERROR = 4;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.delegateStates = new Object();
    adways.interactive.Experience.delegateStates.EMPTY = 1;
    adways.interactive.Experience.delegateStates.BUILDING = 2;
    adways.interactive.Experience.delegateStates.BUILT = 3;
    adways.interactive.Experience.delegateStates.ERROR = 4;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.interactiveLibStates = new Object();
    adways.interactive.Experience.interactiveLibStates.EMPTY = 1;
    adways.interactive.Experience.interactiveLibStates.LOADING = 2;
    adways.interactive.Experience.interactiveLibStates.LOADED = 3;
    adways.interactive.Experience.interactiveLibStates.ERROR = 4;

    adways.interactive.Experience.interactiveLibState = new adways.type.evt.Enum(adways.interactive.Experience.interactiveLibStates, adways.interactive.Experience.interactiveLibStates.EMPTY);

//####################################################################################################################################################

    adways.interactive.Experience.IPhoneBehaviors = new Object();
    adways.interactive.Experience.IPhoneBehaviors.DEFAULT = 132;
    adways.interactive.Experience.IPhoneBehaviors.OPEN_CURRENT_PAGE_IN_ADWAYS_PLAYER = 133;
    adways.interactive.Experience.IPhoneBehaviors.OPEN_PUBLICATION_URL_IN_ADWAYS_PLAYER = 134;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    /*
     Détruit l'experience
     */
    adways.interactive.Experience.prototype.destroy = function() {
        this.clearAll();
        adways.destruct(this.aaaCollector);
        adways.destruct(this.playerJSAdapter);
        adways.destruct(this.playerState);
        adways.destruct(this.delegateState);
        adways.destruct(this.sceneState);
        adways.event.EventDispatcher.prototype.destroy.call(this);
        
//    adways.destruct(this.buildExp);
        return 1;
    };

//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.clearAll = function() {
        this.clearScene();
        adways.destruct(this.s2p);
        this.s2p = null;
        adways.destruct(this.p2s);
        this.p2s = null;
        this.clearPlayer(true);
        return 1;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.clearScene = function() {
        
        clearInterval(this.intervalTimesheet);
        this.intervalTimesheet = null;
        
        // cancel the json request if any
        // remember that destructing a adways.ajax.Request object also remove all its listeners, so the result is similar to cancelling the request...
        adways.destruct(this.jsonRequest);
        this.jsonRequest = null;

        if (this.clearSceneShouldResetPublicationID && this.publicationID !== "") {
            this.publicationID = "";
            this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.PUBLICATION_ID_CHANGED));
        }
        this.clearSceneShouldResetPublicationID = true;

        if (this.publicationJSON !== null) {
            this.publicationJSON = null;
            this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.PUBLICATION_JSON_CHANGED));
        }

        // destruct the scene if any
        if (this.scene !== null) {
            if (this.s2p != null)
                this.scene.setP2SController(null);
            if (this.p2s != null)
                this.scene.setS2PController(null);
            if (this.aaaCollector != null)
                this.aaaCollector.removeListenerOnScene();
            if (this.playerJSAdapter != null)
                this.playerJSAdapter.removeListenerOnScene();

            this.scene.getInfoCollector().removeInfoCollector(this);
            adways.interactive.io.unloadPublication(this.scene);
            adways.destruct(this.scene);
            this.scene = null;
        }

//    adways.destruct(this.s2p);
//    this.s2p = null;
//    adways.destruct(this.p2s);
//    this.p2s = null;
      if(!(arguments.length > 0 && !arguments[0])){
        if (this.s2p != null)
            this.s2p.pause();
        if (this.p2s != null)
            this.p2s.pause();
      }

        if (this.sceneState.valueOf() !== adways.interactive.Experience.sceneStates.EMPTY) {
            this.sceneState.setV(adways.interactive.Experience.sceneStates.EMPTY);
            this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.SCENE_STATE_CHANGED));
        }


        return 1;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    /*
     Ne détruit que le player et le delegate, pas la scène, pas les SceneControllerWrapper
     */
    adways.interactive.Experience.prototype.clearPlayer = function() {
        this.clearingPlayer = true;

        var full = (arguments.length > 0 && typeof (arguments[0]) === "boolean" ? arguments[0] : false);

        if (full) {
            if (this.delegateScriptTag !== null) {
                adways.misc.html.removeEventListener(this.delegateScriptTag, "load", this.delegateScriptTagLoadCB);
                adways.misc.html.removeEventListener(this.delegateScriptTag, "error", this.delegateScriptTagErrorCB);
                this.delegateScriptTag = null;
            }
            this.params[DELEGATE_PARAMS] = new Object();
            this.delegateBuilderURL = null;
            this.delegateBuilderClassname = null;
        }
        this.autoBuildDelegate = false;
        adways.destruct(this.delegate);
        this.delegate = null;
        adways.destruct(this.delegateBuilder);
        this.delegateBuilder = null;

        if (full) {
            if (this.playerScriptTag !== null) {
                adways.misc.html.removeEventListener(this.playerScriptTag, "load", this.playerScriptTagLoadCB);
                adways.misc.html.removeEventListener(this.playerScriptTag, "error", this.playerScriptTagErrorCB);
                this.playerScriptTag = null;
            }
            if (this.playerClassRequest !== null) {
                adways.misc.html.removeEventListener(this.playerClassRequest, "load", this.playerScriptTagLoadCB);
                adways.misc.html.removeEventListener(this.playerClassRequest, "error", this.playerScriptTagErrorCB);
                this.playerClassRequest = null;
            }
        }

        if (this.ownPlayer) {
            this.playerBuilder.destructPlayer();
        }
        adways.destruct(this.playerBuilder);
        this.playerBuilder = null;

        if (full) {
            this.params[PLAYER_PARAMS] = new Object();
            this.params[MEDIA_PARAMS] = new Object();
            this.params[PLAYER_OPTION_PARAMS] = new Object();
            this.params[SCENE_PARAMS] = new Object();
            this.params[EXPERIENCE_PARAMS] = new Object();
            this.playerBuilderURL = null;
            this.playerBuilderClassname = null;
            this.playerContainer = null;
        }

        this.autoBuildPlayer = false;
        this.playerAPI = null;
        this.ownPlayer = false;
        this.playerClassJSConstant = "";

        this.clearingPlayer = false;

        var dispatchDelegate = false;
        var dispatchPlayer = false;

        if (this.delegateState.valueOf() !== adways.interactive.Experience.delegateStates.EMPTY) {
            this.delegateState.setV(adways.interactive.Experience.delegateStates.EMPTY);
            dispatchDelegate = true;
        }

        if (this.playerState.valueOf() !== adways.interactive.Experience.playerStates.EMPTY) {
            this.playerState.setV(adways.interactive.Experience.playerStates.EMPTY);
            dispatchPlayer = true;
        }

        if (dispatchDelegate)
            this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.DELEGATE_STATE_CHANGED));
        if (dispatchPlayer)
            this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.PLAYER_STATE_CHANGED));

        return 1;
    };

//####################################################################################################################################################
    adways.interactive.Experience.prototype.setTimesheetPreset = function() {
        if (arguments.length < 1) {
            return -1;
        }
        if (typeof arguments[0] !== "number") {
            return -2;
        }
        var timesheetURL = "//d3iuja8fgpny0q.cloudfront.net/timesheets/presets/" + arguments[0]+".json"; 
        return this.setTimesheetURL(timesheetURL);
    };
    
    adways.interactive.Experience.prototype.setTimesheetJSON = function() {
        
        if (arguments.length < 1) {
            return -1;
        }
        if (typeof arguments[0] !== "string") {
            return -2;
        }
        var responseParsed = JSON.parse(arguments[0]);
//        console.log("responseParsed ", responseParsed);
        
        if (typeof responseParsed !== "object") {
           return -3;
        }
        var timesheet = responseParsed["timesheet"];
        if (typeof timesheet === "undefined") {
           return -4;
        }
        var enrichmentsDesc = timesheet["enrichments"];
        if (typeof enrichmentsDesc !== "object") {
           return -5;
        }
        
        var that = this;
        
        var processTimesheet = function() {
            var enrichments = that.getScene().getEnrichments().toArray();
            var hotspots = new Array();
            for(var i=0;i<enrichments.length;i++) {
                if (enrichments[i].getEnrichmentKind() === window.adways.hv.enrichmentKinds.HOTSPOT) {
                    hotspots.push(enrichments[i]);
                }                
            }
            
            for(var i=0;i<enrichmentsDesc.length;i++) {
//                        var enrichmentDesc = enrichmentsDesc[i];
                if(hotspots.length>i) {
                    hotspots[i].setBotActivation(new adways.type.evt.Boolean(false));
                }
            }
            
            var s2pCurrentTimeChangedTimesheetListener = function() {
                if(that.getP2S().getPlayState() === adways.resource.playStates.PLAYING) {
    //                var currentTime = that.getP2S().getCurrentTime();
                    var currentTime = that.getScene().getTime().valueOf();
    //                console.log(currentTime);
                    for(var i=0;i<enrichmentsDesc.length;i++) {
                        var enrichmentDesc = enrichmentsDesc[i];
                        var tInitObject = enrichmentDesc["tInit"];
                        var tInitValue = tInitObject["value"];
                        var tInitUnit = tInitObject["unit"];
                        var tInit = tInitValue;
                        if(tInitUnit === "millisecond") {
                            tInit/=1000;
                        }
                        if(tInitUnit === "minute") {
                            tInit*=60;
                        }
                        if(tInitUnit === "hour") {
                            tInit*=3600;
                        }
                        var durationObject = enrichmentDesc["duration"];
                        var durationValue = durationObject["value"];
                        var durationUnit = durationObject["unit"];
                        var duration = durationValue;
                        if(durationUnit === "millisecond") {
                            duration/=1000;
                        }
                        if(durationUnit === "minute") {
                            duration*=60;
                        }
                        if(durationUnit === "hour") {
                            duration*=3600;
                        }
                        var frequencyObject = enrichmentDesc["frequency"];
                        var frequencyValue = frequencyObject["value"];
                        var frequencyUnit = frequencyObject["unit"];
                        var frequency = frequencyValue;
                        if(frequencyUnit === "millisecond") {
                            frequency/=1000;
                        }
                        if(frequencyUnit === "minute") {
                            frequency*=60;
                        }
                        if(frequencyUnit === "hour") {
                            frequency*=3600;
                        }
    //                    console.log("enrichment ",i, tInit, duration, frequency);
                        if(hotspots.length>i) {
                            var enrichment = hotspots[i];
                            var relativeTime = (currentTime-tInit)%frequency;
//                            if (i==0) console.log(currentTime, "relativeTime 0", " <= ", relativeTime," < ", duration);
                            if((0<=relativeTime) && (relativeTime<(duration))) {
//                                console.log("enrichement ",i, currentTime);
//                                if(!enrichment.getActivated().valueOf()) {
                                if(!enrichment.getBotActivation().valueOf()) {
//                                    enrichment.open();
                                      enrichment.getBotActivation().setV(true);
                                }
                            } else {                            
//                                if(enrichment.getActivated().valueOf()) {
                                if(enrichment.getBotActivation().valueOf()) {
//                                    enrichment.close();
                                      enrichment.getBotActivation().setV(false);
                                }
                            }
                        }
                    }      
                }
            }
//            that.getP2S().addEventListener(adways.resource.events.CURRENT_TIME_CHANGED, s2pCurrentTimeChangedTimesheetListener, that);
            that.intervalTimesheet = setInterval(s2pCurrentTimeChangedTimesheetListener, 40);

            return 1;
        };
        
        var sceneStateChangedTimesheetCB = function () {
            switch (this.getSceneState().valueOf()) {
                case adways.interactive.Experience.sceneStates.BUILT:
                    that.removeEventListener(adways.interactive.Experience.Event.SCENE_STATE_CHANGED, sceneStateChangedTimesheetCB, this);   
                    processTimesheet(responseParsed);
                    break;
            }
        };
    
        if (this.getSceneState().valueOf() === adways.interactive.Experience.sceneStates.BUILT) {
            processTimesheet(responseParsed);
        }
        else 
            this.addEventListener(adways.interactive.Experience.Event.SCENE_STATE_CHANGED, sceneStateChangedTimesheetCB, this);    
    
        return 1;
    };
    
    adways.interactive.Experience.prototype.setTimesheetURL = function() {
        
        if (arguments.length < 1) {
            return -1;
        }
        if (typeof arguments[0] !== "string" && typeof arguments[0] !== "number" ) {
            return -2;
        }

        var timesheetURL = arguments[0];

        if(typeof(adways.tweaks.forceProtocol)!=="undefined") {
            if (timesheetURL.search(/^http[s]?\:\/\//) === -1) {
                timesheetURL = adways.tweaks.forceProtocol+":"+timesheetURL;
            }
        }  
        
        var timesheetRequest = new adways.ajax.Request();
        timesheetRequest.setURL(timesheetURL);
        timesheetRequest.setMethod("GET");
        timesheetRequest.addHeader("Accept", "application/json");
        timesheetRequest.setContentType("application/json");

        var that = this;

        var requestDoneListener = function(evt) {
            if (timesheetRequest != null && timesheetRequest.getState() === adways.ajax.states.DONE) {
                timesheetRequest.removeEventListener(adways.ajax.events.STATE_CHANGED, requestDoneListener);
                var responseText = timesheetRequest.getResponseText();
                timesheetRequest = null;
//                console.log("responseText ", responseText);
                that.setTimesheetJSON(responseText);
            }
        };

        timesheetRequest.addEventListener(adways.ajax.events.STATE_CHANGED, requestDoneListener);

        timesheetRequest.load();
        return 1;
    };  

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setPlayerClass = function(helper) {
        if (arguments.length < 1) {
            return -1;
        }
        if (typeof helper !== "object" && typeof helper !== "string") {
            return -2;
        }

        if (typeof helper === "string") {

            this.playerClassJSConstant = helper.toUpperCase();

        } else if (typeof helper === "object") {
            /*
             * les 4 paramètres sont obligatoires, car setPlayerClass est un shortcut pour setuper les 4 paramètres d'un coup. Il se trouve par
             * ailleurs qu'il existe une entité spécifique à Adways qui contient ces 4 valeurs.
             * Pour n'en setuper qu'une, alors il faut appeler la methode correspondante et oublier l'existence de setPlayerClass.
             */
            if (!(helper["player_builder_url"] && helper["player_builder_classname"] && helper["delegate_builder_url"] && helper["delegate_builder_classname"]))
                return -3;

//        if (helper["player_builder_url"] && helper["player_builder_classname"]) {
            this.setPlayerBuilderURL(helper["player_builder_url"]);
            this.setPlayerBuilderClassname(helper["player_builder_classname"]);
//        }

//        if (helper["delegate_builder_url"] && helper["delegate_builder_classname"]) {
            this.setDelegateBuilderURL(helper["delegate_builder_url"]);
            this.setDelegateBuilderClassname(helper["delegate_builder_classname"]);
//        }

        }

        return 1;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    /*
     * pour rendre exploitable cette methode, il faut que le dev tiers puisse ecrire un delegate, or pour cela il a besoin de la lib !
     * Malheureusement, tant que "load" ou "loadLib" n'est pas appelé, la lib n'est pas disponible donc les checking realisés avant la declaration
     * du delegate lancent des erreurs (du coup, impossible d'instancier le delegate a donner en 2e parametre de cette methode).
     
     adways.interactive.Experience.prototype.setPlayerAPIAndDelegate = function(playerAPI, delegate) {
     if (arguments.length < 2) {
     return -1;
     }
     if (typeof playerAPI !== "object") {
     return -2;
     }
     if (typeof delegate !== "object") {
     return -3;
     }
     
     if (!this.clearingPlayer) {
     var setPlayerAPIRes = this.setPlayerAPI(playerAPI);
     if (setPlayerAPIRes > 0) {
     // assert (delegateState===EMPTY); due to setPlayerAPIRes>0
     this.delegateState.setV(adways.interactive.Experience.delegateStates.BUILDING);
     this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.DELEGATE_STATE_CHANGED));
     var delegateReadyRes = this.delegateReady(delegate);
     //assert (delegateReadyRes>0);
     return delegateReadyRes;
     }
     else {
     // the call to setPlayerAPI fails
     switch (setPlayerAPIRes) {
     case -1:
     return -5;
     case -3:
     return -6;
     case -4:
     return -7;
     default:
     return -8; // should never happen
     }
     }
     }
     else {
     return -4;
     }
     };
     */

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype._requestPlayerClassFromJSConstant = function() {

        if (this.playerClassJSConstant === "")
            return -1;

        var playerClassGetURL = "//d1afeohcmx2qm4.cloudfront.net/player-class?filter-js_constant=" + this.playerClassJSConstant;

        if(typeof(adways.tweaks.forceProtocol)!=="undefined") {
            if (playerClassGetURL.search(/^http[s]?\:\/\//) === -1) {
                playerClassGetURL = adways.tweaks.forceProtocol+":"+playerClassGetURL;
            }
        }  
        
        this.playerClassRequest = new adways.ajax.Request();
        this.playerClassRequest.setURL(playerClassGetURL);
        this.playerClassRequest.setMethod("GET");
        this.playerClassRequest.addHeader("Accept", "application/json");
        this.playerClassRequest.setContentType("application/json");

        var that = this;

        var requestDoneListener = function(evt) {
            if (that.playerClassRequest != null && that.playerClassRequest.getState() === adways.ajax.states.DONE) {
                that.playerClassRequest.removeEventListener(adways.ajax.events.STATE_CHANGED, requestDoneListener);
                var responseText = that.playerClassRequest.getResponseText();
                that.playerClassRequest = null;
                var responseParsed = null;
//            try {
                responseParsed = JSON.parse(responseText);
//            } catch (e) {
//                console.warn(e);
//            }
                if (responseParsed['_embedded'] && responseParsed['_embedded']['collection']
                        && responseParsed['_embedded']['collection'][0]) {
                    that.setPlayerBuilderURL(responseParsed['_embedded']['collection'][0]["player_builder_url"]);
                    that.setPlayerBuilderClassname(responseParsed['_embedded']['collection'][0]["player_builder_classname"]);

                    var url = responseParsed['_embedded']['collection'][0]["delegate_builder_url"];
                    if (typeof (that.getExperienceParam("playUrlSubstitution")) != "undefined") {
                        var playUrlSubstitution = that.getExperienceParam("playUrlSubstitution");
                        url = url.replace(playUrlSubstitution[0], playUrlSubstitution[1]);
                    }

                    that.setDelegateBuilderURL(url);
                    that.setDelegateBuilderClassname(responseParsed['_embedded']['collection'][0]["delegate_builder_classname"]);

                    // debug
//                if (that.playerState.valueOf()===adways.interactive.Experience.playerStates.ERROR) throw "should not happen!!!";
//                if (that.delegateState.valueOf()===adways.interactive.Experience.delegateStates.ERROR) throw "should not happen!!!";
                    //

                    // pourquoi tester sur delegateState et non pas playerState ???
                    // car il y a un sous entendu: on arrive jamais ici:
                    // - si on n'est pas ownPlayer
                    // - ?
                    // bref ca marche
                    if (that.delegateState.valueOf() === adways.interactive.Experience.delegateStates.EMPTY)
                        that._buildPlayer();
                    else
                        that._buildDelegate();

                } else {
                    if (that.delegateState.valueOf() === adways.interactive.Experience.delegateStates.EMPTY) {
                        that.playerState.setV(adways.interactive.Experience.playerStates.ERROR);
                        that.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.PLAYER_STATE_CHANGED));
                    }
                    else {
                        that.delegateState.setV(adways.interactive.Experience.delegateStates.ERROR);
                        that.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.DELEGATE_STATE_CHANGED));
                    }
                }
            }
        };

        this.playerClassRequest.addEventListener(adways.ajax.events.STATE_CHANGED, requestDoneListener);

        this.playerClassRequest.load();

        return 1;
    };

//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setPlayerBuilderURL = function() {
        if (arguments.length < 1)
            return -1;
        if (typeof (arguments[0]) !== "string")
            return -2;
        if (this.getPlayerState().valueOf() !== adways.interactive.Experience.playerStates.EMPTY && !arguments[0])
            return -3;

        if (arguments[0] !== this.playerBuilderURL) {
            
            this.playerBuilderURL = arguments[0];
            
            if(typeof(adways.tweaks.forceProtocol)!=="undefined") {
                if (this.playerBuilderURL.search(/^http[s]?\:\/\//) === -1) {
                    this.playerBuilderURL = adways.tweaks.forceProtocol+":"+this.playerBuilderURL;
                }
            }
            
            return 1;
        }
        else
            return 0;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getPlayerBuilderURL = function() {
        return this.playerBuilderURL;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setPlayerBuilderClassname = function() {
        if (arguments.length < 1)
            return -1;
        if (typeof (arguments[0]) !== "string")
            return -2;
        if (this.getPlayerState().valueOf() !== adways.interactive.Experience.playerStates.EMPTY && !arguments[0]) //2016.07.25, dthibault, why !arguments[0]
            return -3;

        if (arguments[0] !== this.playerBuilderClassname) {
            this.playerBuilderClassname = arguments[0];
            return 1;
        }
        else
            return 0;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getPlayerBuilderClassname = function() {
        return this.playerBuilderClassname;
    };

//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setDelegateBuilderURL = function() {
        if (arguments.length < 1)
            return -1;
        if (typeof (arguments[0]) !== "string")
            return -2;
        if (this.getDelegateState().valueOf() !== adways.interactive.Experience.delegateStates.EMPTY && !arguments[0])
            return -3;

        if (arguments[0] !== this.delegateBuilderURL) {
            this.delegateBuilderURL = arguments[0];
            
            if(typeof(adways.tweaks.forceProtocol)!=="undefined") {
                if (this.delegateBuilderURL.search(/^http[s]?\:\/\//) === -1) {
                    this.delegateBuilderURL = adways.tweaks.forceProtocol+":"+this.delegateBuilderURL;
                }
            }
            return 1;
        }
        else
            return 0;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getDelegateBuilderURL = function() {
        return this.delegateBuilderURL;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setDelegateBuilderClassname = function() {
        if (arguments.length < 1)
            return -1;
        if (typeof (arguments[0]) !== "string")
            return -2;
        if (this.getDelegateState().valueOf() !== adways.interactive.Experience.delegateStates.EMPTY && !arguments[0])
            return -3;

        if (arguments[0] !== this.delegateBuilderClassname) {
            this.delegateBuilderClassname = arguments[0];
            return 1;
        }
        else
            return 0;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getDelegateBuilderClassname = function() {
        return this.delegateBuilderClassname;
    };

//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype._setParams = function() {
        // arguments[0]: object
        // arguments[1]: params entity enum
        if (typeof (arguments[0]) !== "object" || arguments[0] === null)
            return -1;

        this.params[arguments[1]] = arguments[0];
        return 1;

    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype._setParam = function() {
        // arguments[0]: key
        // arguments[1]: value
        // arguments[2]: params entity enum
        if (typeof (arguments[0]) !== "string" || arguments[0].length === 0)
            return -1;
        if (typeof (arguments[1]) === "undefined")
            return -2;

        if (typeof (this.params[arguments[2]][arguments[0]]) === "undefined") {
            this.params[arguments[2]][arguments[0]] = arguments[1];
        } else
        if (this.params[arguments[2]][arguments[0]] !== arguments[1]) {
            this.params[arguments[2]][arguments[0]] = arguments[1];
        }
        else
            return 0;


        return 1;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype._unsetParams = function() {
        this.params[arguments[0]] = new Object();
        return 1;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype._unsetParam = function() {
        if (typeof (arguments[0]) !== "string" || arguments[0].length === 0)
            return -1;
        if (typeof (this.params[arguments[1]][arguments[0]]) !== "undefined") {
            delete this.params[arguments[1]][arguments[0]];
            return 1;
        }
        else
            return 0;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype._getParams = function() {
        return this.params[arguments[0]];
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype._getParam = function() {
        if (typeof arguments[0] !== "string" || arguments[0].length < 1)
            return -1;
        else {
            return this.params[arguments[1]][arguments[0]];
        }
    };

//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setPlayerParams = function() {
        if (this.getPlayerState().valueOf() !== adways.interactive.Experience.playerStates.EMPTY)
            return -10;
        else {
            return this._setParams(arguments[0], PLAYER_PARAMS);
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setPlayerParam = function() {
        if (this.getPlayerState().valueOf() !== adways.interactive.Experience.playerStates.EMPTY)
            return -10;
        else {
            return this._setParam(arguments[0], arguments[1], PLAYER_PARAMS);
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.unsetPlayerParams = function() {
        if (this.getPlayerState().valueOf() !== adways.interactive.Experience.playerStates.EMPTY)
            return -10;
        else {
            return this._unsetParams(PLAYER_PARAMS);
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.unsetPlayerParam = function() {
        if (this.getPlayerState().valueOf() !== adways.interactive.Experience.playerStates.EMPTY)
            return -10;
        else {
            return this._unsetParam(arguments[0], PLAYER_PARAMS);
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getPlayerParams = function() {
        return this._getParams(PLAYER_PARAMS);
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getPlayerParam = function() {
        return this._getParam(arguments[0], PLAYER_PARAMS);
    };

//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setMediaParams = function() {
        if (this.getPlayerState().valueOf() !== adways.interactive.Experience.playerStates.EMPTY)
            return -10;
        else {
            return this._setParams(arguments[0], MEDIA_PARAMS);
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setMediaParam = function() {
        if (this.getPlayerState().valueOf() !== adways.interactive.Experience.playerStates.EMPTY)
            return -10;
        else {
            return this._setParam(arguments[0], arguments[1], MEDIA_PARAMS);
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.unsetMediaParams = function() {
        if (this.getPlayerState().valueOf() !== adways.interactive.Experience.playerStates.EMPTY)
            return -10;
        else {
            return this._unsetParams(MEDIA_PARAMS);
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.unsetMediaParam = function() {
        if (this.getPlayerState().valueOf() !== adways.interactive.Experience.playerStates.EMPTY)
            return -10;
        else {
            return this._unsetParam(arguments[0], MEDIA_PARAMS);
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getMediaParams = function() {
        return this._getParams(MEDIA_PARAMS);
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getMediaParam = function() {
        return this._getParam(arguments[0], MEDIA_PARAMS);
    };

//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------
// deprecated, replaced by setPlayerOptions
    adways.interactive.Experience.prototype.setOptions = function() {
        if (this.getPlayerState().valueOf() !== adways.interactive.Experience.playerStates.EMPTY)
            return -10;
        else {
            return this._setParams(arguments[0], PLAYER_OPTION_PARAMS);
        }
    };
    adways.interactive.Experience.prototype.setPlayerOptions = adways.interactive.Experience.prototype.setOptions;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setOption = function() {
        if (this.getPlayerState().valueOf() !== adways.interactive.Experience.playerStates.EMPTY)
            return -10;
        else {
            return this._setParam(arguments[0], arguments[1], PLAYER_OPTION_PARAMS);
        }
    };
    adways.interactive.Experience.prototype.setPlayerOption = adways.interactive.Experience.prototype.setOption;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.unsetOptions = function() {
        if (this.getPlayerState().valueOf() !== adways.interactive.Experience.playerStates.EMPTY)
            return -10;
        else {
            return this._unsetParams(PLAYER_OPTION_PARAMS);
        }
    };
    adways.interactive.Experience.prototype.unsetPlayerOptions = adways.interactive.Experience.prototype.unsetOptions;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.unsetOption = function() {
        if (this.getPlayerState().valueOf() !== adways.interactive.Experience.playerStates.EMPTY)
            return -10;
        else {
            return this._unsetParam(arguments[0], PLAYER_OPTION_PARAMS);
        }
    };
    adways.interactive.Experience.prototype.unsetPlayerOption = adways.interactive.Experience.prototype.unsetOption;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getOptions = function() {
        return this._getParams(PLAYER_OPTION_PARAMS);
    };
    adways.interactive.Experience.prototype.getPlayerOptions = adways.interactive.Experience.prototype.getOptions;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getOption = function() {
        return this._getParam(arguments[0], PLAYER_OPTION_PARAMS);
    };
    adways.interactive.Experience.prototype.getPlayerOption = adways.interactive.Experience.prototype.getOption;
//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setSceneParams = function() {
        if (this.getSceneState().valueOf() !== adways.interactive.Experience.sceneStates.EMPTY)
            return -10;
        else {
            return this._setParams(arguments[0], SCENE_PARAMS);
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setSceneParam = function() {
        if (this.getSceneState().valueOf() !== adways.interactive.Experience.sceneStates.EMPTY)
            return -10;
        else {
            return this._setParam(arguments[0], arguments[1], SCENE_PARAMS);
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.unsetSceneParams = function() {
        if (this.getSceneState().valueOf() !== adways.interactive.Experience.sceneStates.EMPTY)
            return -10;
        else {
            return this._unsetParams(SCENE_PARAMS);
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.unsetSceneParam = function() {
        if (this.getSceneState().valueOf() !== adways.interactive.Experience.sceneStates.EMPTY)
            return -10;
        else {
            return this._unsetParam(arguments[0], SCENE_PARAMS);
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getSceneParams = function() {
        return this._getParams(SCENE_PARAMS);
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getSceneParam = function() {
        return this._getParam(arguments[0], SCENE_PARAMS);
    };

//####################################################################################################################################################
//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setExperienceParams = function() {
        return this._setParams(arguments[0], EXPERIENCE_PARAMS);
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setExperienceParam = function() {
        return this._setParam(arguments[0], arguments[1], EXPERIENCE_PARAMS);
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.unsetExperienceParams = function() {
        return this._unsetParams(EXPERIENCE_PARAMS);
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.unsetExperienceParam = function() {
        return this._unsetParam(arguments[0], EXPERIENCE_PARAMS);
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getExperienceParams = function() {
        return this._getParams(EXPERIENCE_PARAMS);
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getExperienceParam = function() {
        return this._getParam(arguments[0], EXPERIENCE_PARAMS);
    };

//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setDelegateParams = function() {
        if (this.getDelegateState().valueOf() !== adways.interactive.Experience.delegateStates.EMPTY)
            return -10;
        else {
            return this._setParams(arguments[0], DELEGATE_PARAMS);
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setDelegateParam = function() {
        if (this.getDelegateState().valueOf() !== adways.interactive.Experience.delegateStates.EMPTY)
            return -10;
        else {
            return this._setParam(arguments[0], arguments[1], DELEGATE_PARAMS);
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.unsetDelegateParams = function() {
        if (this.getDelegateState().valueOf() !== adways.interactive.Experience.delegateStates.EMPTY)
            return -10;
        else {
            return this._unsetParams(DELEGATE_PARAMS);
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.unsetDelegateParam = function() {
        if (this.getDelegateState().valueOf() !== adways.interactive.Experience.delegateStates.EMPTY)
            return -10;
        else {
            return this._unsetParam(arguments[0], DELEGATE_PARAMS);
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getDelegateParams = function() {
        return this._getParams(DELEGATE_PARAMS);
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getDelegateParam = function() {
        return this._getParam(arguments[0], DELEGATE_PARAMS);
    };

//####################################################################################################################################################

    adways.interactive.Experience.prototype.interactiveLibStateChangedCb = function() {
        adways.interactive.Experience.interactiveLibState.removeEventListener(adways.type.evt.ENUM, this.interactiveLibStateChangedCb, this);
        if (adways.interactive.Experience.interactiveLibState.valueOf() === adways.interactive.Experience.interactiveLibStates.LOADED) {
            this.libLoadedCb();
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.loadInteractiveLib = function() {

        if (adways.interactive.Experience.interactiveLibState.valueOf() === adways.interactive.Experience.interactiveLibStates.EMPTY
                || adways.interactive.Experience.interactiveLibState.valueOf() === adways.interactive.Experience.interactiveLibStates.ERROR) {

            adways.interactive.Experience.interactiveLibState.setV(adways.interactive.Experience.interactiveLibStates.LOADING);
            this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.INTERACTIVE_LIB_STATE_CHANGED));

            this.interactiveLibScriptTag = document.createElement("script");
            if (typeof (adways.tweaks.isIE) == "number" && adways.tweaks.isIE <= 8)
                this.interactiveLibScriptTag.type = "text/javascript";
            else
                this.interactiveLibScriptTag.type = "application/javascript";
            var interactiveLibScriptTagSrc = "//dj5ag5n6bpdxo.cloudfront.net/libs/interactive/release.min.js";
            
            if(typeof(adways.tweaks.forceProtocol)!=="undefined") {
                if (interactiveLibScriptTagSrc.search(/^http[s]?\:\/\//) === -1) {
                    interactiveLibScriptTagSrc = adways.tweaks.forceProtocol+":"+interactiveLibScriptTagSrc;
                }
            }
            
            this.interactiveLibScriptTag.src = interactiveLibScriptTagSrc;
            
            if (typeof (this.getExperienceParam("playUrlSubstitution")) != "undefined") {
                var playUrlSubstitution = this.getExperienceParam("playUrlSubstitution");
                this.interactiveLibScriptTag.src = this.interactiveLibScriptTag.src.replace(playUrlSubstitution[0], playUrlSubstitution[1]);
            }

            adways.misc.html.addEventListener(this.interactiveLibScriptTag, "load", this.libLoadedCb);
            adways.misc.html.addEventListener(this.interactiveLibScriptTag, "error", this.libLoadedErrorCb);

            document.getElementsByTagName("head")[0].appendChild(this.interactiveLibScriptTag);
        } else if (adways.interactive.Experience.interactiveLibState.valueOf() === adways.interactive.Experience.interactiveLibStates.LOADED) {
            this.libLoadedCb();
        } else /*if(adways.interactive.Experience.interactiveLibState.valueOf() === adways.interactive.Experience.interactiveLibStates.LOADING)*/ {
            adways.interactive.Experience.interactiveLibState.addEventListener(adways.type.evt.ENUM, this.interactiveLibStateChangedCb, this);
        }
    };
//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getSceneTimeReference = function() {
        return this.sceneTimeReference;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setSceneTimeReference = function(sceneTimeReference) {

        if (arguments.length < 1)
            return -1;
        if (typeof (arguments[0]) !== "boolean")
            return -2;

        // may never happen since building the scene is synchron
        if (this.sceneState.valueOf() !== adways.interactive.Experience.sceneStates.EMPTY)
            return -3;

        if (this.sceneTimeReference !== sceneTimeReference) {
            this.sceneTimeReference = sceneTimeReference;
            if (this.scene != null) {
                this.scene.getSendStreamSizeToPlayer().setV(this.ownPlayer && !this.sceneTimeReference);
            }
            return 1;
        }
        else
            return 0;
    };
//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setPublicationJSON = function(publicationJSON) {

        if (arguments.length < 1) {
            return -1;
        }
        if (typeof (publicationJSON) !== "object" || publicationJSON === null || typeof (publicationJSON.publication) !== "object") {
            console.warn("Adways Loader: the publication JSON is not valid or does not exist.");
            return -2;
        }
        // may never happen since building the scene is synchron
//    if (this.getSceneState().valueOf()===adways.interactive.Experience.sceneStates.BUILDING) return -3;

        this.clearScene();

        this.publicationJSON = publicationJSON;
        if (/*opt param autoLoadLib*/(typeof (arguments[1]) === "boolean") ? arguments[1] : false) {
            if (this.ownPlayer &&
                    this._redirectToIOSApp &&
                    this._iphoneBehavior !== adways.interactive.Experience.IPhoneBehaviors.DEFAULT) {
                this._buildRedirectionPreview();
            } else {
                this.loadInteractiveLib();
            }
        }
        return 1;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------

    adways.interactive.Experience.prototype._buildRedirectionPreview = function() {
        if (this._redirectionAlreadyCreated) {
            return -1;
        }
        var that = this;

        var customCss = '\
        @import "https://fonts.googleapis.com/css?family=Work+Sans";\
        .adways-iphone-embed-preview{position:relative;width:100%;height:100%;font-family:"Work Sans",Arial;}\
        .adways-iphone-embed-thumbnail{position:absolute;top:0;left:0;width:100%;height:100%;}\
        .adways-iphone-embed-shadow{\
            position: absolute;\
            top:0;\
            left:0;\
            width: 100%;\
            height: 100%;\
            background: rgb(0,0,0);\
            background: rgba(0,0,0,0.8);\
        }\
        .adways-iphone-embed-buttons{\
            font-family:"Work Sans",Arial;\
            text-decoration:none;\
            background:rgb(40,191,200);\
            background:rgba(40,191,200,0.28);\
            display:inline-block;\
            color: #fff;\
            min-width:290px;\
            font-size:20px;\
            text-transform: uppercase;\
            border:3px solid #28bfc8;\
            padding:18px 10px;\
            vertical-align:middle;\
            text-align:center;\
        }\
        .adways-iphone-embed-buttons:hover{color: #fff;text-decoration:none;}\
        table.adways-iphone-embed-table{width:100%;height:80%;border:0;margin-top:5%}\
        table.adways-iphone-embed-table tr, table.adways-iphone-embed-table tr td{vertical-align:middle;text-align:center;}\
        \\';
        var styleTag = document.createElement("style");
        styleTag.styleSheet ? styleTag.styleSheet.cssText = customCss : styleTag.appendChild(document.createTextNode(customCss)), styleTag.type = "text/css", document.getElementsByTagName("head")[0].appendChild(styleTag);


        var previewDiv = document.createElement("div");
        previewDiv.className = 'adways-iphone-embed-preview';
        this.getPlayerContainer().appendChild(previewDiv);

        var previewThumbnail = new Image();
        previewThumbnail.className = 'adways-iphone-embed-thumbnail';

        var previewShadow = document.createElement('div');
        previewShadow.className = 'adways-iphone-embed-shadow';
        previewShadow.innerHTML = '<table border=0 width="100%" height="100%" class="adways-iphone-embed-table" border="0"><tr>\
                                    <td><a href="//www.adways.com" target="_blank"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALYAAAAkCAYAAAAkXsBMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NDkxMSwgMjAxMy8xMC8yOS0xMTo0NzoxNiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo1NzFFRkFENjY4ODQxMUU2QkQ0NjkxQkQ2QzcyREI5RCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo1NzFFRkFENzY4ODQxMUU2QkQ0NjkxQkQ2QzcyREI5RCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjU3MUVGQUQ0Njg4NDExRTZCRDQ2OTFCRDZDNzJEQjlEIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3MUVGQUQ1Njg4NDExRTZCRDQ2OTFCRDZDNzJEQjlEIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+DfZ51QAACm1JREFUeNrsXAlwFVUWffmRJRAiAoKiKCgjAi6MgwqIwiACJe6F2yjqqDgiDItacUNFBh3XiCKu6KDigjoFjLiMuIQRVBQNLqwFuCAaERAjIBLC917+6fLmTv/u9/q3ELRP1anql3/f0q9vv+W+08lLp9NmB0IhsbVIryF+YRIkUNhpB2tvR+IbIv0o8bzkMSbQSCVdkCBx7AQJEsdOkCBx7AQJEsdOkCAMNSEq0ojYi3g4sQWxMXG9yYTyPiH+jzibmE4e1+8WDYmV8IucHbs58UxiT+KBSOcRfySuJM4hvkZ8glhB/CdxoMh/HHFmQPm7E/9BPIdYK6SdC4m3ET8LsfsTsb9Ic5u+seyLg4jni/TdxGUxPZihxFa4LiVOschTgL7vSuxAbEPchViE3zcTy4mfEstMJgw6XT18+UyuIt6Xpa6Tid1wPZk4I8f7LUDdBv5ylWU+9q/OxBOIXXDPTZXN97jnxcRZxOeRrg4+oFFsQBxH3JS2w3riaOJ96u/dfcr22If4Xdody1R6giq3DnGB+P2JgDZo7kQsE3lfcsgbxE6izI3EViH2zYglxLUR+mct8jZBWWPEb8MC6rS1s2VD1SabPKcRF6Wj4XXiobI8PWLzqd5LpvrpXhjqEa9xWCocixHLb5ReCdYn7kGsrX5vFVL2T8SLsHxh/IX4CGaWMGxG3new9+hD7Ed8LoeRi0egMSJ9p+/o8gsuIJaIUdlgCv6Q+BFGaB6x6qCPWhLbYkblunYmDieeq2afmgxu9/3oe4lVxPeIS4mr8bf6mLX2wezs9dOfiW8TBxEf0CP27sTlPm/DauIk4o3EK4m3EKcRK0LeIr8Re1/iOmXH6euJLZVtbWI34pSAOiZkefvHC5uFGMltR5s7Rd7lmMGijlxnirK+CigrD7Oknp3+RtzFop5msF0i8m8hLt0BRuzB6r5fxnNPWcywxxDfUvn7bJWJCMNXlAFPm5cRC7IUXEi8Gna2jj1N2XxJbGPRUWcQqxwcm53hG2E3wuGh8H19LvLeEfHhcr99Ico5L8B2tLDj+xzp+DLKh11M3OzTVzXVseXy8taI9/xvUQYvRfO8H3urTuCO6WlZcK8sTqcdu61PHZ0dbmCEg2Pr0fJHzBa2dfVV7TwoQodfJ8p4F6Oyn11HjK4ezorBsU70eSY10bELVBsbRayvKbFSlHOgF8ceqNY3txBftVwjvQL7MJym0k9jXWSLW7HGtMVTxP/iui7xHoe8LxAn4Tof0YQ8h/wcQSpWUZFse5ARouwSRJlyxVSs52s6NoIe9o9YDu/LPhDprY7NG8hjxB83oYNdwPZVITadVXq8Yx3crmcc81yCcJMRm0Fb1BXXXRw3Yzdho8N4MuAFLsJm2nvIN8boNDdjQ1yTkTbV1ZocuhtgMvJkV/Am/QZwcQqRhnrC4D2xC7XFKsS1g9BCpWdHaLxrHo5Dj1Q338AiX3fiiT6zWGOLvB0Rm2dsUCO3xiEiOlSKQ6m4sMpxRtxeGI62eod1DxK/Jb5FHEccjJe/nRps/GbokeAcduwmymBRxAYuDfld1rNWjKQu+DZCnhKEygxCiKNC7FNqGvcOPBpjFLSpL0+MmisCbPcS1/N+BadZtAM4NrfxMOLLarbsjBl3LJaG8+Az5TiY4TDuMIT9Un4HNMVqAf9hxAX8gpDNSpUKRUWpQ28gl1jm+6vKd2qA7SPCjjckZ6u8AwLylqi8YZshGZYsjelASFIeOE2Owc6We0d81vxcZvmEhMPAG/zp2ERuLSvls0mMOnIsVum5Kr1ABeXrR9wkSMy0zPcvtXm81PgLwAqxFvfAkoKJau07OIsUoQ6Opj2cZbG0mJ6lf+LCEnEddEw+w9LOFnI2rnDI9yzxCDwHPpxrj+P1SzD7TcSSTX8OmA/5wWwsWbY+3C+V0WERbiSFBgVBn7h1iVBPrxw6+xqxLOhEvNDH5gqT0bB4a17v1HG0WGqxpuTvPnmH4SSQ8ablRne+uO4Us1PbPJNfC7tZ2LTB4DcXkTWNSvTP84hKsd6kP04Z98ay8gyT0bZ4ESfu/2k8aKYwCn4uCtzXZJR2LjjdYmNVqtIXOtbBx/wn5dDZFcoheQTYVW1uL8d1lbLliMXFIj0KHeuhGV4cb6c/xLJN80QIswM2k3HhdPGShmGLGv1yxR8tbHjvcjDYzYQL4TS+Qkj2FOKRxB/wdw6G9EuJHaXeANlWxJ13u4XdMyokyHHt3pZ18LT0eAydPhkxXgZrDm5Tju7tunmE+ETlfRVTobdkkRqQ0SLaMt5nGRbkUA+J9L3m//UxUbCXap/LEq9FDPUPsLBZIZZqtRGJiopZKnzc3lu0N4dKT+IpYt2QxX5r4nyHI/XxyuZ7Yo+QOngD9qKjViSILZTO5Sji4SK9KkCfsSu0Mx5641SyStxPU8f2FKmj9ykBMgYbcns+dTxS7ynsVuRY/0AfxWE224eF3Uxifg71ThRl3RAkRkmjwwfhODpPSEO7Eu/CUbWLCKoxOk7jOeLJxD3RqewcRxBvDpFvTojYCUNEGfOVkObikLznq6hMqUhfFrE9fKz+gxJuHedYRhNEZTYq3YmNY+crARU7SS3H+lm0NNznKD/Isf+g2jsZYjzX/uun9DHdtMG4ACfa4hiGyabHPoS4Jh0Pojp2PvQbGmUWowa/4DN88i6GIjHqiHMoRGFpJehhzcnRPjMBDwAHI5TJIqCfVN5nifc7aEB6KA3+HGhOwmbtQojUygI04kH5+yv7DQi5cpnts8wejdBfg3yexVSt7vMeWrESlNhgJfFthw8NWBA1z7GOTRjZ43BsZgcfFdyRlnnb+jhS3xjiv/zAHsiizpPLt6CPQFjVeEFEcVNflK8dbRY+2hiDWWEs0h/4qDvZfqjjhwbHE8sD7qkK5azNIriTH5bU83NsjywlfSxkqeHJTq/DmnSMg2N7euuhagr0A7fhceL+KDMuxzaQSco9hUveUUpDHOfBCh9wXEv82OGAYgY02YWOqj1eVp4Ect498HKtdxx4KtGHrbGPkTp0W7kwL+XmOtZbge8Fusry8kL+d18Bjjbb4UicowbfYRfNwfCFIlTUyFT/8qPcVFduBaEd4ud7IuKwDjtm/nLkfVFOXRUjXSd0BlHAu/HmIjKwwSFvLRHyWy3CTXGjCUKB+5nMFzJFiPFyn3yNg7G5xv9DV/lM1mQ5LPkP8Xhc9yW+iOuGODc42mRUd/sg8tMA/c71LUfIcibixyvFeYOnrCyLEMbk7xwPgF80Q51F8LV1kFZwVOVjyCUqdQFhjp3gtw8WDV2P60k49MgVU3FiaKD1GLKtbyr5vyIJJqlDnX45lneFcGoeNR/eHjeVOHaCBcr52NFvMnYSXQlesr5gqisgx2I5uc2RLEUSeHspXmv3VDICPtFjTfcyrJ/Xi70Or3lbmsxX8j1MdQkuY4LJyCaqEsdOsD3Bm2HWyhRj4xgVrCi81mQ+/dtuSBw7gQZHpThKwl8QcaQq7H+5cDSIPxZ43WQiKm+a6qKqxLET1Eiwbp6FUayEzMe+jJcpHBotN24fWG8z/CzAAKf6X/1vJTVuAAAAAElFTkSuQmCC" alt="Adways Logo" /></a></td></tr>\
                                    <tr><td><a href="' + this._getIOSRedirectionFallbackURL() + '" target="_blank" class="adways-iphone-embed-buttons">Download App</a></td></tr>\
                                    <tr><td><a href="' + this._getIOSRedirectionURL() + '" class="adways-iphone-embed-buttons">Open in Adways Player</a></td></tr></table>';

        previewDiv.appendChild(previewThumbnail);
        previewDiv.appendChild(previewShadow);

        if (this.publicationJSON.project.media.thumbnails &&
                this.publicationJSON.project.media.thumbnails[0] &&
                typeof (this.publicationJSON.project.media.thumbnails[0].location) === "string" &&
                this.publicationJSON.project.media.thumbnails[0].location !== "") {
            previewThumbnail.src = this.publicationJSON.project.media.thumbnails[0].location;
        }
        this._redirectionAlreadyCreated = true;
        return 1;
    };
//----------------------------------------------------------------------------------------------------------------------------------------------------

    adways.interactive.Experience.prototype._getIOSRedirectionURL = function() {
        if (this._iphoneBehavior === adways.interactive.Experience.IPhoneBehaviors.OPEN_CURRENT_PAGE_IN_ADWAYS_PLAYER) {
            return "adw://" + window.location;
        } else if (this._iphoneBehavior === adways.interactive.Experience.IPhoneBehaviors.OPEN_PUBLICATION_URL_IN_ADWAYS_PLAYER &&
                this.publicationJSON.publication &&
                this.publicationJSON.publication.id &&
                this.publicationJSON.publication.id != "") {
            return "adw://http:" + "//play.adways.com/experience/" + this.publicationJSON.publication.id;
        }
        return "";
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------

    adways.interactive.Experience.prototype._getIOSRedirectionFallbackURL = function() {
        return "https://itunes.apple.com/fr/app/adways-interactive-video-player/id1094348745?mt=8";
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getPublicationJSON = function() {
        return this.publicationJSON;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setPublicationID = function(publicationID) {

        if (arguments.length < 1)
            return -1;
        if (typeof (arguments[0]) !== "string")
            return -2;

        // may never happen since building the scene is synchron
        if (this.getSceneState().valueOf() === adways.interactive.Experience.sceneStates.BUILDING)
            return -3;

        if (this.publicationID !== publicationID) {

            this.clearScene();

            this.publicationID = publicationID;
            this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.PUBLICATION_ID_CHANGED));
            this.clearSceneShouldResetPublicationID = false;

            if (/*opt param autoRequest*/(typeof (arguments[1]) === "boolean") ? arguments[1] : false) {
                this.requestPublicationJSON();
            }

            return 1;
        }
        else
            return 0;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.requestPublicationJSON = function(publicationURL, givenPass) {

        var givenPublicationURL = publicationURL;
    
        if (this.publicationID === "" && typeof publicationURL != "string")
            return -1;
        if(typeof(adways.tweaks)!=="undefined" && typeof(adways.tweaks.currentPublication)!=="undefined" && adways.tweaks.currentPublication!==null) {
            if (this.setPublicationJSON(adways.tweaks.currentPublication, true) < 0) {
                this.sceneState.setV(adways.interactive.Experience.sceneStates.ERROR);
                this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.SCENE_STATE_CHANGED));
                delete adways.tweaks.currentPublication;
            }
            return 1;
        }

        var publicationLoadURL = "";

        if (typeof publicationURL == "string") {
            publicationLoadURL = publicationURL;
        } else {
            publicationLoadURL = "//d1afeohcmx2qm4.cloudfront.net/load-publication/" + this.publicationID;
        }

        if(typeof(adways.tweaks.forceProtocol)!=="undefined") {
            if (publicationLoadURL.search(/^http[s]?\:\/\//) === -1) {
                publicationLoadURL = adways.tweaks.forceProtocol+":"+publicationLoadURL;
            }
        }
     
        this.jsonRequest = new adways.ajax.Request();
        this.jsonRequest.setURL(publicationLoadURL);
        this.jsonRequest.setMethod("GET");
        this.jsonRequest.addHeader("Accept", "application/json");
        
        if (typeof givenPass == "string" && givenPass != "") {
            this.jsonRequest.addHeader("X-Adways-Password", givenPass);
        }
        
        this.jsonRequest.setContentType("application/json");

        var that = this;

        var requestDoneListener = function(evt) {
            if (that.jsonRequest != null && that.jsonRequest.getState() === adways.ajax.states.DONE) {
                
                that.jsonRequest.removeEventListener(adways.ajax.events.STATE_CHANGED, requestDoneListener);
                var responseText = that.jsonRequest.getResponseText();
                var reqStatus = that.jsonRequest.getXHR().status;
                that.jsonRequest = null;
                
                if(responseText=="" && reqStatus == 403) {
                    if(that.getPlayerContainer() != null) {

                        var inputWidth = 200;
                        var inputPadding = 2;
                        var boxPadding = 15;
                        var buttonStyle = {
                            "padding": "3px 20px", 
                            "backgroundColor": "#e1e1e1", 
                            "border": "1px solid #adadad",
                            "marginTop": "14px",
                            "cursor": "pointer"
                        };
                        var mouseOverButtonStyle = {
                            "backgroundColor": "#e5f1fb", 
                            "border": "1px solid #0078d7"
                        };
                        
                        var inputContainer = document.createElement('div');
                        inputContainer.style.position = "absolute";
                        inputContainer.style.top = "25%";
                        inputContainer.style.left = "50%";
                        inputContainer.style.marginLeft = "-"+((inputWidth/2)+boxPadding)+"px";
                        inputContainer.style.width = inputWidth+(2*boxPadding) + "px";
                        inputContainer.style.border = "1px solid #696969";
                        inputContainer.style.backgroundColor = "white";
                        inputContainer.style.fontSize = "12px"; 
                        inputContainer.style.fontFamily = "Arial,sans-serif"; 

                        var topContainer = document.createElement('div');
                        topContainer.style.margin = boxPadding + "px";
                        topContainer.style.textAlign = "center";
                        
                        var boxDescription = document.createElement('div');
                        boxDescription.innerHTML = "Enter password";
                        topContainer.appendChild(boxDescription);
                        
                        
                        
                        var inputPassword = document.createElement('input');
                        inputPassword.type = "password";
                        inputPassword.autocomplete="off";
                        inputPassword.style.marginTop = "10px";
                        inputPassword.style.width = (inputWidth-(2*inputPadding)) + "px";
                        inputPassword.style.padding = inputPadding + "px";
                        topContainer.appendChild(inputPassword);

                        var bottomContainer = document.createElement('div');
                        bottomContainer.style.paddingRight = boxPadding + "px";
                        bottomContainer.style.height = "55px";
                        bottomContainer.style.borderTop = "1px solid #e6e6e6";
                        bottomContainer.style.backgroundColor = "#f2f2f2";
                        
                        var submitButton = document.createElement('div');
                        submitButton.innerHTML = 'OK';
                        submitButton.style.cssFloat = "right";
                        
                        for(var styleName in buttonStyle) submitButton.style[styleName] = buttonStyle[styleName];
                        
                        adways.misc.html.addEventListener(submitButton, "mouseout", function() {
                            for(var styleName in buttonStyle) submitButton.style[styleName] = buttonStyle[styleName];
                        });
                        
                        adways.misc.html.addEventListener(submitButton, "mouseover", function() {
                            for(var styleName in mouseOverButtonStyle) submitButton.style[styleName] = mouseOverButtonStyle[styleName];
                        });
                       
                        
                        var cancelButton = document.createElement('div');
                        cancelButton.innerHTML = 'Cancel';
                        cancelButton.style.cssFloat = "right";
                        cancelButton.style.marginLeft = "10px";
                        
                        for(var styleName in buttonStyle) cancelButton.style[styleName] = buttonStyle[styleName];
                        
                        adways.misc.html.addEventListener(cancelButton, "mouseout", function() {
                            for(var styleName in buttonStyle) cancelButton.style[styleName] = buttonStyle[styleName];
                        });
                        
                        adways.misc.html.addEventListener(cancelButton, "mouseover", function() {   
                            for(var styleName in mouseOverButtonStyle) cancelButton.style[styleName] = mouseOverButtonStyle[styleName];
                        });
                        
                        
                        bottomContainer.appendChild(cancelButton);
                        bottomContainer.appendChild(submitButton);
                        
                        inputContainer.appendChild(topContainer);
                        inputContainer.appendChild(bottomContainer);
                        
                        that.getPlayerContainer().appendChild(inputContainer);
                        
                        var removePrompt = function() {
                            that.getPlayerContainer().removeChild(inputContainer);                        
                        }
                        
                        adways.misc.html.addEventListener(submitButton, "click", function() {
                            removePrompt();
                            that.requestPublicationJSON(givenPublicationURL , inputPassword.value);
                        });
                        
                        adways.misc.html.addEventListener(cancelButton, "click", function() {
                            removePrompt();
                            that.requestPublicationJSON(givenPublicationURL , "");
                        });
                    }
                } else if (that.setPublicationJSON(JSON.parse(responseText), true) < 0) {
                    that.sceneState.setV(adways.interactive.Experience.sceneStates.ERROR);
                    that.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.SCENE_STATE_CHANGED));
                }
            }
        };

        this.jsonRequest.addEventListener(adways.ajax.events.STATE_CHANGED, requestDoneListener);

        this.jsonRequest.load();

        return 1;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getPublicationID = function() {
        return this.publicationID;
    };

//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getSceneState = function() {
        return this.sceneState;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getScene = function() {
        return this.scene;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.buildScene = function() {

        if (this.sceneState.valueOf() !== adways.interactive.Experience.sceneStates.EMPTY)
            return -1;
        if (this.publicationJSON === null)
            return -2;
        if (this._redirectToIOSApp &&
                this._iphoneBehavior !== adways.interactive.Experience.IPhoneBehaviors.DEFAULT) {
            return -3;
        }

        this.sceneState.setV(adways.interactive.Experience.sceneStates.BUILDING);
        this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.SCENE_STATE_CHANGED));

//    this.scene = new adways.interactive.Scene();
        this.scene = new adways.interactive.Scene(this.sceneTimeReference ? adways.interactive.sceneTimeReferences.SELF_WITH_PLAY_STATE : adways.interactive.sceneTimeReferences.SCW);
//    this.scene = new adways.interactive.Scene(adways.interactive.sceneTimeReferences.SELF_WITH_PLAY_STATE);
        this.scene.getSendStreamSizeToPlayer().setV(this.ownPlayer && !this.sceneTimeReference);
        this.scene.getInfoCollector().addInfoCollector(this);


        this.scene.setP2SController(this.getP2S());
        this.scene.setS2PController(this.getS2P());
        
        var options = this.getOptions();
        if (typeof(options)!=="undefined" && (typeof(options.autoplay) === "boolean" || typeof(options.autoplay) === "number" )) {
            if(this.ownPlayer && options.autoplay) {
                if(window.adwMobileAndTabletcheck() || adways.misc.html.userAgent.UA.browser[0].identifier === adways.misc.html.userAgent.SAFARI
                    /*|| adways.misc.html.userAgent.UA.browser[0].identifier === adways.misc.html.userAgent.CHROME*/) {
                    this.getS2P().mute(true);   
                }
            }            
        }

        if (typeof (this.getSceneParam("contentUrlSubstitution")) != "undefined") {
            if (typeof (adways.tweaks.contentUrlSubstitution) == "undefined") {
                adways.tweaks.contentUrlSubstitution = new Object();
            }
            adways.tweaks.contentUrlSubstitution = this.getSceneParam("contentUrlSubstitution");
        }
        if (typeof (this.getSceneParam("analyticsUrlSubstitution")) != "undefined") {
            if (typeof (adways.tweaks.analyticsUrlSubstitution) == "undefined") {
                adways.tweaks.analyticsUrlSubstitution = new Object();
            }
            adways.tweaks.analyticsUrlSubstitution = this.getSceneParam("analyticsUrlSubstitution");
        }
        adways.interactive.io.loadPublication(this.scene, this.publicationJSON);
        delete adways.tweaks.contentUrlSubstitution;
        delete adways.tweaks.analyticsUrlSubstitution;

        this.sceneState.setV(adways.interactive.Experience.sceneStates.BUILT);
        this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.SCENE_STATE_CHANGED));

        ////// deprecated event
        if (this.getDelegateState().valueOf() === adways.interactive.Experience.delegateStates.BUILT) {
            this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.READY));
        }
        ////////////////////

        return 1;
    };

//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getS2P = function() {
        if (adways.interactive.Experience.interactiveLibState.valueOf() === adways.interactive.Experience.interactiveLibStates.LOADED) {
            if (this.s2p === null)
                this.s2p = new adways.interactive.SceneControllerWrapper();
            return this.s2p;
        } else {
            return null;
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getP2S = function() {
        if (adways.interactive.Experience.interactiveLibState.valueOf() === adways.interactive.Experience.interactiveLibStates.LOADED) {
            if (this.p2s === null)
                this.p2s = new adways.interactive.SceneControllerWrapper();
            return this.p2s;
        } else {
            return null;
        }
    };

//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setPlayerContainer = function() {
        var container = arguments[0];
        if (arguments.length < 1)
            return -1;
        if (typeof (arguments[0]) === "string")
            container = document.getElementById(arguments[0]);
        if (typeof (container) !== "object")
            return -2;
        if (this.playerContainer !== container) {
            this.playerContainer = container;
            return 1;
        }
        else
            return 0;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getPlayerContainer = function() {
        return this.playerContainer;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.setPlayerAPI = function() {
        if (this.getPlayerState().valueOf() !== adways.interactive.Experience.playerStates.EMPTY)
            return -1;
        else {
            this.ownPlayer = (arguments.length > 1 && typeof (arguments[1]) === "boolean" ? arguments[1] : false);
            this.playerState.setV(adways.interactive.Experience.playerStates.BUILDING);
            this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.PLAYER_STATE_CHANGED));
            return this.playerReady.apply(this, arguments);
        }
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getPlayer = function() {
        console.warn("Adways Loader: Experience.prototype.getPlayer is deprecated. Use Experience.prototype.getPlayerAPI instead.");
        return this.getPlayerAPI();
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getPlayerAPI = function() {
        return this.playerAPI;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getOwnPlayer = function() {
        return this.ownPlayer;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getPlayerState = function() {
        return this.playerState;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.buildPlayer = function() {

        if (this.playerState.valueOf() !== adways.interactive.Experience.playerStates.EMPTY)
            return -4;

        if (this.playerClassJSConstant == "") {
            if (typeof (this.playerBuilderClassname) !== "string") {
                if (typeof (this.playerBuilderURL) !== "string")
                    return -3;
                else
                    return -2;
            }
            this.ownPlayer = true;

            this.playerState.setV(adways.interactive.Experience.playerStates.BUILDING);
            this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.PLAYER_STATE_CHANGED));
            return this._buildPlayer();
        } else {

            this.ownPlayer = true;

            this.playerState.setV(adways.interactive.Experience.playerStates.BUILDING);
            this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.PLAYER_STATE_CHANGED));

            if (!this.playerBuilderClassname || !this.playerBuilderURL) {
                if (this._requestPlayerClassFromJSConstant() > 0)
                    return 2;
                else {
                    this.playerState.setV(adways.interactive.Experience.playerStates.ERROR);
                    this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.PLAYER_STATE_CHANGED));
                    return -5;
                }
            }
            return this._buildPlayer();
        }

    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype._buildPlayer = function() {
        var that = this;
        var evalResult = true;
        try {
            evalResult = eval('(typeof (' + that.playerBuilderClassname + '))');
            evalResult = (evalResult === "undefined");
        }
        catch (e) {
        }

        if (evalResult) {
            // assert(playerScriptTag===null)

            this.playerScriptTag = document.createElement("script");
            if (typeof (adways.tweaks.isIE) === "number" && adways.tweaks.isIE <= 8)
                this.playerScriptTag.type = "text/javascript";
            else
                this.playerScriptTag.type = "application/javascript";

//            this.playerScriptTag.src = this.playerBuilderURL;
            var playerScriptTagSrc = this.playerBuilderURL;
            if (typeof (this.getExperienceParam("playUrlSubstitution")) != "undefined") {
                var playUrlSubstitution = this.getExperienceParam("playUrlSubstitution");
                playerScriptTagSrc = playerScriptTagSrc.replace(playUrlSubstitution[0], playUrlSubstitution[1]);
            }
            if(typeof(adways.tweaks.forceProtocol)!=="undefined") {
                if (playerScriptTagSrc.search(/^http[s]?\:\/\//) === -1) {
                    playerScriptTagSrc = adways.tweaks.forceProtocol+":"+playerScriptTagSrc;
                }
            }
            this.playerScriptTag.src = playerScriptTagSrc;

//        this.playerScriptTag.async = false;
            adways.misc.html.addEventListener(this.playerScriptTag, "load", this.playerScriptTagLoadCB);
            adways.misc.html.addEventListener(this.playerScriptTag, "error", this.playerScriptTagErrorCB);
            document.getElementsByTagName("head")[0].appendChild(this.playerScriptTag);
        } else {
            this.playerScriptTagLoadCB();
        }

        return 1;
    };

//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getDelegate = function() {
        return this.delegate;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getDelegateState = function() {
        return this.delegateState;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.buildDelegate = function() {
        if (typeof (this.playerAPI) !== "object" || this.playerAPI === null ||
                this.getPlayerState().valueOf() !== adways.interactive.Experience.playerStates.BUILT)
            return -1;

        if (adways.interactive.Experience.interactiveLibState.valueOf() !== adways.interactive.Experience.interactiveLibStates.LOADED)
            return -1;

        if (this.delegateState.valueOf() !== adways.interactive.Experience.delegateStates.EMPTY)
            return -4;

        if (this._redirectToIOSApp &&
                this._iphoneBehavior !== adways.interactive.Experience.IPhoneBehaviors.DEFAULT) {
            return -6;
        }

        if (this.playerClassJSConstant == "") {
            if (typeof (this.delegateBuilderClassname) !== "string") {
                if (typeof (this.delegateBuilderURL) !== "string")
                    return -3;
                else
                    return -2;
            }
            this.delegateState.setV(adways.interactive.Experience.delegateStates.BUILDING);
            this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.DELEGATE_STATE_CHANGED));
            return this._buildDelegate();
        } else {

            this.delegateState.setV(adways.interactive.Experience.delegateStates.BUILDING);
            this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.DELEGATE_STATE_CHANGED));

            if (!this.delegateBuilderClassname || !this.delegateBuilderURL) {
                if (this._requestPlayerClassFromJSConstant() > 0)
                    return 2;
                else {
                    this.delegateState.setV(adways.interactive.Experience.delegateStates.ERROR);
                    this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.DELEGATE_STATE_CHANGED));
                    return -5;
                }
            }
            return this._buildDelegate();
        }

    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype._buildDelegate = function() {

        var that = this;
        var evalResult = true;
        try {
            evalResult = eval('(typeof (' + that.delegateBuilderClassname + '))');
            evalResult = (evalResult === "undefined");
        }
        catch (e) {
        }

        if (evalResult) {
            // assert(delegateScriptTag===null)

            this.delegateScriptTag = document.createElement("script");
            if (typeof (adways.tweaks.isIE) === "number" && adways.tweaks.isIE <= 8)
                this.delegateScriptTag.type = "text/javascript";
            else
                this.delegateScriptTag.type = "application/javascript";

//            this.delegateScriptTag.src = this.delegateBuilderURL;
            var delegateScriptTagSrc = this.delegateBuilderURL;
            if (typeof (this.getExperienceParam("playUrlSubstitution")) != "undefined") {
                var playUrlSubstitution = this.getExperienceParam("playUrlSubstitution");
                delegateScriptTagSrc = delegateScriptTagSrc.replace(playUrlSubstitution[0], playUrlSubstitution[1]);
            }
            if(typeof(adways.tweaks.forceProtocol)!=="undefined") {
                if (delegateScriptTagSrc.search(/^http[s]?\:\/\//) === -1) {
                    delegateScriptTagSrc = adways.tweaks.forceProtocol+":"+delegateScriptTagSrc;
                }
            }
            this.delegateScriptTag.src = delegateScriptTagSrc;

//        this.delegateScriptTag.async = false;
            adways.misc.html.addEventListener(this.delegateScriptTag, "load", this.delegateScriptTagLoadCB);
            adways.misc.html.addEventListener(this.delegateScriptTag, "error", this.delegateScriptTagErrorCB);
            document.getElementsByTagName("head")[0].appendChild(this.delegateScriptTag);
        }
        else {
            this.delegateScriptTagLoadCB();
        }

        return 1;
    };

//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.shouldBuildInteractivity = function() {
        return ((typeof (this.forceBuildInteractivity) === "boolean" && this.forceBuildInteractivity)
                ||
                (
                // interactivity is not supported on IE<=7
                !(adways.misc.html.userAgent.UA.browser[0].identifier === adways.misc.html.userAgent.IE &&
                    adways.misc.html.userAgent.UA.browser[0].version[1] <= 7)
                &&
                // on iphone with ios < 10, in a browser, do not build the interactivity, because it may be built inside the adways interactive player app.
                !(adways.misc.html.userAgent.UA.device[0].identifier === adways.misc.html.userAgent.IPHONE && adways.misc.html.userAgent.UA.os[0].version[1] < 10 &&
                    adways.misc.html.userAgent.UA.browser[0].identifier !== adways.misc.html.userAgent.UNKNOWN && !(window.navigator.standalone))   // not in the Adways interactive player ios app
                )
        );
    };

//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.load = function() {
        this.autoBuildScene = true;
        this.autoBuildPlayer = true;
        this.autoBuildDelegate = true;
        var that = this;
        var CB = function() {
            that.autoBuildScene = false;
            that.autoBuildPlayer = false;
            that.autoBuildDelegate = false;
            that.removeEventListener(adways.interactive.Experience.Event.READY, CB);
        };
        this.addEventListener(adways.interactive.Experience.Event.READY, CB);
        // the publicationJSON is already defined so we don't need to request via the publicationID
        if (this.publicationJSON !== null) {
            return this.setPublicationJSON(this.publicationJSON, true);
        } else {
            return this.requestPublicationJSON();
        }
    };

//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.getExperienceID = function() {
        return this.experienceID;
    };

//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------

    adways.interactive.Experience.prototype.getIPhoneBehavior = function() {
        return this._iphoneBehavior;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------

    adways.interactive.Experience.prototype.setIPhoneBehavior = function(iphoneBehavior) {
        this._iphoneBehavior = iphoneBehavior;
    };

//####################################################################################################################################################

//----------------------------------------------------------------------------------------------------------------------------------------------------
    /*
     destinée aux developpeurs des "playerBuilder"
     */
    adways.interactive.Experience.prototype.playerReady = function(playerAPI) {

        if (!this.clearingPlayer) {
            /*
             * Que se passe t il si le player existe deja ? Doit on detruire nous meme le delegate ou bien dire a l'appelant qu'il ne peut pas
             * appeler "playerReady" et qu'il doit au préalable detruire les delegates (via clearPlayer) ?
             * => il doit appeler "clearPlayer"
             */
            if (this.getPlayerState().valueOf() === adways.interactive.Experience.playerStates.BUILDING) {

                this.playerAPI = playerAPI;
                this.playerState.setV(adways.interactive.Experience.playerStates.BUILT);
                this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.PLAYER_STATE_CHANGED));

                // assert(this.mainExp.getDelegateState().valueOf()===adways.interactive.Experience.delegateStates.EMPTY)
                // should be always true, otherwise, there is a pb: playerReady with a delegateState!=EMPTY ???

                if ((this.autoBuildDelegate /*|| opt param autoBuildDelegate typeof(arguments[1])==="boolean"?arguments[1]:false*/) &&
                        this.shouldBuildInteractivity()) {
                    this.buildDelegate();
                    return 2;
                }
                else
                    return 1;
            }
            else
                return -3;
        }
        else
            return -4;
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    /*
     destinée aux developpeurs des "delegateBuilder"
     */
    adways.interactive.Experience.prototype.delegateReady = function(delegate) {

        if (!this.clearingPlayer) {
            if (this.getDelegateState().valueOf() === adways.interactive.Experience.delegateStates.BUILDING) {

                this.delegate = delegate;
                this.delegateState.setV(adways.interactive.Experience.delegateStates.BUILT);
                this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.DELEGATE_STATE_CHANGED));

                // Must disapear but stay for retrocompatibility
                this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.experienceEvents.DELEGATE_BUILT));
                
                if (this.getSceneState().valueOf() === adways.interactive.Experience.sceneStates.EMPTY &&
                        (this.autoBuildScene /*|| opt param autoBuildScene typeof(arguments[1])==="boolean"?arguments[1]:false*/) &&
                        !this.asyncLoadScene &&
                        this.shouldBuildInteractivity()) {
                    this.buildScene();
                    return 2;
                }
                else {
                    ////// deprecated event
                    if (this.getSceneState().valueOf() === adways.interactive.Experience.sceneStates.BUILT) {
                        this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.READY));
                    }
                    ////////////////////
                    return 1;
                }
            }
            else
                return -3;
        }
        else {
            return -4;
        }
    };

//####################################################################################################################################################
    /*
     * Deprecated
     * IInfoCollector implementation
     */
//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.actionExecuted = function() {
        this.dispatchEvent(new adways.interactive.Experience.ActionEvent(arguments[0]));
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.contentClicked = function() {
        this.dispatchEvent(new adways.interactive.Experience.ContentEvent(arguments[0]));
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.started = function() {
        this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.INTERACTIVITY_STARTED));
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.loaded = function() {
        /* 2016.01.21, dthibault, since adways.interactive.Experience implements adways.interactive.IInfoCollector it must implements loaded */
//    this.dispatchEvent(new adways.interactive.Experience.Event(adways.interactive.Experience.Event.INTERACTIVITY_LOADED));
        /* fin 2016.01.21, dthibault */
    };
// no longer required since equal to SCENE_STATE_CHANGED to BUILT

////----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.ended = function() {
        /* 2016.02.02, dthibault, since adways.interactive.Experience implements adways.interactive.IInfoCollector it must implements ended */
//    throw "the player reaches the stream's end. And the video is interactive, the event is not INTERACTIVITY_ENDED but VIDEO_ENDED but should be tracked in a different manner.";
        /* fin 2016.02.02, dthibault */
    };

////----------------------------------------------------------------------------------------------------------------------------------------------------
//adways.interactive.Experience.prototype.enrichmentClick = function() {
//    throw "GNEUUU ???";
//};

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.enrichmentDisplay = function() {
        this.dispatchEvent(new adways.interactive.Experience.EnrichmentEvent(arguments[0]));
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.percentConsumed = function() {
        this.dispatchEvent(new adways.interactive.Experience.PercentConsumedEvent(arguments[0].valueOf()));
    };

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.prototype.sendStat = function() {
        this.dispatchEvent(new adways.interactive.Experience.ContentStatEvent(arguments[0], arguments[1], arguments[2]));
    };




//####################################################################################################################################################
//####################################################################################################################################################
//####################################################################################################################################################
//####################################################################################################################################################
    /*****************************************************************************************************************************************************
     *
     *
     *
     *
     *
     *
     *
     *
     *
     *
     ****************************************************************************************************************************************************/



//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.Event = function() {
        adways.event.Event.apply(this, arguments);
    };
    adways.oop.createClass(adways.interactive.Experience.Event, adways.event.Event);

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.Event.INTERACTIVE_LIB_STATE_CHANGED = ++adways.event.kindCounter;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.Event.SCENE_STATE_CHANGED = ++adways.event.kindCounter;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.Event.PUBLICATION_ID_CHANGED = ++adways.event.kindCounter;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.Event.PUBLICATION_JSON_CHANGED = ++adways.event.kindCounter;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.Event.PLAYER_STATE_CHANGED = ++adways.event.kindCounter;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.Event.DELEGATE_STATE_CHANGED = ++adways.event.kindCounter;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.Event.INTERACTIVITY_STARTED = ++adways.event.kindCounter;
    adways.interactive.Experience.Event.INTERACTIVITY_ENDED = ++adways.event.kindCounter;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.Event.ENRICHMENT_ACTIVATION_CHANGED = ++adways.event.kindCounter;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.Event.CONTENT_CLICKED = ++adways.event.kindCounter;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.Event.VIDEO_STARTED = ++adways.event.kindCounter;
    adways.interactive.Experience.Event.VIDEO_ENDED = ++adways.event.kindCounter;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    /*
     * aujourd'hui un event batard car envoyé lorsque l'interactivite est started mais c'est le percentConsumed de la video...
     * En gros faudrait que ce soit un VIDEO_PERCENT_CONSUMED mais il n'est envoyé que si par ailleurs l'interactivité est activée...
     */
    adways.interactive.Experience.Event.PERCENT_CONSUMED = ++adways.event.kindCounter;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.Event.READY = adways.interactive.experienceEvents.READY;

//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.Event.ACTION_EXECUTED = ++adways.event.kindCounter;
//----------------------------------------------------------------------------------------------------------------------------------------------------
    adways.interactive.Experience.Event.CONTENT_STAT = ++adways.event.kindCounter;


//####################################################################################################################################################

    adways.interactive.Experience.PercentConsumedEvent = function(decile) {
        adways.interactive.Experience.Event.call(this, adways.interactive.Experience.Event.PERCENT_CONSUMED);
        this.decile = arguments[0];
    };
    adways.oop.createClass(adways.interactive.Experience.PercentConsumedEvent, adways.interactive.Experience.Event);

    adways.interactive.Experience.PercentConsumedEvent.prototype.getDecile = function() {
        return this.decile;
    };

//####################################################################################################################################################

    adways.interactive.Experience.ActionEvent = function(action) {
        adways.interactive.Experience.Event.call(this, adways.interactive.Experience.Event.ACTION_EXECUTED);
        this.action = arguments[0];
    };
    adways.oop.createClass(adways.interactive.Experience.ActionEvent, adways.interactive.Experience.Event);

    adways.interactive.Experience.ActionEvent.prototype.getAction = function() {
        return this.action;
    };

//####################################################################################################################################################

    adways.interactive.Experience.ContentEvent = function(content) {
        adways.interactive.Experience.Event.call(this, (arguments.length > 1 ? arguments[1] : adways.interactive.Experience.Event.CONTENT_CLICKED));
        this.content = arguments[0];
    };
    adways.oop.createClass(adways.interactive.Experience.ContentEvent, adways.interactive.Experience.Event);

    adways.interactive.Experience.ContentEvent.prototype.getContent = function() {
        return this.content;
    };

//####################################################################################################################################################

    adways.interactive.Experience.EnrichmentEvent = function(enrichment) {
        adways.interactive.Experience.Event.call(this, adways.interactive.Experience.Event.ENRICHMENT_ACTIVATION_CHANGED);
        this.enrichment = arguments[0];
    };
    adways.oop.createClass(adways.interactive.Experience.EnrichmentEvent, adways.interactive.Experience.Event);

    adways.interactive.Experience.EnrichmentEvent.prototype.getEnrichment = function() {
        return this.enrichment;
    };

//####################################################################################################################################################

    adways.interactive.Experience.ContentStatEvent = function(content, key, value) {
        adways.interactive.Experience.ContentEvent.call(this, arguments[0], adways.interactive.Experience.Event.CONTENT_STAT);
        this.key = arguments[1];
        this.value = arguments[2];
    };
    adways.oop.createClass(adways.interactive.Experience.ContentStatEvent, adways.interactive.Experience.ContentEvent);

    adways.interactive.Experience.ContentStatEvent.prototype.getKey = function() {
        return this.key;
    };
    adways.interactive.Experience.ContentStatEvent.prototype.getValue = function() {
        return this.value;
    };
    
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/*
 */


}());

    /*##################################################################################################################################################*/

    if (typeof (adways.interactive.load) !== "undefined") {
        console.warn("\"adways.interactive.load\" is already defined");
        return;
    }
    /*
     * load (json): Experience
     * json.playerType: Constant
     * json.player: domID | ptr
     * json.publicationID: string
     * json.container: domID | ptr (si player present, alors container est ignoré)
     */
    adways.interactive.load = function() {
        var experience = adways.interactive.createExperience.apply(null, arguments);
        experience.load();
        return experience;
    };
    adways.interactive.createExperience = function() {

        // experience
        // lmasclaux, 2016.01.22, the experience constructor sets the experienceID
        var experience = new adways.interactive.Experience();
        adways.interactive.experiences[experience.getExperienceID()] = experience;
//             adways.debugExperience =    adways.interactive.experiences[experienceID];    

//experienceID,
//                publication,
//                arguments[0].playerParams ? arguments[0].playerParams : new Object(),
//                arguments[0].delegateParams ? arguments[0].delegateParams : new Object(),
//                arguments[0].mediaParams ? arguments[0].mediaParams : new Object(),
//                arguments[0].options ? arguments[0].options : new Object(),
//                arguments[0].asyncLoadScene ? arguments[0].asyncLoadScene : false,
//                playerHelper,
//                player,
//                container

        var publication = null;
        if (arguments.length > 0 && typeof (arguments[0]) == "object") {
            if (typeof arguments[0].publication !== "undefined") {
                publication = arguments[0].publication;
                if (!(
                        typeof (publication) === "string" ||
                        (typeof (publication) === "object" && typeof (publication.publication) === "object" && typeof (publication.publication.id) === "string")
                        )) {
                    console.warn("Adways Loader: the publication param is not valid");
                }
            }
        }

        // player type
        // retrocompatibilité de playerClass avec playerHelper avec playerType
        var playerClass = null;
        if (arguments.length > 0 && typeof (arguments[0].playerHelper) !== "undefined" && typeof (arguments[0].playerClass) == "undefined") {
            arguments[0].playerClass = arguments[0].playerHelper;
        }
        if (arguments.length > 0 && typeof (arguments[0].playerType) !== "undefined" && typeof (arguments[0].playerClass) == "undefined") {
            arguments[0].playerClass = arguments[0].playerType;
        }
        if (arguments.length > 0 && typeof (arguments[0].playerClass) !== "undefined") {
            if (typeof (arguments[0].playerClass) !== "string") {
                // the playerClass given is a custom helper, not referenced in adways
                playerClass = arguments[0].playerClass;
                playerClass.js_constant = "CUSTOM";
            } else {
                playerClass = arguments[0].playerClass;
            }
        }

        // player or container
        var player = null;
        var container = null;
        if (arguments.length > 0 && typeof (arguments[0].player) !== "undefined" && playerClass != null) {
            if (typeof (arguments[0].player) === "string") {
                switch (playerClass.js_constant) {
                    default:
                        player = document.getElementById(arguments[0].player);
                        break;
                }
            }
            else {
                switch (playerClass.js_constant) {
                    default:
                        player = arguments[0].player;
                        break;
                }
            }
        }

        if (player === null && arguments.length > 0 && typeof (arguments[0].container) !== "undefined") {
            container = arguments[0].container;
            if (typeof (container) !== "undefined") {
                if (typeof (container) === "string") {
                    container = document.getElementById(container);
                }
                else if (typeof (container) !== "object") {
                    console.warn("Adways Loader: container is not an object so cannot be a valid DOM element");
                }
//                var tmp = document.createElement("div");
//                tmp.style.position = "relative";
//                tmp.style.width = "100%";
//                tmp.style.height = "100%";
//                container.appendChild(tmp);
//                container = tmp;
            }
            else {
                console.warn("Adways Loader: unable to find the player");
            }
        }

        if (arguments.length > 0) {

            if (playerClass !== null)
                experience.setPlayerClass(playerClass);

            if (arguments[0].playerParams)
                experience.setPlayerParams(arguments[0].playerParams);

            if (arguments[0].mediaParams)
                experience.setMediaParams(arguments[0].mediaParams);

            if (arguments[0].delegateParams)
                experience.setDelegateParams(arguments[0].delegateParams);

            if (arguments[0].options)
                experience.setPlayerOptions(arguments[0].options);
            
            if (arguments[0].playerOptions)
                experience.setPlayerOptions(arguments[0].playerOptions);
        }

        if (player != null)
            experience.setPlayerAPI(player);
        else if (container != null)
            experience.setPlayerContainer(container);

        if (typeof (publication) === "string")
            experience.setPublicationID(publication);
        else if (typeof (publication) === "object" && publication != null && typeof (publication.publication) === "object" /*&& typeof (publication.publication.id) === "string"*/)
        {
            experience.setPublicationJSON(publication);
        }

        return experience;
    };

    /*##################################################################################################################################################*/

    if (typeof (adways.interactive.unload) !== "undefined") {
        console.warn("\"adways.interactive.unload\" is already defined");
    }
    /*
     * unload (experience: Experience): number
     */
    adways.interactive.unload = function(experience) {
        for (var exp in adways.interactive.experiences) {
            if (experience === adways.interactive.experiences[exp])
                delete adways.interactive.experiences[exp];
        }
        //////////////////////////////////////////////////////////////
        // lmasclaux: to verif
        experience.clearAll();
        //////////////////////////////////////////////////////////////
        adways.destruct(experience);
    };

}(window));
    }

    experience = new adways.interactive.Experience();
    experience.setPlayerClass("brightcove");
    experience.setPlayerAPI(that);

    if (typeof arguments[0] == "undefined")
        arguments[0] = new Object();

//    if (typeof arguments[0].experienceCreatedCBs == "object") {
//        for (var expCreated = 0; expCreated < arguments[0].experienceCreatedCBs.length; expCreated++) {
//            if (typeof arguments[0].experienceCreatedCBs[expCreated] == "string" && typeof that[arguments[0].experienceCreatedCBs[expCreated]] == "function")
//                that[arguments[0].experienceCreatedCBs[expCreated]]({"adwaysExperience": experience});
//        }
//    }
    
    if (typeof arguments[0].experienceCreatedCBs == "object") {
        var tabInterval = [];
        for (var expCreated = 0; expCreated < arguments[0].experienceCreatedCBs.length; expCreated++) {
            (function(e, t, i, a) {
                i[e] = setInterval(function() {
                    if (typeof a.experienceCreatedCBs[e] == "string" && typeof t[a.experienceCreatedCBs[e]] == "function") {
                        clearInterval(i[e]);
                        t[a.experienceCreatedCBs[e]]({"adwaysExperience": experience});
                    }
                }, 150);
                setTimeout(function() {
                    clearInterval(i[e]);
                }, 3500);
            })(expCreated, that, tabInterval, arguments[0]);
        }
    }
    
    

    autoLoad = typeof (arguments[0].autoLoad) !== "undefined" ? Boolean(arguments[0].autoLoad) : false;

    var checkMetadataTimeout = 5000;
    if (typeof (arguments[0].checkMetadataTimeout_flash) === "number") {
        checkMetadataTimeout = arguments[0].checkMetadataTimeout_flash;
    }

    var customMetadatasWatcherTimer = null;

    var getCustomMetadatas = function() {

        if (typeof that.mediainfo != "undefined" && customMetadatasWatcherTimer !== null) {
            window.clearInterval(customMetadatasWatcherTimer);
            customMetadatasWatcherTimer = null;
        } else if (typeof that.mediainfo != "undefined" && customMetadatasWatcherTimer === null) {
            // hum I dunno what happens here yet
        } else
            return 0;

        if (currentMediaID != "" && currentMediaID != that.mediainfo && experience.getSceneState().valueOf() !== adways.interactive.Experience.sceneStates.EMPTY) {
            experience.clearScene();
        }

        currentMediaID = that.mediainfo.id;

        if (that.mediainfo && that.mediainfo.custom_fields
                && that.mediainfo.custom_fields.adways_scene_time_reference
                && (typeof (that.mediainfo.custom_fields.adways_scene_time_reference) == "string"
                        || typeof (that.mediainfo.custom_fields.adways_scene_time_reference) == "boolean")) {
            // default value: false
            if (experience.getSceneTimeReference() == false)
                experience.setSceneTimeReference(Boolean(that.mediainfo.custom_fields.adways_scene_time_reference));
        }

        // Warning: "publicationID" is deprecated
        if (that.mediainfo && that.mediainfo.custom_fields && that.mediainfo.custom_fields[defaultCustomField]) {
            if (typeof (that.mediainfo.custom_fields[defaultCustomField]) !== "string") {
                console.warn("The Adways Publication ID custom field has to be a string.");
            } else {
                if (experience.getPublicationID() == "") {
                    experience.setPublicationID(that.mediainfo.custom_fields[defaultCustomField]);
                }
            }
        }

        if (autoLoad && experience.getPublicationID() != "")
        {
            experience.load();
        }
    };

    if (typeof (arguments[0].publicationID) == "string") {
        experience.setPublicationID(arguments[0].publicationID);
    }
    else if (typeof (arguments[0].publication) == "string") {
        experience.setPublicationID(arguments[0].publication);
    }
    else if (typeof (arguments[0].publication) == "object") {
        experience.setPublicationJSON(arguments[0].publication);
    }
	
    // custom fields
    if (typeof (arguments[0].customField) == "string") {
        defaultCustomField = arguments[0].customField;
    }

    // live mode
    if (typeof arguments[0].sceneTimeReference == "boolean" || typeof arguments[0].sceneTimeReference == "string") {
        experience.setSceneTimeReference(Boolean(arguments[0].sceneTimeReference));
    }

    customMetadatasWatcherTimer = setInterval(getCustomMetadatas, 250);
    setTimeout(function() {
        if (customMetadatasWatcherTimer !== null)
            clearInterval(customMetadatasWatcherTimer);
    }, checkMetadataTimeout);

    that.on("loadedmetadata", getCustomMetadatas);

    return experience;

};